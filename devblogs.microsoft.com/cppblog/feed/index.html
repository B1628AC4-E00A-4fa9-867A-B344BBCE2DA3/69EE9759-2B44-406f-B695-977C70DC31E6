<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>C++ Team Blog</title>
	<atom:link href="https://devblogs.microsoft.com/cppblog/feed/" rel="self" type="application/rss+xml" />
	<link>https://devblogs.microsoft.com/cppblog/</link>
	<description>The latest in C++, Visual Studio, VS Code, and vcpkg from the MSFT C++ team</description>
	<lastBuildDate>Thu, 28 Sep 2023 10:26:38 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	

<image>
	<url>https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2018/10/Microsoft-Favicon.png</url>
	<title>C++ Team Blog</title>
	<link>https://devblogs.microsoft.com/cppblog/</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Microsoft C++ Team at CppCon 2023</title>
		<link>https://devblogs.microsoft.com/cppblog/microsoft-cpp-team-at-cppcon-2023/</link>
					<comments>https://devblogs.microsoft.com/cppblog/microsoft-cpp-team-at-cppcon-2023/#respond</comments>
		
		<dc:creator><![CDATA[Sy Brand]]></dc:creator>
		<pubDate>Thu, 28 Sep 2023 16:00:34 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32933</guid>

					<description><![CDATA[<p>As always our team will be at CppCon this year with a host of presentations. Many of us will also be present at our team’s booth in the main hall for the first two days of the conference. Come say hi and let us know if you have any questions about our talks,</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/microsoft-cpp-team-at-cppcon-2023/">Microsoft C++ Team at CppCon 2023</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p><img decoding="async" class="size-full wp-image-24953 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2019/09/atcpp.png" alt="Microsoft @ CppCon" width="760" height="466" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2019/09/atcpp.png 760w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2019/09/atcpp-300x184.png 300w" sizes="(max-width: 760px) 100vw, 760px" /></p>
<p>As always our team will be at <a href="https://cppcon.org/">CppCon</a> this year with a host of presentations. Many of us will also be present at our team’s booth in the main hall for the first two days of the conference. Come say hi and let us know if you have any questions about our talks, products, or anything else! You can also join the <a href="https://aka.ms/cppcon/discord">#visual_studio channel on the CppCon Discord</a> to talk to us (note: to join, head to <a href="https://discord.com/channels/864799911358627861/864825142386622474">#directory</a> channel first, and check the checkbox next to &#8220;Visual Studio&#8221; box).</p>
<p>We’re also running a survey on the C++ ecosystem. If you have a moment, <a href="https://aka.ms/cppcon" target="_blank" rel="noopener noreferrer">please take our survey.</a> It&#8217;s quick and you could win a utility backpack or duffel bag.</p>
<p>Here’s the lineup:</p>
<h2 data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" id="monday-2nd"><span data-usefontface="true" data-contrast="none">Monday 2nd</span>​</h2>
<ul style="font-weight: 400;">
<li data-charcodes="8226" data-font="Arial,Sans-Serif" data-buautonum="8" data-margin="450" data-aria-posinset="1" data-aria-level="1"><b><span data-usefontface="true" data-contrast="none">Lifetime Safety in C++</span></b><span data-usefontface="true" data-contrast="none"> – Gabor Horvath – 11am </span>​</li>
<li data-charcodes="8226" data-font="Arial,Sans-Serif" data-buautonum="8" data-margin="450" data-aria-posinset="2" data-aria-level="1"><b><span data-usefontface="true" data-contrast="none">Informal Birds of a Feather for Cpp2/</span></b><b><span data-usefontface="true" data-contrast="none">cppfront</span></b> – <span data-usefontface="true" data-contrast="none">Herb Sutter – 12:30pm</span>​</li>
</ul>
<h2 data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" id="tuesday-3rd"><span data-usefontface="true" data-contrast="none">Tuesday​ 3rd</span>​</h2>
<ul style="font-weight: 400;">
<li data-charcodes="8226" data-font="Arial,Sans-Serif" data-buautonum="8" data-margin="450" data-aria-posinset="4" data-aria-level="1"><b><span data-usefontface="true" data-contrast="none">What’s New in Visual Studio – </span></b><span data-usefontface="true" data-contrast="none">David Li &amp; Mryam Girmay – 3:15pm</span>​</li>
</ul>
<h2 data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" id="thursday-5th"><span data-usefontface="true" data-contrast="none">​Thursday 5th​</span>​</h2>
<ul style="font-weight: 400;">
<li data-charcodes="8226" data-font="Arial,Sans-Serif" data-buautonum="8" data-margin="450" data-aria-posinset="6" data-aria-level="1"><b><span data-usefontface="true" data-contrast="none">Cooperative C++ Evolution: Towards a Typescript for C++</span></b><span data-usefontface="true" data-contrast="none"> – Herb Sutter (Keynote) – 10:30am</span>​</li>
<li data-charcodes="8226" data-font="Arial,Sans-Serif" data-buautonum="8" data-margin="450" data-aria-posinset="7" data-aria-level="1"><b><span data-usefontface="true" data-contrast="none">How Visual Studio Code Can Help You Develop More Efficiently in C++</span></b><span data-usefontface="true" data-contrast="none"> – Alexandra </span><span data-usefontface="true" data-contrast="none">Kemper &amp; Sinem Akinci – 3:15pm</span>​</li>
<li data-charcodes="8226" data-font="Arial,Sans-Serif" data-buautonum="8" data-margin="450" data-aria-posinset="8" data-aria-level="1"><b><span data-usefontface="true" data-contrast="none">Regular, Revisited</span></b><span data-usefontface="true" data-contrast="none"> – Victor Ciura – 3:15pm</span>​</li>
</ul>
<h2 data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" data-ccp-props="{&quot;335551550&quot;:1,&quot;335551620&quot;:1,&quot;335559683&quot;:0,&quot;335559685&quot;:0,&quot;335559731&quot;:0,&quot;335559737&quot;:0,&quot;335562764&quot;:2,&quot;335562765&quot;:1,&quot;335562766&quot;:4,&quot;335562767&quot;:0,&quot;335562768&quot;:4,&quot;335562769&quot;:0}" id="friday-6th"><span data-usefontface="true" data-contrast="none">Friday 6th​</span>​</h2>
<ul style="font-weight: 400;">
<li data-charcodes="8226" data-font="Arial,Sans-Serif" data-buautonum="8" data-margin="450" data-aria-posinset="10" data-aria-level="1"><b><span data-usefontface="true" data-contrast="none">Getting Started with C++ – </span></b><span data-usefontface="true" data-contrast="none">Michael Price – 1:30pm</span></li>
</ul>
<p>&nbsp;</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/microsoft-cpp-team-at-cppcon-2023/">Microsoft C++ Team at CppCon 2023</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/microsoft-cpp-team-at-cppcon-2023/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>MSVC ARM64 Optimizations in Visual Studio 2022 17.7</title>
		<link>https://devblogs.microsoft.com/cppblog/msvc-arm64-optimizations-in-visual-studio-2022-17-7/</link>
					<comments>https://devblogs.microsoft.com/cppblog/msvc-arm64-optimizations-in-visual-studio-2022-17-7/#respond</comments>
		
		<dc:creator><![CDATA[Hongyon Suauthai (ARM)]]></dc:creator>
		<pubDate>Thu, 28 Sep 2023 15:00:51 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<category><![CDATA[faster]]></category>
		<category><![CDATA[performance]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32881</guid>

					<description><![CDATA[<p>In Visual Studio 2022 version 17.6 we added a host of new ARM64 optimizations. In this 2nd edition of our blog, we will highlight some of the performance improvements to MSVC ARM64 compiler backend, we will discuss key optimizations in the Visual Studio 2022 version 17.7 for both scalar ISA and SIMD ISA (NEON).</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/msvc-arm64-optimizations-in-visual-studio-2022-17-7/">MSVC ARM64 Optimizations in Visual Studio 2022 17.7</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>In Visual Studio 2022 version 17.6 we added a <a href="https://devblogs.microsoft.com/cppblog/msvc-arm64-optimizations-in-visual-studio-2022-17-6/">host of new ARM64 optimizations</a>. In this 2<sup>nd</sup> edition of our blog, we will highlight some of the performance improvements to MSVC ARM64 compiler backend, we will discuss key optimizations in the <a href="https://devblogs.microsoft.com/visualstudio/visual-studio-2022-17-7-now-available/">Visual Studio 2022 version 17.7</a> for both scalar ISA and SIMD ISA (NEON). We started introducing these performance optimizations in 17.6 release and we have landed them in 17.7 release.</p>
<h2 id="by-element-operation">By element operation</h2>
<p>ARM64 supports by-element operation in several instructions such as <code>fmul</code>, <code>fmla</code>, <code>fmls</code>, etc.  This feature allows a SIMD operand to be computed directly by a SIMD element using an index to access it. In the example below where we multiply a scalar with an array, MSVC duplicated the vector element <code>v0.s[0]</code> into all lanes of a SIMD register, then multiplied that with another SIMD operand represented by array <code>b</code>.  This is not efficient because the <code>dup</code> instruction will add 2 more execution latency before executing the <code>fmul</code> instruction.</p>
<p>To better understand this optimization let’s take the following sample code:</p>
<pre>void test(float * __restrict a, float * __restrict b, float c) {
    for (int i = 0; i &lt; 4; i++)
        a[i] = b[i] * c;
}</pre>
<p>Code generated by MSVC 17.6:</p>
<pre>        dup         v17.4s,v0.s[0]
        ldr         q16,[x1]
        fmul        v16.4s,v17.4s,v16.4s
        str         q16,[x0]</pre>
<p>In Visual Studio 2022 17.7, we eliminated a duplicate instruction. It now can multiply by a SIMD element directly and the code generation is:</p>
<pre>        ldr         q16,[x1]
        fmul        v16.4s,v16.4s,v0.s[0]
        str         q16,[x0]</pre>
<h2 id="neon-supports-for-shift-right-and-accumulate-immediate">Neon supports for shift right and accumulate immediate</h2>
<p>This instruction right-shifts a SIMD source by an immediate and accumulates the final result with the destination SIMD register. As mentioned earlier, we started working on this optimization in the 17.6 release and completed the feature in the 17.7 release.</p>
<p>In the 17.5 release MSVC turned right shifts into left shifts using a negative shift amount. To implement it that way, it copied a constant -2 into a general register, and then duplicated a general register into the SIMD register before the left shift.</p>
<p>We eliminated the duplicate instruction and used right shift with an immediate value in the 17.6 release. It was an improvement, but not yet good enough.</p>
<p>We further improved the implementation in 17.7 by combining right shift and add by using <code>usra</code> for unsigned and <code>ssra</code> for signed operation. The final implementation is much more compact than the previous ones.</p>
<p>To better understand how this optimization works let’s look at the sample code below:</p>
<pre>void test(unsigned long long * __restrict a, unsigned long long * __restrict b) {
    for (int i = 0; i &lt; 2; i++)
        a[i] += b[i] &gt;&gt; 2;
}</pre>
<p>Code generated by MSVC 17.5:</p>
<pre>        mov         x8,#-2
        ldr         q16,[x1]
        dup         v17.2d,x8
        ldr         q18,[x0]
        ushl        v17.2d,v16.2d,v17.2d
        add         v18.2d,v17.2d,v18.2d
        str         q18,[x0]</pre>
<p>Code generated by MSVC 17.6:</p>
<pre>        ldr         q16,[x1]
        ushr        v17.2d,v16.2d,#2
        ldr         q16,[x0]
        add         v16.2d,v17.2d,v16.2d
        str         q16,[x0]</pre>
<p>Code generated by MSVC 17.7:</p>
<pre>        ldr         q16,[x0]
        ldr         q17,[x1]
        usra        v16.2d,v17.2d,#2
        str         q16,[x0]</pre>
<h2 id="neon-right-shift-into-cmp">Neon right shift into cmp</h2>
<p>A right shift on a signed integer shifts the msb, with the result being either -1 or 0, and is equivalent to <code>cmlt</code>.  Similar to the previous optimization, we progressively made improvements and completed the feature in 17.7.</p>
<p>To better understand why we introduced this optimization let’s take the following snippet of code,</p>
<pre>void shf2cmlt(int * __restrict a, int * __restrict b) {
    for (int i = 0; i &lt; 4; i++)
      b[i] = a[i] &gt;&gt; 31;
}</pre>
<p>Code generated by MSVC 17.5:</p>
<pre>        ldr         q16,[x0]
        mvni        v17.4s,#0x1E
        sshl        v17.4s,v16.4s,v17.4s
        str         q17,[x1]</pre>
<p>Code generated by MSVC 17.6:</p>
<pre>        ldr         q16,[x0]
        sshr        v16.4s,v16.4s,#0x1F
        str         q16,[x1]</pre>
<p><code>sshr</code> was certainly an improvement but not the best solution because its throughput is 1 and can go through only the V1 pipeline. <code>cmlt</code> has better throughput as it can go through pipelines V1 or V2 on Arm’s Neoverse N1 core as in <a href="https://developer.arm.com/documentation/PJDOC-466751330-9707/r4p1/?lang=en">Arm® Neoverse<img src="https://s.w.org/images/core/emoji/14.0.0/72x72/2122.png" alt="™" class="wp-smiley" style="height: 1em; max-height: 1em;" /> N1 Software Optimization Guide</a>.</p>
<p>Code generated by MSVC 17.7:</p>
<pre>        ldr         q16,[x0]
        cmlt        v16.4s,v16.4s,#0
        str         q16,[x1]</pre>
<h2 id="neon-right-shift-and-narrow-into-shifted-narrow">Neon right shift and narrow into shifted narrow</h2>
<p>This is another case where we can combine 2 instructions into one using <code>shrn</code>. The <code>shrn </code>instruction right shifts each element of an unsigned integer value from the source SIMD register by an immediate value, puts the result into a SIMD register, and writes the vector to the lower half of the destination SIMD register.</p>
<p>In this example, the generated code multiplies 16-bit integers, and puts the result into an unsigned 32-bit destination. It right-shifts the result by an immediate value, then it extracts, narrows half of it, and writes to the final destination.</p>
<p>To better understand this optimization, consider the following sample of code:</p>
<pre>void test(unsigned short * __restrict a, short * __restrict b) {
    for( int i = 0; i &lt; 4; i++ )
        b[i] = (a[i] * a[i]) &gt;&gt; 10;
}</pre>
<p>Code generated by MSVC 17.6:</p>
<pre>        ldr         d16,[x0]
        umull       v16.4s,v16.4h,v16.4h
        sshr        v16.4s,v16.4s,#0xA
        xtn         v16.4h,v16.4s
        str         d16,[x1]</pre>
<p>Code generated by MSVC 17.7:</p>
<pre>        ldr         d16,[x0]
        umull       v16.4s,v16.4h,v16.4h
        shrn        v16.4h,v16.4s,#0xA
        str         d16,[x1]</pre>
<h2 id="scalar-code-generation-improved-negation-of-bool-value">Scalar code-generation improved negation of bool value</h2>
<p>A negation of a Boolean value can generally be optimized using an <em>exclusive or</em> with 1.</p>
<p><em>For example,</em><em> </em></p>
<p>0 ^ 1 = 1</p>
<p>1 ^ 1 = 0</p>
<p>In 17.6, MSVC generates unnecessary code using <code>cmp</code><em> + </em><code>cseleq</code> to negate boolean function&#8217;s return values.</p>
<p>To better understand this optimization let’s take the following sample code:</p>
<pre>bool foo();
bool negate_bool() {
    return !foo();
}</pre>
<p>Code generated by MSVC 17.6:</p>
<pre>        bl          |?foo@@YA_NXZ|
        uxtb        w8,w0
        cmp         w8,#0
        cseteq      w0
        ldr         lr,[sp],#0x10</pre>
<p>It extracts the return value of function <code>foo()</code> and compares with 0, then uses cseteq to check if the return value is equal to 0 to return 1, otherwise it returns 0.</p>
<p>While in 17.7 we improve it by doing a bit-wise <em>exclusive or </em>which is equivalent to negation.</p>
<p>Code generated by MSVC 17.7:</p>
<pre>        bl          |?foo@@YA_NXZ|
        eor         w8,w0,#1
        uxtb        w0,w8
        ldr         lr,[sp],#0x10</pre>
<p>&nbsp;</p>
<h2 id="arm64-instruction-eliminate-redundant-comparisons">ARM64 instruction eliminate redundant comparisons</h2>
<p>There are certain cases where MSVC fails to recognize that the comparison conditions are the same and the conditional flag is unchanged.  In the following example, there are 3 comparisons for <code>if (cond<em>)</em></code> for assigning <code>a</code>, <code>b</code>, and <code>c</code> using <code>cseleq</code><em>.</em></p>
<pre>struct A {
        int a;
        int b;
        int c;
};   

void foo(struct A *sa, int cond) {
    int a = 1, b = 2, c = 3;
    if (cond) {
        a = 20;
        b = 33;
        c = 48;
    }

    sa-&gt;a = a;
    sa-&gt;b = b;
    sa-&gt;c = c;
}</pre>
<p>Code generated by MSVC 17.6:</p>
<pre>        cmp         w1,#0
        mov         w9,#1
        mov         w8,#0x14
        cseleq      w10,w9,w8
        cmp         w1,#0
        mov         w9,#2
        mov         w8,#0x21
        cseleq      w8,w9,w8
        stp         w10,w8,[x0]
        cmp         w1,#0
        mov         w8,#0x30
        mov         w9,#3
        cseleq      w8,w9,w8
; Line 19
        str         w8,[x0,#8]</pre>
<p>We taught the backend to recognize the pattern. The code-generation in the 17.7 release has been optimized.</p>
<p>Code generated by MSVC 17.7:</p>
<pre>        cmp         w1,#0
        mov         w9,#1
        mov         w8,#0x14
        cseleq      w10,w9,w8
        mov         w9,#2
        mov         w8,#0x21
        cseleq      w8,w9,w8
        stp         w10,w8,[x0]
        mov         w9,#3
        mov         w8,#0x30
        cseleq      w8,w9,w8
; Line 19
        str         w8,[x0,#8]</pre>
<h2 id="summary">Summary</h2>
<p>We would like to thank everyone for giving us feedback and we are looking forward to hearing more from you.  We will continue to improve MSVC for ARM developers in 17.8.  Please stay tuned.  Your feedback is very valuable to us. Please share your thoughts and comments with us through <u>Virtual C++ Developer Community</u>. You can also reach us on Twitter (<a href="https://twitter.com/visualc">@VisualC</a>), or via email at <a href="mailto:visualcpp@microsoft.com">visualcpp@microsoft.com</a>.</p>
<p>&nbsp;</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/msvc-arm64-optimizations-in-visual-studio-2022-17-7/">MSVC ARM64 Optimizations in Visual Studio 2022 17.7</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/msvc-arm64-optimizations-in-visual-studio-2022-17-7/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>C11 Threads in Visual Studio 2022 version 17.8 Preview 2</title>
		<link>https://devblogs.microsoft.com/cppblog/c11-threads-in-visual-studio-2022-version-17-8-preview-2/</link>
					<comments>https://devblogs.microsoft.com/cppblog/c11-threads-in-visual-studio-2022-version-17-8-preview-2/#comments</comments>
		
		<dc:creator><![CDATA[Charlie Barto]]></dc:creator>
		<pubDate>Tue, 26 Sep 2023 16:00:25 +0000</pubDate>
				<category><![CDATA[Announcement]]></category>
		<category><![CDATA[C++]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32848</guid>

					<description><![CDATA[<p>Back in Visual Studio 2022 version 17.5 Microsoft Visual C gained preliminary support for C11 atomics. We are happy to announce that support for the other major concurrency feature of C11, threads, is available in Visual Studio version 17.8 Preview 2.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/c11-threads-in-visual-studio-2022-version-17-8-preview-2/">C11 Threads in Visual Studio 2022 version 17.8 Preview 2</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>Back in <a href="https://devblogs.microsoft.com/cppblog/c11-atomics-in-visual-studio-2022-version-17-5-preview-2/">Visual Studio 2022 version 17.5</a> Microsoft Visual C gained preliminary support for C11 atomics. We are happy to announce that support for the other major concurrency feature of C11, threads, is available in Visual Studio version 17.8 Preview 2. This should make it easier to port cross-platform C applications to Windows, without having to drag along a threading compatibility layer.</p>
<p>Unlike C11 atomics, C11 threads do not share an ABI with C++’s <code>&lt;thread&gt;</code> facilities, but C++ programs can include the C11 threads header and call the functions just like any C program. Both are implemented in terms of the primitives provided by Windows, so their usage can be mixed in the same program and on the same thread. The implementations are distinct, however, for example you can’t use the C11 mutexes with C++ condition variables.</p>
<p>C11 contains support for threads and a variety of related concurrency primitives including mutexes, condition variables, and thread specific storage. All of these are implemented in Visual Studio version 17.8 Preview 2.</p>
<h2><a id="post-32848-threads"></a>Threads</h2>
<p>Threads are created with <code>thrd_create</code>, to which you pass a pointer to the desired entry point and a user data pointer (which may be null), along with a pointer to a <code>thrd_t</code> structure to fill in. Once you have a <code>thrd_t</code> created with <code>thrd_create</code> you can call functions to compare it to another <code>thrd_t</code>, join it, or detach it. Functions are also provided to sleep or yield the current thread.</p>
<pre class="prettyprint language-default"><code class="language-default">int thread_entry(void* data) {
    return 0;
}

int main(void) {
    thrd_t thread;
    int result = thrd_create(&amp;thread, thread_entry, NULL);
    if(result != thrd_success) {
        // handle error
    }
    result = thrd_join(thread, NULL);
    if(result != thrd_success) {
        // handle error
    }
    return 0;
}</code></pre>
<p>&nbsp;</p>
<p>A key difference between our implementation and C11 threads implementations based on pthreads is that threads can not detach <em>themselves</em> using <code>thrd_current()</code> and <code>thrd_detach()</code>. This is because of a fundamental difference in how threads work on Windows vs Unix descendants and we would require a shared datastructure that tracks thread handles to implement the typical behavior.</p>
<p>On Unix derivatives the integer thread ID <em>is</em> the handle to the thread and detaching just sets a flag causing the thread to be cleaned up immediately when it finishes. This makes detached threads somewhat dangerous to use on Unix derivatives, since after a detached thread exits any other references to that thread ID will be dangling and could later refer to a different thread altogether. On Windows the handle to a thread is a win32 <code>HANDLE</code> and is reference counted. The thread is cleaned up when the last handle is closed. There is no way to close all handles to a thread except by keeping track of them and closing each one.</p>
<p>We could implement the Unix/pthreads behavior by keeping a shared mapping of thread-id to handle, populated by <code>thrd_create</code>. If you need this functionality then you can implement something like this yourself, but we don’t provide it by default because it would incur a cost even if it’s not used. Better workarounds may also be available, such as passing a pointer to the <code>thrd_t</code> populated by <code>thrd_create</code> via the user data pointer to the created thread.</p>
<h2><a id="post-32848-mutexes"></a>Mutexes</h2>
<p>Mutexes are provided through the <code>mtx_t</code> structure and associated functions. Mutexes can be either plain, recursive, timed, or a combination of these properties. All kinds of mutexes are manipulated with the same functions (the type is dynamic).</p>
<pre class="prettyprint language-default"><code class="language-default">#include &lt;threads.h&gt; 
 
static mtx_t mtx; // see below 
 
int main(void) { 
    if(mtx_lock(&amp;mtx) != thrd_success) { 
        return 1; 
    } 
    // do some stuff protected by the mutex 
 
    // no need to check the result of a valid unlock call 
    mtx_unlock(&amp;mtx); 
 
    // no need to call mtx_destroy 
} </code></pre>
<p>&nbsp;</p>
<p>Our mutexes are always implemented on top of <a href="https://learn.microsoft.com/en-us/windows/win32/sync/slim-reader-writer--srw--locks">Slim Reader Writer Locks</a> and are 32 bytes each on x64 (our C++ <code>std::mutex</code> is 80 bytes). They consist of an 8 byte tag (this is much more than needed, but provides some room for future expansion), an <code>SRWLock</code>, a win32 <code>CONDITION_VARIABLE</code>, and a 32-bit owner and lock count. The owner and lock count are always maintained, even when mutex is not recursive. If you attempt to recursively lock a non-recursive mutex, or unlock a mutex you do not own then <code>abort()</code> is called. Structurally valid calls to <code>mtx_unlock</code> always succeed, and it is safe to ignore the return value of <code>mtx_unlock</code> in our implementation.</p>
<p>In our implementation you need not call <code>mtx_init</code>; a zeroed <code>mtx_t</code> is a valid plain mutex. Mutexes also don’t require any cleanup and calls to <code>mtx_destroy</code> are optional. This means you can safely use mutexes as static variables and similar.</p>
<h2><a id="post-32848-condition-variables"></a>Condition Variables</h2>
<p>Condition variables are provided through the <code>cnd_t</code> structure and associated functions. This structure is 8 bytes and stores just a win32 <code>CONDITION_VARIABLE</code>. You can wait on the condition variable with <code>cnd_wait</code>, or <code>cnd_timedwait</code>, and you can wake one waiting thread with <code>cnd_signal</code> or all waiting threads with <code>cnd_broadcast</code>. Spurious wakeups are allowed.</p>
<pre class="prettyprint language-default"><code class="language-default">#include &lt;threads.h&gt; 
 
static mtx_t mtx; 
static cnd_t cnd; 
static int condition; 
 
int main(void) { 
    if(mtx_lock(&amp;mtx) != thrd_success) { 
        return 1; 
    } 
    while(condition == 0) { 
        if(cnd_wait(&amp;cnd, &amp;mtx) != thrd_success) { 
            return 1; 
        } 
    } 
    mtx_unlock(&amp;mtx); 
    return 0; 
} </code></pre>
<p>Similarly to mutexes, zeroed condition variables are valid and you can omit calls to <code>cnd_init</code> and <code>cnd_destroy</code>.</p>
<h2><a id="post-32848-thread-specific-storage"></a>Thread Specific Storage</h2>
<p>Thread specific storage is provided via the <code>_Thread_local</code> (<code>thread_local</code> in C23) keyword, or via the <code>tss_</code> family of functions. <code>_Thread_local</code> works just like <code>__declspec(thread)</code> (see <a href="https://learn.microsoft.com/en-us/cpp/cpp/thread?view=msvc-170">docs</a>) and the <code>tss_</code> functions work similarly, but not identically, to the <code>Fls*</code> or <code>Tls*</code> family of functions.</p>
<pre class="prettyprint language-default"><code class="language-default">#include &lt;threads.h&gt; 
#include &lt;stdlib.h&gt; 
void dtor(void* dat) { 
    // not called in this program 
    abort(); 
} 
 
static tss_t t; 
 
int main(void) { 
    if(tss_create(&amp;t, dtor) != thrd_success) { 
        return 1; 
    } 
    if(tss_set(t, (void*)42) != thrd_success) { 
        return 1; 
    } 
    if(tss_get(t) != (void*)42) { 
        return 1; 
    } 
    return 0; 
} </code></pre>
<p>The C11 TSS facilities support <em>destructors</em> which are run when threads exit and are passed the value of the associated TSS key, if it is non-null. The macro <code>TSS_DTOR_ITERATIONS</code> specifies how many times we’ll check for more destructors to run in the case that a destructor calls <code>tss_set</code>. Currently it’s set to 1, however, if this is a problem for you let us know. Destructors are run from either <code>DllMain</code>, or from a TLS callback (if you use the static runtime), and are not run on process teardown. This is an important difference from FLS destructors which are run on process teardown and get run before any <code>DllMain</code> routines or TLS callbacks.</p>
<h3><a id="post-32848-Xfd8bf69ca5cd09bc517393a90eb8a3dbe850e6d"></a>TSS limits and performance characteristics</h3>
<p>When using the explicit <code>tss_</code> functions there is a limit of 1024 TSS indices per process, these are <em>not</em> the same indices used for the <code>Fls*</code> functions, the <code>Tls*</code> functions, or <code>_Thread_local</code> “implicit” TLS variables. If you use any <code>&lt;threads.h&gt;</code> functions (not just the TSS functions) <em>and</em> you use the static runtime then you will use at least one implicit TLS index (the ones used for <code>_Thread_local</code>), even if you don’t otherwise use implicit TLS. This is because we need to enable TLS callbacks, which causes the loader to allocate such an index. If this is a problem (for example because of the loader gymnastics that are required to dynamically load such modules) let us know, or just use the dynamic runtime. If you use the <code>tss_</code> functions then additionally you will use one dynamic TLS index (the same ones used by <code>TlsAlloc</code>), you will only use <em>one</em>, no matter how many <code>tss_t</code>s you create. Threads will only spend time processing TSS destructors at thread exit if a TSS index with an associated destructor was ever set on that thread. When you create the first <code>tss_t</code> a table of destructors is allocated and when you use <code>tss_set</code> for the first time on a particular thread a per-thread table is allocated. Memory usage scales with the number of threads that use the C11 TSS functionality, not the total number of threads in the process. The destructor table is 8KiB (4KiB on 32-bit platforms) and each per thread table is 8209 bytes (4105 bytes on 32-bit platforms). These performance and memory characteristics may change in the future.</p>
<h2><a id="post-32848-new-runtime-components"></a>New Runtime Components</h2>
<p>Because <code>&lt;threads.h&gt;</code> is a new feature and we want the implementation to be able to change and improve over time, it’s shipped as a new satellite DLL of vcruntime: <code>vcruntime140_threads.dll</code> and <code>vcruntime140_threadsd.dll</code>. If you use the dynamic version of the Visual C++ runtime (<code>/MD</code> or <code>/MDd</code>), and you use the new threads facilities, then you need to either redistribute this file with your app, or redistribute a Visual C++ runtime redist that is new enough to contain these files. If you don’t touch the C11 threads functionality then your app won’t depend on anything in this DLL and it will not be loaded at all.</p>
<h1><a id="post-32848-send-us-your-feedback"></a>Send us your feedback!</h1>
<p>Try out C11 threads in the <a href="https://visualstudio.microsoft.com/vs/preview/">latest Visual Studio preview</a> and share your thoughts with us in the comments below, on <a href="https://developercommunity.visualstudio.com/cpp">Developer Community</a>, on twitter (<a href="https://twitter.com/visualc">@VisualC</a>) or via email at visualcpp@microsoft.com.</p>
<p>&nbsp;</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/c11-threads-in-visual-studio-2022-version-17-8-preview-2/">C11 Threads in Visual Studio 2022 version 17.8 Preview 2</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/c11-threads-in-visual-studio-2022-version-17-8-preview-2/feed/</wfw:commentRss>
			<slash:comments>2</slash:comments>
		
		
			</item>
		<item>
		<title>MSVC Machine-Independent Optimizations in Visual Studio 2022 17.7</title>
		<link>https://devblogs.microsoft.com/cppblog/msvc-machine-independent-optimizations-in-visual-studio-2022-17-7/</link>
					<comments>https://devblogs.microsoft.com/cppblog/msvc-machine-independent-optimizations-in-visual-studio-2022-17-7/#comments</comments>
		
		<dc:creator><![CDATA[Troy Johnson]]></dc:creator>
		<pubDate>Mon, 25 Sep 2023 16:16:05 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<category><![CDATA[performance]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32856</guid>

					<description><![CDATA[<p>This blog post presents a selection of machine-independent optimizations that were added between Visual Studio versions 17.4 (released November 8, 2022) and 17.7 P3 (released July 11, 2023). Each optimization below shows assembly code for both X64 and ARM64 to show the machine-independent nature of the optimization.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/msvc-machine-independent-optimizations-in-visual-studio-2022-17-7/">MSVC Machine-Independent Optimizations in Visual Studio 2022 17.7</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>This blog post presents a selection of machine-independent optimizations that were added between Visual Studio versions 17.4 (released November 8, 2022) and 17.7 P3 (released July 11, 2023). Each optimization below shows assembly code for both X64 and ARM64 to show the machine-independent nature of the optimization.</p>
<h2 id="optimizing-memory-across-block-boundaries">Optimizing Memory Across Block Boundaries</h2>
<p>When a small struct is loaded into a register, we can optimize field accesses to extract the correct bits from the register instead of accessing it through memory. Historically in MSVC, this optimization has been limited to memory accesses within the same basic block. We are now able to perform this same optimization across block boundaries in many cases.</p>
<p>In the example ASM listings below, a load to the stack and a store from the stack are eliminated, resulting in less memory traffic as well as lower stack memory usage.</p>
<p><strong>Example C++ Source Code:</strong></p>
<pre class="prettyprint language-cpp"><code class="language-cpp">#include &lt;string_view&gt;

bool compare(const std::string_view&amp; l, const std::string_view&amp; r) {
   return l == r;
}</code></pre>
<p><strong>Required Compiler Flags:</strong> /O2</p>
<p><strong>X64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%; height: 56px;">
<tbody>
<tr style="height: 28px;">
<td style="width: 16.101%; height: 28px;">17.4</td>
<td style="width: 83.899%; height: 28px;">17.7</td>
</tr>
<tr style="height: 28px;">
<td style="width: 16.101%; height: 28px; vertical-align: top;">
<pre>sub        rsp, 56
movups     xmm0, XMMWORD PTR [rcx]
mov        r8, QWORD PTR [rcx+8]
movaps     XMMWORD PTR $T1[rsp], xmm0
cmp        r8, QWORD PTR [rdx+8]
jne        SHORT $LN9@compare
mov        rdx, QWORD PTR [rdx]
mov        rcx, QWORD PTR $T1[rsp]
call       memcmp
test       eax, eax
jne        SHORT $LN9@compare
mov        al, 1
add        rsp, 56
ret        0
$LN9@compare:
xor        al, al
add        rsp, 56
ret        0</pre>
</td>
<td style="width: 83.899%; height: 28px; vertical-align: top;">
<pre>sub         rsp, 40
mov         r8, QWORD PTR [rcx+8]
movups      xmm1, XMMWORD PTR [rcx]
cmp         r8, QWORD PTR [rdx+8]
jne         SHORT $LN9@compare
mov         rdx, QWORD PTR [rdx]
movq        rcx, xmm1
call        memcmp
test        eax, eax
jne         SHORT $LN9@compare
mov         al, 1
add         rsp, 40
ret         0
$LN9@compare:
xor         al, al
add         rsp, 40
ret         0</pre>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p><strong>ARM64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%; height: 56px;">
<tbody>
<tr style="height: 28px;">
<td style="width: 13.9125%; height: 28px;">17.4</td>
<td style="width: 86.0875%; height: 28px;">17.7</td>
</tr>
<tr style="height: 28px;">
<td style="width: 13.9125%; height: 28px; vertical-align: top;">
<pre>str         lr,[sp,#-0x10]!
sub         sp,sp,#0x20
ldr         q17,[x1]
ldr         q16,[x0]
umov        x8,v17.d[1]
umov        x2,v16.d[1]
stp         q17,q16,[sp]
cmp         x2,x8
bne         |$LN9@compare|
ldr         x1,[sp]
ldr         x0,[sp,#0x10]
bl          memcmp
cbnz        w0,|$LN9@compare|
mov         w0,#1
add         sp,sp,#0x20
ldr         lr,[sp],#0x10
ret
|$LN9@compare|
mov         w0,#0
add         sp,sp,#0x20
ldr         lr,[sp],#0x10
ret</pre>
</td>
<td style="width: 86.0875%; height: 28px; vertical-align: top;">
<pre>str         lr,[sp,#-0x10]!
ldr         q17,[x1]
ldr         q16,[x0]
umov        x8,v17.d[1]
umov        x2,v16.d[1]
cmp         x2,x8
bne         |$LN9@compare|
fmov        x1,d17
fmov        x0,d16
bl          memcmp
cbnz        w0,|$LN9@compare|
mov         w0,#1
ldr         lr,[sp],#0x10
ret
|$LN9@compare|
mov         w0,#0
ldr         lr,[sp],#0x10
ret</pre>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2 id="vector-logical-and-arithmetic-optimizations">Vector Logical and Arithmetic Optimizations</h2>
<p>We continue to add patterns for recognizing vector operations that are equivalent to intrinsics or short sequences of intrinsics. An example is recognizing common forms of vector absolute difference calculations. A long series of bitwise instructions can be replaced with specialized absolute value instructions, such as vpabsd on X64 and sabd on ARM64.</p>
<p><strong>Example C++ Source Code:</strong></p>
<pre>#include &lt;cstdint&gt;

void s32_1(int * __restrict a, int * __restrict b, int * __restrict c, int n) {
    for (int i = 0; i &lt; n; i++) {
        a[i] = (b[i] - c[i]) &gt; 0 ? (b[i] - c[i]) : (c[i] - b[i]);
    }
}</pre>
<p><strong>Required Flags: /O2 /arch:AVX for X64, /O2 for ARM64</strong></p>
<p><strong>X64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 21.7285%;">17.4</td>
<td style="width: 78.2715%;">17.7</td>
</tr>
<tr>
<td style="width: 21.7285%; vertical-align: top;">
<pre>$LL4@s32_1:
movdqu    xmm0, XMMWORD PTR [r11+rax]
add       ecx, 4
movdqu    xmm1, XMMWORD PTR [rax]
lea       rax, QWORD PTR [rax+16]
movdqa    xmm3, xmm0
psubd     xmm3, xmm1
psubd     xmm1, xmm0
movdqa    xmm2, xmm3
pcmpgtd   xmm2, xmm4
movdqa    xmm0, xmm2
andps     xmm2, xmm3
andnps    xmm0, xmm1
orps      xmm0, xmm2
movdqu    XMMWORD PTR [r10+rax-16], xmm0
cmp       ecx, edx
jl        SHORT $LL4@s32_1</pre>
</td>
<td style="width: 78.2715%; vertical-align: top;">
<pre>$LL4@s32_1:
vmovdqu    xmm1, XMMWORD PTR [r10+rax]
vpsubd     xmm1, xmm1, XMMWORD PTR [rax]
<strong>vpabsd</strong>     <strong>xmm2, xmm1    ; vector abs</strong>
add        edx, 4
vmovdqu    XMMWORD PTR [rbx+rax], xmm2
lea        rax, QWORD PTR [rax+16]
cmp        edx, ecx
jl         SHORT $LL4@s32_1</pre>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p><strong>ARM64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%; height: 56px;">
<tbody>
<tr style="height: 28px;">
<td style="width: 18.7807%; height: 28px;">17.4</td>
<td style="width: 81.2193%; height: 28px;">17.7</td>
</tr>
<tr style="height: 28px;">
<td style="width: 18.7807%; height: 28px; vertical-align: top;">
<pre>|$LL24@s32_1|
sbfiz       x9,x8,#2,#0x20
ldr         q19,[x9,x2]
add         w8,w8,#4
ldr         q18,[x9,x1]
cmp         w8,w10
sub         v16.4s,v18.4s,v19.4s
cmgt        v17.4s,v16.4s,v21.4s
and         v20.16b,v17.16b,v16.16b
sub         v16.4s,v19.4s,v18.4s
bic         v16.16b,v16.16b,v17.16b
orr         v16.16b,v16.16b,v20.16b
str         q16,[x9,x0]
blt         |$LL24@s32_1|
cmp         w8,w3
bge         |$LN27@s32_1|</pre>
</td>
<td style="width: 81.2193%; height: 28px; vertical-align: top;">
<pre>|$LL24@s32_1|
sbfiz       x9,x8,#2,#0x20
ldr         q17,[x9,x1]
add         w8,w8,#4
ldr         q16,[x9,x2]
cmp         w8,w10
<strong>sabd        v16.4s,v17.4s,v16.4s</strong>     <strong>; vector abs</strong>
str         q16,[x9,x0]
blt         |$LL24@s32_1|</pre>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2 id="vector-remainder-loops">Vector Remainder Loops</h2>
<p>Each iteration of a vectorized loop computes the same work as multiple iterations of the original scalar loop. Depending on the number of original scalar iterations and the vector width, there may be work left over when the vector loop ends. Although this work can be completed by a copy of the original scalar loop, it may contain sufficient work to warrant further vectorization using a smaller vector width. This optimization is now employed for targets that have a single vector width by partially packing a vector.</p>
<p>In the example below, three loops are emitted for the original loop. The first processes 64 elements per vector iteration by packing 16 8-bit values into a 128-bit vector register and then unrolling the vector loop by four. The second loop processes 8 elements per vector iteration by packing 8 8-bit values into half of a 128-bit vector register. The third loop processes one element per scalar iteration.</p>
<p><strong>Example C++ source code: </strong></p>
<pre>#include &lt;cstdint&gt;

void test(int8_t * __restrict d, int8_t * __restrict a, int8_t * __restrict b, int n) {
    for (int i = 0; i &lt; n; i++) {
        d[i] = a[i] &amp; (~b[i]);
    }
}</pre>
<p><strong>Required compiler flags: </strong>/O2</p>
<p><strong>X64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%; height: 1729px;">
<tbody>
<tr style="height: 28px;">
<td style="width: 28.8298%; height: 28px;">17.4</td>
<td style="width: 71.1702%; height: 28px;">17.7</td>
</tr>
<tr style="height: 1701px;">
<td style="width: 28.8298%; vertical-align: top; height: 1701px;">
<pre>$LL4@test: ; 1<sup>st</sup> vector loop (64 element iters)
movdqu  xmm0, XMMWORD PTR [rcx-16]
add     edi, 64         ; 00000040H
movdqu  xmm1, XMMWORD PTR [rdx+rcx-16]
movdqu  xmm2, XMMWORD PTR [rdx+rcx]
lea     rcx, QWORD PTR [rcx+64]
pandn   xmm1, xmm3
lea     rax, QWORD PTR [r14+rcx]
pand    xmm1, xmm0
pandn   xmm2, xmm3
movdqu  xmm0, XMMWORD PTR [rcx-64]
movdqu  XMMWORD PTR [r9+rcx-80], xmm1
pand    xmm2, xmm0
movdqu  xmm0, XMMWORD PTR [rcx-48]
movdqu  xmm1, XMMWORD PTR [rdx+rcx-48]
movdqu  XMMWORD PTR [r9+rcx-64], xmm2
pandn   xmm1, xmm3
pand    xmm1, xmm0
movdqu  xmm2, XMMWORD PTR [rdx+rcx-32]
movdqu  xmm0, XMMWORD PTR [rcx-32]
pandn   xmm2, xmm3
pand    xmm2, xmm0
movdqu  XMMWORD PTR [r9+rcx-48], xmm1
movdqu  XMMWORD PTR [r9+rcx-32], xmm2
cmp     rax, rsi
jl      SHORT $LL4@test
mov     r14, QWORD PTR [rsp]
mov     rsi, QWORD PTR [rsp+24]
$LN9@test:
movsxd  rcx, edi
mov     rdx, rbx
mov     rdi, QWORD PTR [rsp+32]
mov     rbx, QWORD PTR [rsp+16]
cmp     rcx, rdx
jge     SHORT $LN3@test
sub     r8, r11
lea     rax, QWORD PTR [rcx+r11]
sub     r10, r11
sub     rdx, rcx
$LL8@test: ; Scalar loop (1 element iters)
movzx   ecx, BYTE PTR [rax+r8]
lea     rax, QWORD PTR [rax+1]
not     cl
and     cl, BYTE PTR [rax-1]
mov     BYTE PTR [rax+r10-1], cl
sub     rdx, 1
jne     SHORT $LL8@test
$LN3@test:
add     rsp, 8
ret     0</pre>
</td>
<td style="width: 71.1702%; vertical-align: top; height: 1701px;">
<pre>$LL4@test: <strong>; 1<sup>st</sup> vector loop (64 element iters)</strong>
movdqu    xmm0, XMMWORD PTR [rcx-16]
add       edx, 64          ; 00000040H
movdqu    xmm1, XMMWORD PTR [r8+rcx-16]
movdqu    xmm2, XMMWORD PTR [r8+rcx]
lea       rcx, QWORD PTR [rcx+64]
andnps    xmm1, xmm3
lea       rax, QWORD PTR [rsi+rcx]
andps     xmm1, xmm0
andnps    xmm2, xmm3
movdqu    xmm0, XMMWORD PTR [rcx-64]
movdqu    XMMWORD PTR [r9+rcx-80], xmm1
andps     xmm2, xmm0
movdqu    xmm0, XMMWORD PTR [rcx-48]
movdqu    xmm1, XMMWORD PTR [r8+rcx-48]
movdqu    XMMWORD PTR [r9+rcx-64], xmm2
andnps    xmm1, xmm3
andps     xmm1, xmm0
movdqu    xmm2, XMMWORD PTR [r8+rcx-32]
movdqu    xmm0, XMMWORD PTR [rcx-32]
andnps    xmm2, xmm3
andps     xmm2, xmm0
movdqu    XMMWORD PTR [r9+rcx-48], xmm1
movdqu    XMMWORD PTR [r9+rcx-32], xmm2
cmp       rax, rbp
jl        SHORT $LL4@test
mov       rbp, QWORD PTR [rsp+16]
mov       eax, edi
and       al, 63    ; 0000003fH
cmp       al, 8
jb        SHORT $LN27@test
$LN11@test:
mov       ecx, edi
movsxd    rax, edx
and       ecx, -8
movsxd    rsi, ecx
lea       rcx, QWORD PTR [rax+r10]
$LL10@test:          <strong>; 2<sup>nd</sup> vector loop (8 element iters)</strong>
movq      xmm1, QWORD PTR [r8+rcx]
add       edx, 8
movq      xmm0, QWORD PTR [rcx]
andnps    xmm1, xmm3
andps     xmm1, xmm0
movq      QWORD PTR [r9+rcx], xmm1
add       rcx, 8
mov       rax, rcx
sub       rax, r10
cmp       rax, rsi
jl        SHORT $LL10@test
$LN27@test:
mov       rsi, QWORD PTR [rsp+24]
$LN9@test:
movsxd    rcx, edx
mov       rdx, rdi
mov       rdi, QWORD PTR [rsp+32]
cmp       rcx, rdx
jge       SHORT $LN3@test
sub       r11, r10
lea       rax, QWORD PTR [rcx+r10]
sub       rbx, r10
sub       rdx, rcx
npad      6
$LL8@test:            <strong>; Scalar loop (1 element iters)</strong>
movzx     ecx, BYTE PTR [rax+r11]
lea       rax, QWORD PTR [rax+1]
not       cl
and       cl, BYTE PTR [rax-1]
mov       BYTE PTR [rax+rbx-1], cl
sub       rdx, 1
jne       SHORT $LL8@test
$LN3@test:
pop       rbx
ret       0</pre>
</td>
</tr>
</tbody>
</table>
<p><strong>ARM64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 28.8298%;">17.4 (was not vectorized)</td>
<td style="width: 71.1702%;">17.7</td>
</tr>
<tr>
<td style="width: 28.8298%; vertical-align: top;">
<pre>|$LL4@test|
ldrsb       w9,[x10,x1]
sub         w3,w3,#1
ldrsb       w8,[x1]
bic         w8,w8,w9
strb        w8,[x11,x1]
add         x1,x1,#1
cbnz        w3,|$LL4@test|
|$LN3@test|
ret</pre>
</td>
<td style="width: 71.1702%; vertical-align: top;">
<pre>|$LL27@test|  <strong>; 1<sup>st</sup> vector loop (64 element iters)</strong>
ldr         q17,[x2,w8 sxtw #0]
sxtw        x11,w8
ldr         q16,[x1,w8 sxtw #0]
add         x10,x11,#0x10
bic         v16.16b,v16.16b,v17.16b
ldr         q17,[x10,x2]
str         q16,[x0,w8 sxtw #0]
ldr         q16,[x10,x1]
add         w8,w8,#0x40
cmp         w8,w9
bic         v16.16b,v16.16b,v17.16b
str         q16,[x10,x0]
add         x10,x11,#0x20
ldr         q17,[x10,x2]
ldr         q16,[x10,x1]
bic         v16.16b,v16.16b,v17.16b
str         q16,[x10,x0]
add         x10,x11,#0x30
ldr         q17,[x10,x2]
ldr         q16,[x10,x1]
bic         v16.16b,v16.16b,v17.16b
str         q16,[x10,x0]
blt         |$LL27@test|
and         w9,w3,#0x3F
cmp         w9,#8
blo         |$LN30@test|
|$LN11@test|
and         w9,w3,#0xFFFFFFF8
|$LL29@test|  <strong>; 2<sup>nd</sup> vector loop (8 element iters)</strong>
ldr         d17,[x2,w8 sxtw #0]
ldr         d16,[x1,w8 sxtw #0]
bic         v16.8b,v16.8b,v17.8b
str         d16,[x0,w8 sxtw #0]
add         w8,w8,#8
cmp         w8,w9
blt         |$LL29@test|
|$LN30@test|
cmp         w8,w3
bge         |$LN32@test|
|$LN21@test|
add         x9,x1,w8,sxtw #0
sub         x13,x2,x1
sub         w8,w3,w8
sub         x10,x0,x1
|$LL31@test|  <strong>; Scalar loop (1 element iters)</strong>
ldrsb       w12,[x13,x9]
sub         w8,w8,#1
ldrsb       w11,[x9]
bic         w11,w11,w12
strb        w11,[x10,x9]
add         x9,x9,#1
cbnz        w8,|$LL31@test|
|$LN32@test|
ret</pre>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2 id="conditional-moves-selects">Conditional Moves/Selects</h2>
<p>MSVC now considers more opportunities to use conditional move instructions to eliminate branches. Once such an opportunity is recognized, whether to use a conditional move or leave the branch intact is subject to legality checks and tuning heuristics. Eliminating a branch is often beneficial because it removes the possibility of the branch being mispredicted and may enable other optimizations that previously would have stopped at the block boundary formed by the branch. Nevertheless, it does convert a control dependence that could be correctly predicted into a data dependence that cannot be removed.</p>
<p>This optimization applies only when the compiler can prove that it is safe to unconditionally perform a store because the instruction will always store one of two possible values instead of only performing a store when the condition is true. There are numerous reasons why an unconditional store may be unsafe. For example, if the memory location is shared, then another thread may observe a store when previously there was no store to observe. As another example, the condition may have protected a store through a potentially null pointer.</p>
<p>The optimization is enabled for X64 as well as ARM64. (<a href="https://devblogs.microsoft.com/oldnewthing/20220817-00/?p=106998">ARM64 conditional execution</a> was discussed in a previous blog post.)</p>
<p><strong>Example C++ source code: </strong></p>
<pre>int test(int a, int i) {
    int mem[4]{0};
    if (mem[i] &lt; a) {
        mem[i] = a;
    }
    return mem[0];
}</pre>
<p><strong>Required compiler flags: </strong>/O2 (for the sake of simplifying the example output, /GS- was also passed)</p>
<p><strong>X64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 22.8897%;">17.4</td>
<td style="width: 77.1103%;">17.7</td>
</tr>
<tr>
<td style="width: 22.8897%; vertical-align: top;">
<pre>$LN6:
sub     rsp, 24
movsxd  rax, edx
xorps   xmm0, xmm0
movups  XMMWORD PTR mem$[rsp], xmm0
cmp     DWORD PTR mem$[rsp+rax*4], ecx
jge     SHORT $LN4@test
mov     DWORD PTR mem$[rsp+rax*4], ecx
$LN4@test:
mov     eax, DWORD PTR mem$[rsp]
add     rsp, 24
ret     0</pre>
</td>
<td style="width: 77.1103%;">
<pre>$LN5:
sub      rsp, 24
movsxd   rax, edx
xorps    xmm0, xmm0
movups   XMMWORD PTR mem$[rsp], xmm0
lea      rdx, QWORD PTR mem$[rsp]
cmp      DWORD PTR [rdx+rax*4], ecx
lea      rdx, QWORD PTR [rdx+rax*4]
<strong>cmovge</strong>   <strong>ecx, DWORD PTR [rdx] ; cond</strong>
mov      DWORD PTR [rdx], ecx
mov      eax, DWORD PTR mem$[rsp]
add      rsp, 24
ret      0</pre>
</td>
</tr>
</tbody>
</table>
<p><strong>ARM64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 23.0683%;">17.4</td>
<td style="width: 76.9317%;">17.7</td>
</tr>
<tr>
<td style="width: 23.0683%; vertical-align: top;">
<pre>|$LN5|
sub         sp,sp,#0x10
movi        v16.16b,#0
mov         x9,sp
str         q16,[sp]
ldr         w8,[x9,w1 sxtw #2]
cmp         w8,w0
bge         |$LN2@test|
str         w0,[x9,w1 sxtw #2]
|$LN2@test|
ldr         w0,[sp]
add         sp,sp,#0x10
ret</pre>
</td>
<td style="width: 76.9317%; vertical-align: top;">
<pre>|$LN9|
sub         sp,sp,#0x10
movi        v16.16b,#0
mov         x9,sp
str         q16,[sp]
ldr         w8,[x9,w1 sxtw #2]
cmp         w8,w0
<strong>cselge      w8,w8,w0</strong>
str         w8,[x9,w1 sxtw #2]
ldr         w0,[sp]
add         sp,sp,#0x10
ret</pre>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2 id="loop-optimizations-for-array-assignments-and-copies">Loop Optimizations for Array Assignments and Copies</h2>
<p>The optimizer now recognizes more cases where an assignment/copy to contiguous memory can be raised to memset/memcopy intrinsics and lowered to more efficient instruction sequences. For example, consider the following array-assignment in a count-down loop.</p>
<p><strong>Example C++ Source Code:</strong></p>
<pre>    char c[1024];

    for (int n = 1023; n; n--)
        c[n] = 1;</pre>
<p>Previously, the code generated was a loop with individual byte-assignments. Now, more efficient wider assignments are performed via block-copy libraries or vector instructions.</p>
<p><strong>X64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 30.3037%;">17.4</td>
<td style="width: 69.6963%;">17.7</td>
</tr>
<tr>
<td style="width: 30.3037%; vertical-align: top;">
<pre>mov         QWORD PTR __$ArrayPad$[rsp], rax
mov         eax, 1023
npad        2
$LL4@copy_while:
mov         BYTE PTR c$[rsp+rax], 1
sub         rax, 1
jne         SHORT $LL4@copy_while</pre>
</td>
<td style="width: 69.6963%;">
<pre>vmovaps  zmm0, ZMMWORD PTR __zmm@01010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
vmovq    rdx, xmm0
lea      rax, QWORD PTR c$[rsp+1]
mov      ecx, 7
npad     14
$LL11@copy_while:
vmovups  ZMMWORD PTR [rax], zmm0
vmovups  YMMWORD PTR [rax+64], ymm0
vmovups  XMMWORD PTR [rax+96], xmm0
lea      rax, QWORD PTR [rax+128]
vmovups  XMMWORD PTR [rax-16], xmm0
sub      rcx, 1
jne      SHORT $LL11@copy_whilevmovups  ZMMWORD PTR [rax], zmm0
vmovups  YMMWORD PTR [rax+64], ymm0
vmovups  XMMWORD PTR [rax+96], xmm0
mov      QWORD PTR [rax+112], rdx
mov      DWORD PTR [rax+120], edx
mov      WORD PTR [rax+124], dx
mov      BYTE PTR [rax+126], dl</pre>
</td>
</tr>
</tbody>
</table>
<p><strong>ARM64 ASM:</strong></p>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 30.5717%;">17.4</td>
<td style="width: 69.4283%;">17.7</td>
</tr>
<tr>
<td style="width: 30.5717%; vertical-align: top;">
<pre>mov         x8,#0x3FF
mov         x9,sp
mov         w10,#1|$LL4@copy_while|
strb        w10,[x8,x9]
sub         x8,x8,#1
cbnz        x8,|$LL4@copy_while|</pre>
</td>
<td style="width: 69.4283%; vertical-align: top;">
<pre>add         x0,sp,#1
mov         x2,#0x3FF
mov         w1,#1
bl          memset</pre>
</td>
</tr>
</tbody>
</table>
<h2 id="summary">Summary</h2>
<p>We would like to thank everyone for giving us feedback and we are looking forward to hearing more from you.  Please share your thoughts and comments with us through <a href="https://developercommunity.visualstudio.com/home">Developer Community</a>. You can also reach us on Twitter (<a href="https://twitter.com/visualc" target="_blank" rel="noopener">@VisualC</a>), or via email at <a href="mailto:visualcpp@microsoft.com">visualcpp@microsoft.com</a>.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/msvc-machine-independent-optimizations-in-visual-studio-2022-17-7/">MSVC Machine-Independent Optimizations in Visual Studio 2022 17.7</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/msvc-machine-independent-optimizations-in-visual-studio-2022-17-7/feed/</wfw:commentRss>
			<slash:comments>9</slash:comments>
		
		
			</item>
		<item>
		<title>Enhancing the CMake Targets View in Visual Studio</title>
		<link>https://devblogs.microsoft.com/cppblog/enhancing-the-cmake-targets-view-in-visual-studio/</link>
					<comments>https://devblogs.microsoft.com/cppblog/enhancing-the-cmake-targets-view-in-visual-studio/#comments</comments>
		
		<dc:creator><![CDATA[Sinem Akinci]]></dc:creator>
		<pubDate>Wed, 20 Sep 2023 17:28:56 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<category><![CDATA[CMake]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32833</guid>

					<description><![CDATA[<p>The CMake Targets View in Visual Studio is a view that allows you to visualize your CMake project structure by the CMake targets and build specified target libraries and executables. To make this view more usable, we have implemented a few new improvements to make it easier than ever to navigate your CMake targets.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/enhancing-the-cmake-targets-view-in-visual-studio/">Enhancing the CMake Targets View in Visual Studio</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>The CMake Targets View in Visual Studio is a view that allows you to visualize your CMake project structure by the CMake targets and build specified target libraries and executables. To make this view more usable, we have implemented a few new improvements to make it easier than ever to navigate your CMake targets. This includes improved navigation to the CMake Targets View, a new, more simplified CMake Targets View, and the ability to exclude specified CMake items from the Targets View. Additionally, we have future planned work in the near-term to allow users to customize this view to their desired configuration. <a href="https://visualstudio.microsoft.com/vs/preview/" target="_blank" rel="noopener">Download the latest preview version of Visual Studio</a> to try out the new updates for the CMake Targets View.</p>
<h3 id="get-to-your-cmake-targets-view-quicker-than-ever">Get to your CMake Targets View Quicker Than Ever</h3>
<p>Customers have reported that it can be cumbersome to switch between CMake Targets View and the Solution Explorer. To address this, we have implemented new entry points to open the CMake Targets View much more quickly.</p>
<h5 id="switch-to-your-cmake-targets-view-from-solution-explorer"><em>Switch to your CMake Targets View from Solution Explorer</em></h5>
<p>Now, you can right-click anywhere in your Solution Explorer and simply navigate to the CMake Targets View from the context menu.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Switch-to-CMake-Targets-View.png"><img decoding="async" class="size-full wp-image-32834 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Switch-to-CMake-Targets-View.png" alt="Right-Click Context Menu to Switch To CMake Targets View" width="1008" height="900" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Switch-to-CMake-Targets-View.png 1008w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Switch-to-CMake-Targets-View-300x268.png 300w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Switch-to-CMake-Targets-View-768x686.png 768w" sizes="(max-width: 1008px) 100vw, 1008px" /></a></p>
<h5 id="open-the-cmake-targets-view-from-the-view-dropdown-menu"><em>Open the CMake Targets View from the &#8216;View&#8217; Dropdown Menu</em></h5>
<p>You can also access the CMake Targets View globally at any point in your CMake projects by selecting from the View dropdown.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/cmake-targets-dropdown.png"><img decoding="async" class="size-large wp-image-32836 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/cmake-targets-dropdown-361x1024.png" alt="The CMake Targets View option in the View dropdown in Visual Studio" width="361" height="1024" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/cmake-targets-dropdown-361x1024.png 361w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/cmake-targets-dropdown-106x300.png 106w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/cmake-targets-dropdown.png 390w" sizes="(max-width: 361px) 100vw, 361px" /></a></p>
<h3 id="simplify-your-source-navigation">Simplify your Source Navigation</h3>
<p>The CMake Targets View has been further simplified so that users don&#8217;t have to click through folders without buildable executables to get to their desired target.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Simplified-CMake-Targets-View-1.png"><img decoding="async" class="alignnone size-full wp-image-32838" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Simplified-CMake-Targets-View-1.png" alt="Simplified CMake Targets View navigation" width="858" height="991" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Simplified-CMake-Targets-View-1.png 858w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Simplified-CMake-Targets-View-1-260x300.png 260w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Simplified-CMake-Targets-View-1-768x887.png 768w" sizes="(max-width: 858px) 100vw, 858px" /></a></p>
<p>&nbsp;</p>
<h3 id="define-items-to-exclude-from-view">Define Items to Exclude from View</h3>
<p>You can now define in your VSWorkspaceSettings.json items to exclude from the CMake Targets View using the new <code>CMakeTargetsViewExcludedItems</code> field. The <code>CMakeTargetsViewExcludedItems</code> field is an array of strings. The field supports the following syntax and identifiers:</p>
<p><span style="text-decoration: underline;">Supported &#8220;identifiers&#8221;</span><strong>:</strong><code> CMakeProject</code>, <code>CMakeTarget</code>, <code>CMakeReference</code>,<code> CMakeFolder</code>, <code>CMakeFile</code>.</p>
<p><span style="text-decoration: underline;">Syntax for the <code>CMakeTargetsViewExcludedItems</code> is the following</span>: <code>&lt;identifier&gt;:&lt;name&gt;</code></p>
<p><code></code><code></code><code></code><code></code>This will specify any identifier with the specified name.</p>
<ul>
<li>For example, <code>CMakeTarget:app</code>. Any CMake targets with the name &#8220;app&#8221; anywhere in the CMake Targets View will be excluded.</li>
</ul>
<p>Additionally, if you want to specify specific items to be excluded, you can use a<code> - </code>to chain declarations together:<code>&lt;identifier&gt;:&lt;name&gt;-&lt;identifier&gt;:&lt;name&gt;...</code></p>
<ul>
<li>For example, <code>CMakeProject:thirdPartyDependency-CMakeTarget:irrelevantThirdParty</code>.</li>
</ul>
<p>Example usage in a VSWorkspaceSettings.json:</p>
<pre><code>{</code> <code>  "CMakeTargetsViewExcludedItems": [</code> <code>    "CMakeTarget:&lt;name&gt;-CMakeFile:*", "CMakeTarget&lt;name&gt;-*-CMakeFile:*", "CMakeTarget:&lt;name&gt;-*-*-CMakeFile:*"</code> <code>}</code></pre>
<h3 id="whats-coming-next">What’s Coming Next?</h3>
<p>We are continuing to develop the CMake Targets View to allow for further customization of this view based on customer feedback. Stay tuned for the latest updates as these ship in the future!</p>
<ol>
<li>We are planning to give users the ability to filter their CMake Targets view by type of target, project, etc.</li>
<li>Users will be able to dynamically pin and unpin their most used targets to the top of the CMake Targets View.</li>
</ol>
<p>We are using this suggestion ticket to track any other requests you may have for improvements to the CMake Targets View to meet your CMake needs: <a href="https://developercommunity.visualstudio.com/t/CMake-Targets-View-Suggestions/10471305">CMake Targets View Suggestions &#8211; Developer Community (visualstudio.com)</a></p>
<h3 id="anything-else">Anything else?</h3>
<p>You can also find us on Twitter (<a href="https://twitter.com/visualc" target="_blank" rel="noopener">@VisualC</a>) or via email at <a href="mailto:visualcpp@microsoft.com">visualcpp@microsoft.com</a>. To open a bug, please see <a href="https://developercommunity.visualstudio.com/report?space=8&amp;entry=problem" target="_blank" rel="noopener">Visual Studio Feedback</a>.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/enhancing-the-cmake-targets-view-in-visual-studio/">Enhancing the CMake Targets View in Visual Studio</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/enhancing-the-cmake-targets-view-in-visual-studio/feed/</wfw:commentRss>
			<slash:comments>2</slash:comments>
		
		
			</item>
		<item>
		<title>What’s New for the Remote File Explorer in Visual Studio</title>
		<link>https://devblogs.microsoft.com/cppblog/whats-new-for-the-remote-file-explorer-in-visual-studio/</link>
					<comments>https://devblogs.microsoft.com/cppblog/whats-new-for-the-remote-file-explorer-in-visual-studio/#comments</comments>
		
		<dc:creator><![CDATA[Sinem Akinci]]></dc:creator>
		<pubDate>Mon, 18 Sep 2023 19:05:55 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<category><![CDATA[Linux]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32819</guid>

					<description><![CDATA[<p>The Remote File Explorer gives you the capability to access your files and folders on your remote machines that you are connected to through the Connection Manager in Visual Studio, without having to leave the IDE. Since we last spoke, the team has implemented new features to further enhance your remote file workflows by listening to your direct feedback. </p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/whats-new-for-the-remote-file-explorer-in-visual-studio/">What’s New for the Remote File Explorer in Visual Studio</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>The Remote File Explorer gives you the capability to access your files and folders on your remote machines that you are connected to through the Connection Manager in Visual Studio, without having to leave the IDE. Since we last spoke, the team has implemented new features to further enhance your remote file workflows by listening to your direct feedback.  <a href="https://visualstudio.microsoft.com/vs/preview/">Download the latest preview version of Visual Studio</a> to access the new updates for the Remote File Explorer and give it a try.<a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE.png"><img decoding="async" class=" wp-image-32820 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE.png" alt="A view of the Remote File Explorer in Visual Studio" width="500" height="543" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE.png 628w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-276x300.png 276w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<h3 id="background">Background</h3>
<p>To access the Remote File Explorer, navigate to <em>View &gt; Remote File Explorer</em> after downloading through the Linux and Embedded Workflow in Visual Studio. It will also now automatically open when you open a cross-platform C++ project (vcxproj for Linux or CMake project with at least one configuration in CMake Presets with a remote SSH target).</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Selection.png"><img decoding="async" class="size-full wp-image-32821 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Selection.png" alt="Select Remote File Explorer for Linux from the Linux and Embedded workload to download the Remote File Explorer" width="1708" height="826" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Selection.png 1708w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Selection-300x145.png 300w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Selection-1024x495.png 1024w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Selection-768x371.png 768w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Selection-1536x743.png 1536w" sizes="(max-width: 1708px) 100vw, 1708px" /></a></p>
<p>Our initial announcement can be viewed <a href="https://devblogs.microsoft.com/cppblog/view-files-on-your-remote-machines-using-the-new-remote-file-explorer-in-visual-studio/">here</a>, which goes into browsing, uploading, and downloading files. To learn more about how to connect to a remote machine through the Connection manager, please see <a href="https://learn.microsoft.com/en-us/cpp/linux/connect-to-your-remote-linux-computer?view=msvc-170">these instructions</a>.</p>
<p>Now, you can view and edit these files from Visual Studio, as well as search for files through the top bar. Additionally, with the new enhanced toolbar, you are more empowered than ever to quickly perform actions on your files.</p>
<h3 id="search-your-files">Search your Files</h3>
<p>You can now search through your files and folders on your remote machine using the top bar in the Remote File Explorer. After searching, you can then right-click on any result and select “Go to remote path” to then navigate to that result’s remote path location in the Remote File Explorer.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/ezgif-3-55861c14f1.gif"><img decoding="async" class="alignnone size-full wp-image-32867" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/ezgif-3-55861c14f1.gif" alt="a GIF of searching your files" width="916" height="829" /></a></p>
<h3 id="view-and-edit-your-files">View and Edit your Files</h3>
<p>The Remote File Explorer now allows you to view and edit files on your remote machine from Visual Studio, just like you would any other file in the Solution Explorer.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFEgif.gif"><img decoding="async" class="alignnone wp-image-32828" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFEgif.gif" alt="Image RFEgif" width="1027" height="549" /></a></p>
<p>The Remote File Explorer will also automatically detect if your remote files have any changes that occurred so that you can be certain when in remote workflows.</p>
<h3 id="home-and-settings-icons">Home and Settings Icons</h3>
<p>New icons have been added to the toolbar of the Remote File Explorer to make it easier than ever to navigate and perform actions.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Home-and-Settings-Icons.png"><img decoding="async" class="size-full wp-image-32824 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Home-and-Settings-Icons.png" alt="The new Home and Settings Icons in the Remote File Explorer" width="1252" height="529" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Home-and-Settings-Icons.png 1252w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Home-and-Settings-Icons-300x127.png 300w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Home-and-Settings-Icons-1024x433.png 1024w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Home-and-Settings-Icons-768x324.png 768w" sizes="(max-width: 1252px) 100vw, 1252px" /></a></p>
<p>Clicking the home icon quickly navigates the user back to the $HOME directory of the currently logged in user. Clicking on the settings icon opens the Remote File Explorer settings that allows you to configure your Remote File Explorer.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Settings.png"><img decoding="async" class="size-full wp-image-32825 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Settings.png" alt="A view of the Remote File Explorer settings" width="730" height="497" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Settings.png 730w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/RFE-Settings-300x204.png 300w" sizes="(max-width: 730px) 100vw, 730px" /></a></p>
<h3 id="whats-next">What&#8217;s Next?</h3>
<p>To improve your end-to-end remote workflows, we are planning to further integrate this feature with the Integrated Terminal and other potential remote workflows. We would love to hear from you how you would use this feature to further shape our backlog and other planned enhancements. Please reach out to us via email if you would like to chat or we have an open feedback ticket <a href="https://developercommunity.visualstudio.com/t/Remote-File-SSH-Explorer-Suggestions/10262117?space=8&amp;entry=suggestion">here</a>.</p>
<h3 id="send-us-more-feedback">Send us more feedback!</h3>
<p>We hope the latest updates to the Remote File Explorer will further empower you in your remote workflows. Please let us know your thoughts and any other ideas you may have for the feature. The comments below are open and we also have a <a href="https://developercommunity.visualstudio.com/t/Remote-File-SSH-Explorer-Suggestions/10262117?space=8&amp;entry=suggestion">Visual Studio Feedback ticket</a> open to track any requests that you can comment on. You can also find us on Twitter (<a href="https://twitter.com/visualc">@VisualC</a>) or via email at <a href="mailto:visualcpp@microsoft.com">visualcpp@microsoft.com</a>. To open a bug, please see <a href="https://developercommunity.visualstudio.com/report?space=8&amp;entry=problem">Visual Studio Feedback</a>.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/whats-new-for-the-remote-file-explorer-in-visual-studio/">What’s New for the Remote File Explorer in Visual Studio</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/whats-new-for-the-remote-file-explorer-in-visual-studio/feed/</wfw:commentRss>
			<slash:comments>3</slash:comments>
		
		
			</item>
		<item>
		<title>Make Member Function const and Global Function Static in Visual Studio</title>
		<link>https://devblogs.microsoft.com/cppblog/make-member-function-const-and-global-function-static-in-visual-studio/</link>
					<comments>https://devblogs.microsoft.com/cppblog/make-member-function-const-and-global-function-static-in-visual-studio/#respond</comments>
		
		<dc:creator><![CDATA[Mryam Girmay]]></dc:creator>
		<pubDate>Thu, 14 Sep 2023 17:21:05 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32787</guid>

					<description><![CDATA[<p>We are delighted to announce that Visual Studio Preview now includes the &#8220;Make Member Function Const&#8221; and &#8220;Make Global Function Static&#8221; features. To check out these features, make sure you update to the latest version of Visual Studio Preview. <br />
Make Member Function Const<br />
Visual Studio now generates hints to mark member functions as const when a member function doesn&#8217;t modify the object&#8217;s state.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/make-member-function-const-and-global-function-static-in-visual-studio/">Make Member Function const and Global Function Static in Visual Studio</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p><span class="TextRun SCXW28857402 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW28857402 BCX8" data-ccp-parastyle="Normal (Web)">We are delighted to announce that Visual Studio Preview now includes the &#8220;Make Member Function Const&#8221; and &#8220;Make Global Function Static&#8221; features. To check out these features, make sure you update to the latest version of </span></span><a class="Hyperlink SCXW28857402 BCX8" href="https://visualstudio.microsoft.com/vs/preview/" target="_blank" rel="noreferrer noopener"><span class="TextRun Underlined SCXW28857402 BCX8" data-contrast="none"><span class="NormalTextRun SCXW28857402 BCX8" data-ccp-charstyle="Hyperlink">Visual Studio Preview</span></span></a><span class="TextRun SCXW28857402 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW28857402 BCX8" data-ccp-parastyle="Normal (Web)">.</span></span><span class="EOP SCXW28857402 BCX8" data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:false,&quot;201341983&quot;:0,&quot;335559739&quot;:240,&quot;335559740&quot;:240}"> </span></p>
<p><div style="text-align:center"><a class="cta_button_link" href="https://visualstudio.microsoft.com/vs/preview/" style="text-transform: titlecase; display: inline-block; background-color: #5C2D91; color: white; padding: 10px; margin:10px 0; text-decoration: none;" target="_blank">Download Visual Studio Preview </a></div></p>
<h3 id="make-member-function-const"><span class="TextRun SCXW199985640 BCX8" data-contrast="none"><span class="NormalTextRun SCXW199985640 BCX8" data-ccp-parastyle="heading 1">Make Member Function Const</span></span></h3>
<p>Visual Studio now generates hints to mark member functions as <code>const</code> when a member function doesn&#8217;t modify the object&#8217;s state. This feature identifies cases where a member function performs actions that could be accomplished through the object&#8217;s public interface using a const pointer.</p>
<p>We have made this process easier for you by adding a suggestion that allows you to make a member function const. When a member function can be made const, there will be a suggestion (indicated by three dots) below the function. Hovering over them will inform you that &#8220;the member function can be made const,&#8221; and you can click on the light bulb to make the member const.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/make_const.gif"><img decoding="async" class="aligncenter size-full wp-image-32788" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/make_const.gif" alt="Image make const" width="2069" height="901" /></a></p>
<p>When you make a member function const, the change is applied to all the files that have the member function. You can preview all the changed files by selecting the &#8220;Preview all changed files&#8221; link.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Make-function-const-in-multi-file.gif"><img decoding="async" class="aligncenter size-full wp-image-32800" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Make-function-const-in-multi-file.gif" alt="Make function const in multi file GIF" width="2394" height="1302" /></a></p>
<p><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)">&#8220;Make Member Function Const&#8221; is on by default, and </span><span class="NormalTextRun CommentStart SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)">it is set as suggestion</span><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)">. The setting can be found and configured by navigating to </span></span><strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-charstyle="Strong">Tools</span></span></strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)"> &gt; </span></span><strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-charstyle="Strong">Options</span></span></strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)"> &gt; </span></span><strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-charstyle="Strong">Text Editor</span></span></strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)"> &gt; </span></span><strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-charstyle="Strong">C/C++</span></span></strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)"> &gt; </span></span><strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-charstyle="Strong">Code Style</span></span></strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)"> &gt; </span></span><strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-charstyle="Strong">Linter</span></span></strong><span class="TextRun SCXW9364774 BCX8" data-contrast="auto"><span class="NormalTextRun SCXW9364774 BCX8" data-ccp-parastyle="Normal (Web)">.</span></span><span class="EOP SCXW9364774 BCX8" data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:false,&quot;201341983&quot;:0,&quot;335559739&quot;:240,&quot;335559740&quot;:240}"> </span></p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Member-Function-Can-be-Made-Const-Setting.png"><img decoding="async" class="aligncenter size-full wp-image-32794" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Member-Function-Can-be-Made-Const-Setting.png" alt="Make Member Function Const Setting" width="1801" height="1322" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Member-Function-Can-be-Made-Const-Setting.png 1801w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Member-Function-Can-be-Made-Const-Setting-300x220.png 300w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Member-Function-Can-be-Made-Const-Setting-1024x752.png 1024w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Member-Function-Can-be-Made-Const-Setting-768x564.png 768w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Member-Function-Can-be-Made-Const-Setting-1536x1127.png 1536w" sizes="(max-width: 1801px) 100vw, 1801px" /></a></p>
<p>&nbsp;</p>
<h3 id="make-function-static">Make Function Static</h3>
<p>In Visual Studio Preview, you&#8217;ll now receive hints to mark global functions as <code>static</code>. When encountering a global function that doesn&#8217;t have a forward declaration in a header file, you will be able to make the function static effortlessly. We already have a feature that detects global functions and suggests creating forward declarations, and now we have added an option to mark them as static. This feature works smoothly with modern C++ projects, as it doesn&#8217;t provide suggestions to make anonymous namespaces static. Static global functions are accessible within the translation unit where they are defined.</p>
<p>When there is a global function that doesn&#8217;t have a forward declaration, it will have a suggestion. Hovering over the suggestion will reveal a screwdriver icon, signaling that the function can be made static. You can complete the process by clicking the screwdriver icon and selecting &#8220;Make this function static.&#8221;</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/make_-function_static.gif"><img decoding="async" class="aligncenter size-full wp-image-32795" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/make_-function_static.gif" alt="Image make function static" width="2146" height="645" /></a></p>
<p>You can configure this feature&#8217;s setting in <strong>Tools</strong> &gt; <strong>Options</strong> &gt; <strong>Text Editor</strong> <strong>&gt; C/C++</strong> &gt; <strong>IntelliSense</strong>. While the default tag is set as a suggestion, you have the flexibility to customize the severity level to none, warning, or error.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Make-global-function-static-setting.png"><img decoding="async" class="aligncenter size-full wp-image-32796" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Make-global-function-static-setting.png" alt="Make global function static setting." width="737" height="660" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Make-global-function-static-setting.png 737w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/Make-global-function-static-setting-300x269.png 300w" sizes="(max-width: 737px) 100vw, 737px" /></a></p>
<p>&nbsp;</p>
<h3 id="send-us-your-feedback"><span lang="EN-US">Send us your feedback</span></h3>
<p>To experience this exciting new feature, make sure to download the <a href="https://visualstudio.microsoft.com/vs/preview/">latest version of Visual Studio Preview</a>. Your feedback is of utmost importance to us, as it guides the enhancement of Visual Studio. Please share your insights in the comments section, the <a href="https://developercommunity.visualstudio.com/cpp">developer community</a>, or on Twitter (<a href="https://twitter.com/visualc">@VisualC</a>). Alternatively, you can also reach out to us via email at <a href="mailto:visualcpp@microsoft.com">visualcpp@microsoft.com</a>.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/make-member-function-const-and-global-function-static-in-visual-studio/">Make Member Function const and Global Function Static in Visual Studio</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/make-member-function-const-and-global-function-static-in-visual-studio/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Integrating C++ header units into Office using MSVC (2/n)</title>
		<link>https://devblogs.microsoft.com/cppblog/integrating-c-header-units-into-office-using-msvc-2-n/</link>
					<comments>https://devblogs.microsoft.com/cppblog/integrating-c-header-units-into-office-using-msvc-2-n/#comments</comments>
		
		<dc:creator><![CDATA[Cameron DaCamara]]></dc:creator>
		<pubDate>Mon, 11 Sep 2023 16:00:01 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<category><![CDATA[General C++ Series]]></category>
		<category><![CDATA[C++ language]]></category>
		<category><![CDATA[C++20]]></category>
		<category><![CDATA[modernization]]></category>
		<category><![CDATA[modules]]></category>
		<category><![CDATA[Office]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32767</guid>

					<description><![CDATA[<p>In this follow-up blog, we will explore progress made towards getting header units working in the Office codebase.<br />
Overview</p>
<p>Overview: Where we were, where we&#8217;re going.<br />
Old Code, Old Problems: &#8216;fun&#8217; code issues found while scaling out.<br />
Rethinking Compiler Tooling: How can the compiler rise to the scaling problems?</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/integrating-c-header-units-into-office-using-msvc-2-n/">Integrating C++ header units into Office using MSVC (2/n)</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>In this follow-up blog, we will explore progress made towards getting header units working in the Office codebase.</p>
<h2 id="overview">Overview</h2>
<ul>
<li><a href="#overview">Overview: Where we were, where we&#8217;re going.</a></li>
<li><a href="#old-code">Old Code, Old Problems: &#8216;fun&#8217; code issues found while scaling out.</a></li>
<li><a href="#rethink">Rethinking Compiler Tooling: How can the compiler rise to the scaling problems?</a></li>
<li><a href="#ifc-ref">A New Approach to Referencing an IFC.</a></li>
<li><a href="#pch">Playing Nice With Precompiled Headers (PCH).</a></li>
<li><a href="#selection">Selecting a Launch Project: REDACTED.</a></li>
<li><a href="#looking-ahead">Looking Ahead: Throughput.</a></li>
</ul>
<h2><span id="overview">Overview</span></h2>
<p><a href="https://devblogs.microsoft.com/cppblog/integrating-c-header-units-into-office-using-msvc-1-n/">Last time</a> we talked about how and why header units can be integrated into a large cross-platform codebase like Office. We discussed
how header units helped surface conformance issues (good) and expose and fix compiler bugs (good-ish).</p>
<p>We talked about how we went about taking &#8220;baby steps&#8221; to integrate header units into smaller liblets—we&#8217;re talking
something on the order of 100s of header units. This blog entry is all about scale and how we move from 100s of header
units to 1000s of header units, including playing nicely with precompiled headers!</p>
<p>Office&#8217;s header unit experiments continued by following the charge that we left you with in the last blog post: &#8220;Header
Unit All the Things!&#8221;. From that perspective we were wildly successful! By the last count we were able to successfully
create over 5000 header units from liblet public headers. The road to reach that milestone wasn&#8217;t always smooth, and
we&#8217;ll cover some of the challenges.</p>
<p>We&#8217;d like to highlight that the recent release of <a href="https://learn.microsoft.com/en-us/visualstudio/releases/2022/release-notes-v17.6#17.6.6">MSVC 17.6.6</a> makes
this one of the best times to get started with header units! The release contains the full set of fixes that were
discovered in cooperation with Office. The full set of fixes will also be available in 17.7.5 and 17.8 preview 2.</p>
<h2><span id="old-code">Old Code, Old Problems</span></h2>
<p>While scaling out we encountered quite a number of complications. Some fixes involved updating Office code, while
others needed to be solved on the compiler side. We&#8217;ll present just a few examples from each bucket.</p>
<h3><span id="symlinks">Symbolic Links</span></h3>
<p>The way Office sources coalesce is a mix between sources populated by git and libraries populated by NuGet
packages which are then linked into a build source tree via symbolic links. From a build perspective, this is extremely
convenient because you can decouple library updates from the sources and you can have one copy of library code shared
across multiple copies of the git sources.</p>
<p>Symbolic links are interesting from a compiler perspective for two reasons: diagnostics and <a href="https://learn.microsoft.com/en-us/cpp/preprocessor/once?view=msvc-170"><code>#pragma once</code></a>. For source
locations, there are two options: use the symbolic link as the file name or use the physical file the link resolves to.
When issuing diagnostics, the compiler tries to use the symbolic link location because that is what was provided on the
<a href="https://learn.microsoft.com/en-us/cpp/build/reference/i-additional-include-directories?view=msvc-170"><code>/I</code></a>
line, but there are cases where you might want the physical file location.</p>
<p><code>#pragma once</code> is a whole other beast with respect to symbolic links. In the beginning, C-style include guards
were created as a method of preventing repeated file <em>content</em>. <code>#pragma once</code> came about as a method of
preventing inclusion of the <em>same file</em>. The distinction between file and content is part of the reason why <code>#pragma
once</code> is difficult to standardize due to its reliance on filesystem vagaries to identify what it means to point to the
&#8220;same file&#8221;.</p>
<p>Consider a small example:</p>
<ul>
<li>Real file: <code>C:\inc\a.h</code> which contains a single <code>#pragma once</code></li>
<li>Symlink 1: <code>C:\syms\inc\lib1\a.h -&gt; C:\inc\a.h</code></li>
<li>Symlink 2: <code>C:\syms\inc\lib2\a.h -&gt; C:\inc\a.h</code></li>
</ul>
<p>Further consider a header in <code>C:\syms\inc\lib2\b.h</code>:</p>
<pre>#pragma once
#include "a.h"</pre>
<p>Then in our sources we have:</p>
<pre>#include "lib1/a.h"
#include "lib2/b.h"</pre>
<p>Let&#8217;s dive into what should happen here:</p>
<ul>
<li>The compiler sees symlink #1 through <code>"lib1/a.h"</code>, sees <code>#pragma once</code> in the file content and records that file <code>C:\syms\inc\lib1\a.h</code> is associated with a pragma once.</li>
<li>The compiler reads <code>"lib2/b.h"</code> and sees an inclusion of <code>"lib2/a.h"</code>.</li>
<li>Symlink #2 is then read and the compiler observes that <code>#pragma once</code> is in the file content and records that file <code>C:\syms\inc\lib2\a.h</code> is associated with a pragma once.</li>
</ul>
<p>See a problem?</p>
<p>The fact that the compiler read the file content from symlink #2 is where things start to go wrong. What should
have happened is that the compiler unwraps the symbolic link to discover what the underlying file is and records the
real file as the owner of the pragma once, which is exactly what we did to solve the problem in normal compilation
scenarios.</p>
<p>How does the situation above play into header units? Header units need to work like a PCH where they record
macros and pragma state, which includes <code>#pramga once</code>. This means that the IFC needs to record symbolic
links and their &#8220;unwrapped&#8221; files so that the compiler can properly enforce <code>#pragma once</code>. After this work
was done, many more scenarios were unblocked in the Office build.</p>
<p><em>As a side note: it is always better to rely on standard C++ features to prevent repeated file content
inclusion and doing so side-steps the symbolic link problem entirely.</em></p>
<h3><span id="conditional-compilation">Inconsistent Conditional Compilation</span></h3>
<p>We called out the most critical source of issues in the first blog post: inconsistent conditional compilation. As
the experiment added projects we ran into an increasing number of conflicts. Individual projects, or sometimes
isolated build nodes, couldn&#8217;t agree if the <a href="https://learn.microsoft.com/en-us/cpp/build/reference/j-default-char-type-is-unsigned?view=msvc-170">default char
type is unsigned</a>, <a href="https://learn.microsoft.com/en-us/cpp/build/reference/gr-enable-run-time-type-information?view=msvc-170">if RTTI
should be enabled</a>, or if <a href="https://devblogs.microsoft.com/oldnewthing/20040212-00/?p=40643">UNICODE support
should be set</a>, and that&#8217;s only in command line options!</p>
<p>Across liblet headers there were also code level macros to detangle: conditional selection of a memory allocator,
masks for disallowed Windows SDK functions, plus the <code>ASSUME</code> macro example still hadn&#8217;t been resolved! Solving such
problems could require touching nearly every project in Office.</p>
<h3><span id="internal-linkage">Internal Linkage</span></h3>
<p>Declarations at namespace, including global, scope marked <code>static</code> have internal linkage. With textual includes
this isn&#8217;t an issue for declarations such as <code>static const float pi = 3.14</code> because the contents of the header file become
part of the translation unit. The source used to compile a header unit is a translation unit unto itself and thus the
definition of <code>pi</code> will not be visible when it is imported. Fortunately, the fix is simple. Such data declarations
should be marked as <code>inline constexpr</code>. However, after converting the constant declarations to be <code>inline constexpr</code> we
were still seeing many unresolved symbols during linking. These issues ultimately required a compiler change so that
IFC could contain the full initialization information for the data.</p>
<p>Naturally, the compiler had to account for the common case where global variables marked as <code>inline constexpr</code>
should have their values encoded into the actual IFC. In general, the compiler already does this for simpler values
such as integral types, but more complex user-defined types or arrays of objects had to be accounted for. As a compiler optimization, the variable is only instantiated when it is referenced.
More specifically, the compiler will only materialize the initializer if the variable is odr-used.</p>
<h3><span id="internal-linkage">Mismatched Include Paths</span></h3>
<p>Office has continued to utilize the <a href="https://learn.microsoft.com/en-us/cpp/build/reference/translateinclude?view=msvc-170"><code>/translateInclude</code></a>
flag to consume header units without rewriting source code. For this to operate as expected the <code>#include</code>
directives in source must match what is specified by a <a href="https://learn.microsoft.com/en-us/cpp/build/reference/headerunit?view=msvc-170"><code>/headerUnit</code></a>
switch. In Office the most common issue was a reference that used the internal path to a header instead of the external
one.</p>
<table style="border-collapse: collapse; width: 100%; height: 84px;">
<tbody>
<tr style="height: 28px;">
<td style="width: 7.59961%; height: 28px;">Example switch:</td>
<td style="width: 92.4004%; height: 28px;"><code>/headerUnit:quote componentA/publicheader.h=ifcdir/publicheader.h.ifc</code></td>
</tr>
<tr style="height: 28px;">
<td style="width: 7.59961%; height: 28px;">Incorrect path:</td>
<td style="width: 92.4004%; height: 28px;"><code>#include &lt;src/public/publicheader.h&gt;</code></td>
</tr>
<tr style="height: 28px;">
<td style="width: 7.59961%; height: 28px;">Correct path:</td>
<td style="width: 92.4004%; height: 28px;"><code>#include &lt;componentA/publicheader.h&gt;</code></td>
</tr>
</tbody>
</table>
<p>In the above example the incorrect path will not match the <em>header-filename</em> portion of the
<code>/headerUnit</code> switch and thus will be textually included. Finding incorrect include paths is tricky because
the code will compile correctly. The best way to discover any issues is to examine the output provided by <a href="https://learn.microsoft.com/en-us/cpp/build/reference/sourcedependencies?view=msvc-170"><code>/sourceDependencies</code></a>
for unexpected textual includes.</p>
<h3><span id="ifc-updates">Updating the IFC Specification</span></h3>
<p>There&#8217;s been a perennial feedback bug since the original modules implementation in the compiler: <a href="https://developercommunity.visualstudio.com/t/using-namespace-declaration-ignored-wh/10211461">`using namespace`
declaration ignored when compiling as a header unit module</a>. The problem was that the IFC had no representation for
using-directives at namespace scope (e.g. <code>using namespace std;</code>). It turns out that Office also ran into this issue so to continue the experiment,
we had to fix it. After some thinking through the problem, we came up with <a href="https://github.com/microsoft/ifc-spec/pull/76">IFC-76</a> which describes an encoding method
for persisting directives in a translation unit.</p>
<h3><span id="assumptions">Breaking Historical Assumptions</span></h3>
<p>Before modules existed, the compiler had been around for nearly 25 years. This was enough time for the toolchain
to develop several assumptions about how the front-end conveys data to the back-end. One such coupling was
encoding type information directly into compiled functions. Handles to the compiler-generated type information are 0-index-based and the underlying data is generated along with each handle. There was one case where this type index was
emitted directly into a tree for the purposes of annotating type information with <code>new</code> expressions for the
debugger:</p>
<pre>int* make_int() {
  return new int{}; // &lt;- generated a direct encoding of the type index for 'new'
}</pre>
<p>Why does this encoding cause a problem for modules? Since the compiler is now persisting compiled inline
functions into the IFC the compiler also persists this type index from one compilation to the next and would, sometimes,
cause a linker crash as it goes to lookup the type index from the PDB but crashes because the index for that particular
translation unit is based on an array generated in a completely different translation unit. Office was able to reveal
this issue very quickly as many of the link steps involved lots of translation units from which this bug would
surface.</p>
<h3><span id="windows-sdk">Windows SDK Woes</span></h3>
<p>There is a, quite an old now, bug out: <a href="https://developercommunity.visualstudio.com/t/Visual-Studio-cant-find-time-function/1126857">Visual Studio can&#8217;t find time() function using modules and std.core</a>. The
root cause here is that the UCRT contains a definition of the <code>time()</code> function from C where it is defined as a <code>static
inline</code> function within the SDK header. These <code>static inline</code> functions stem from C not having the C++ meaning of
<code>inline</code> but <code>static inline</code> on a function declaration allows the function to behave as if it had C++ <code>inline</code>-like
semantics. Note that defining the C standard function <code>time()</code> as <code>static inline</code> is in direct violation of the C
standard which explicitly says that C standard library functions have external linkage. The Windows SDK team is hard at
work fixing the issue above along with some other SDK issues that have plagued C++ modules interactions in the past, so
stay tuned for fixes soon!</p>
<h2><span id="rethink">Rethinking Compiler Tooling</span></h2>
<p>As we scaled the number of projects being built by the compiler using the header unit technology it became
immediately evident that we quickly needed to rethink how to debug compiler problems. The traditional loop involved
either reducing the failure to a simple two or three file repro or attaching to a remote debugging instance where the
compiler was running on the build machine. It&#8217;s easy to see how and why these approaches do not scale. Here are the
concrete problems we needed to solve:</p>
<ul>
<li>Reproduction data collection should be asynchronous. We did not want the process of capturing a repro to be a blocking task.</li>
<li>The data emitted by the compiler should be rich enough to reproduce the failure without debugging a remote compiler.</li>
<li>The process of emitting data should be completely opt-in and not have a performance impact if you did not request it.</li>
<li>The tool should offer a powerful visualization of the data such that we can easily navigate it and identify the underlying problem quickly.</li>
</ul>
<p>With the requirements outlined we designed a system inside the compiler which would act as a trace logging system
for any modules-related functionality. If you would find value in using these types of tools, please let us
know!</p>
<h2><span id="ifc-ref">A New Approach to Referencing an IFC</span></h2>
<p>Before the Office header unit experiments, the compiler relied on a pair of command line switches to specify
individual IFC files: <a href="https://learn.microsoft.com/en-us/cpp/build/reference/module-reference?view=msvc-170"><code>/reference</code></a>
for named modules, and <a href="https://learn.microsoft.com/en-us/cpp/build/reference/headerunit?view=msvc-170"><code>/headerUnit</code></a> for
header units. It turns out that when thousands of header units or named modules are involved the command line grows
quite long and unwieldy! An enormous list of flags is difficult to work with if there are compiler bugs to investigate,
as you cannot &#8216;comment&#8217; out a header unit reference easily. We solved this problem by implementing a new
way of conveying IFC dependencies to the compiler: <code>/ifcMap</code>. The <code>/ifcMap</code> allows the user to provide an IFC reference map
file, which is a subset of the <a href="https://toml.io/en/">TOML</a> file format, to the compiler which details a mapping from named module name or
header-name to its respective IFC which should be loaded. Here&#8217;s a quick example of a valid .toml file for the switch:</p>
<pre># Header Units
[[header-unit]]
name = ['quote', 'm1.h']
ifc = 'm1.h.ifc'

[[header-unit]]
name = ['quote', 'm2.h']
ifc = 'm2.h.ifc'

# Modules
[[module]]
name = 'm1'
ifc = 'm1-renamed.ifc'

[[module]]
name = 'm2'
ifc = 'm2-renamed.ifc'</pre>
<p><code>/ifcMap</code> allowed office to scale the number of header units painlessly and offer a solution to easily manage lots
of header unit references beyond having them splat on one giant command line. The IFC map also enables a tight
iterative approach when considering factors like debugging needs, both for the developer and the compiler team.</p>
<h2><span id="pch">Playing Nice with Precompiled Headers (PCH)</span></h2>
<p>Part of scaling out for the compiler is that large projects often use <a href="https://learn.microsoft.com/en-us/cpp/build/creating-precompiled-header-files?view=msvc-170">PCH</a> as a way of
achieving build speed. PCH is a reliable technology and has had the benefit of over 30 years of hardening and
optimization. Header units as the standardized replacement for PCH still need to integrate seamlessly into these older
build environments still using tried and true PCH technology. Furthermore, Office needs to maintain compatibility with
the non-Windows platforms that aren&#8217;t ready to adopt header units yet.</p>
<p>The approach mentioned last time to force include the Office shared precompiled header file into each header unit
resulted in a lot of duplicated parsing in the compiler. To that end we added support to consume the binary PCH
directly when creating a header unit. This resulted in a nice performance win when compiling header units!
Unfortunately, this resulted in a large build throughput degradation when consuming header units. As much as possible
we would need to get precompiled headers out of the picture.</p>
<p>The first, naïve, tactic was to ensure that each public header was truly self-contained. Eliminating invisible
dependencies felt like a virtuous task, even without considering the benefits to the header unit experiment! Thousands
of <code>#include &lt;windows.h&gt;</code> and <code>#include &lt;stl.h&gt;</code> additions later, we were ready to
test performance again… and it was barely any better. The issue is that precompiled headers and IFC are fundamentally
different technologies. Requiring the compiler to reconcile data from both sources is incredibly wasteful. The headers
being compiled into header units were free of binary PCH dependencies but a majority of cpp files were still using both
technologies.</p>
<p>At this point it&#8217;s worth noting that we measured a significant build throughput improvement in projects that
consumed header units but did not utilize a precompiled header. Individual compilands that switched from traditional
PCH consumption to PCH-as-header unit import, saw build time improvements well above 50%. This is one of the key
benefits that modules promised!</p>
<p>The idea to <em>create a header unit out of the existing PCH</em> was the flash of insight we needed to keep the experiment
moving forward! Although the compiler allows mixing PCH and header units it&#8217;s much more efficient to &#8220;pick a lane&#8221; in
your build system. By not presenting duplicate information to the compiler, it&#8217;s easier to create build throughput
wins.</p>
<h2><span id="selection">Selecting a Launch Project: Microsoft Word</span></h2>
<p>Although we were able to scale the experiment up and generate over 5000 header units from our liblet public
headers, some low-level blocks needed to be cleared before we could utilize header units in our production build
environment. We looked for a sizable project that could avoid the inconsistent conditional compilation issues that
needed more time to clean up. Luckily, we found a great candidate in Microsoft Word.</p>
<p>Word has utilized MSVC&#8217;s <a href="https://learn.microsoft.com/en-us/cpp/build-insights/get-started-with-cpp-build-insights?view=msvc-170">C++ Build
Insights</a> to craft optimal precompiled headers. Specifically, the techniques presented in <a href="https://devblogs.microsoft.com/cppblog/faster-builds-with-pch-suggestions-from-c-build-insights/">Faster builds with PCH
suggestions from C++ Build Insights &#8211; C++ Team Blog</a> were used to measure the performance benefit for
each individual file included in their main PCH. Word was to be our first test converting existing precompiled headers
directly to header units. At a high level the steps required were:</p>
<ol>
<li>Create a header unit instead of a pch.  Switch<code>/Yc</code> to <code>/exportHeader</code></li>
<li>Replace the use PCH flag with a standard header unit reference: <code>/Yu</code> to <code>/headerUnit:quote word_shared.h=path/to/word_shared.ifc</code></li>
<li>Profit?</li>
</ol>
<p>The code changes required in Word after adjusting the build flags were similar to what was described above. Constants needed to be made <code>inline
constexpr</code>, missing includes or forward declarations added, and a handful of function definitions moved out-of-line. In
total only 2 dozen C++ files in Word required code changes to compile successfully after the switch! The most unexpected of
these changes were to standardize on quotes instead of angle brackets when writing the PCH&#8217;s <code>#include</code> for the sake of consistency with
the <code>/headerUnit</code> switch.</p>
<p>Along with the conversion from Word&#8217;s PCH to header units we created a header unit from the standard library.
In the C++23 world, C++ projects can utilize the standard library module that ships alongside the compiler via <code>import std;</code> or <code>import
std.compat;</code>. Unfortunately, Office makes edits to the standard library and thus must create its own header unit or
named module.</p>
<p>With this set of changes, we proved it possible to compile, link and launch Microsoft Word with header units!</p>
<p><img decoding="async" style="display: block; margin-left: auto; margin-right: auto;" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/09/word-with-header-units.png" alt="Image of Microsoft Word running after being built using header units" /></p>
<h2><span id="looking-ahead">Looking Ahead: Throughput</span></h2>
<p>The next step was to demonstrate the advantages that header units would bring to the Word engineering team.
Fortunately, we were able to show a build performance improvement great enough that the team agreed to adopt header
units into the Office production build system alongside msvc 17.6.6! In our next installment we&#8217;ll go over our performance findings in
depth.</p>
<h4 id="closing">Closing</h4>
<p>As always, we welcome your feedback. Feel free to send any comments through e-mail at <a href="mailto:visualcpp@microsoft.com">visualcpp@microsoft.com</a> or through <a href="https://twitter.com/visualc">Twitter @visualc</a>. Also, feel free to follow Cameron DaCamara on Twitter <a href="https://twitter.com/starfreakclone">@starfreakclone</a>.</p>
<p>If you encounter other problems with MSVC in VS 2019/2022 please let us know via the <a href="https://docs.microsoft.com/en-us/visualstudio/ide/how-to-report-a-problem-with-visual-studio?view=vs-2019">Report
a Problem</a> option, either from the installer or the Visual Studio IDE itself. For suggestions or bug reports, let us
know through <a href="https://developercommunity.visualstudio.com/">DevComm.</a></p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/integrating-c-header-units-into-office-using-msvc-2-n/">Integrating C++ header units into Office using MSVC (2/n)</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/integrating-c-header-units-into-office-using-msvc-2-n/feed/</wfw:commentRss>
			<slash:comments>6</slash:comments>
		
		
			</item>
		<item>
		<title>MSVC Address Sanitizer &#8211; One DLL for all Runtime Configurations</title>
		<link>https://devblogs.microsoft.com/cppblog/msvc-address-sanitizer-one-dll-for-all-runtime-configurations/</link>
					<comments>https://devblogs.microsoft.com/cppblog/msvc-address-sanitizer-one-dll-for-all-runtime-configurations/#comments</comments>
		
		<dc:creator><![CDATA[Amy Wishnousky]]></dc:creator>
		<pubDate>Thu, 10 Aug 2023 17:14:44 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32709</guid>

					<description><![CDATA[<p>With Visual Studio 2022 version 17.7 Preview 3, we have refactored the MSVC Address Sanitizer (ASan) to depend on one runtime DLL regardless of the runtime configuration. This simplifies project onboarding and supports more scenarios, particularly for projects statically linked (/MT,</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/msvc-address-sanitizer-one-dll-for-all-runtime-configurations/">MSVC Address Sanitizer &#8211; One DLL for all Runtime Configurations</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>With Visual Studio 2022 version 17.7 Preview 3, we have refactored the MSVC Address Sanitizer (ASan) to depend on one runtime DLL regardless of the runtime configuration. This simplifies project onboarding and supports more scenarios, particularly for projects statically linked (<code>/MT</code>, <code>/MTd</code>) to the C Runtimes. However, static configurations have a new dependency on the ASan runtime DLL.</p>
<p>Summary of the changes:</p>
<ul>
<li>ASan now works with <code>/MT</code> or <code>/MTd</code> built DLLs when the host EXE was not compiled with ASan. This includes Windows services, COM components, and plugins.</li>
<li>Configuring your project with ASan is now simpler, since your project doesn’t need to uniformly specify the same <a href="https://learn.microsoft.com/en-us/cpp/build/reference/md-mt-ld-use-run-time-library?view=msvc-170">runtime configuration</a> (<code>/MT</code>, <code>/MTd</code>, <code>/MD</code>, <code>/MDd</code>).</li>
<li>ASan workflows and pipelines for <code>/MT</code> or <code>/MTd</code> built projects will need to ensure the ASan DLL (clang_rt.asan_dynamic-&lt;arch&gt;.dll) is available on PATH.</li>
<li>The names of the ASan .lib files needed by the linker have changed (the linker normally takes care of this if not manually specifying lib names via <code>/INFERASANLIBS</code>)</li>
<li>You cannot mix ASan-compiled binaries from previous versions of the MSVC Address Sanitizer (this is always true, but especially true in this case).</li>
</ul>
<h2 id="motivation-and-effects">Motivation and Effects</h2>
<p>When building a project, you must specify how you want to link to the C and C++ Runtime Libraries. Using the <code>/MD</code> option will link dynamically to the runtimes and have DLL dependencies provided by the Windows operating system (ex: ucrtbase.dll) and the VC++ Redistributable (ex: vcruntime140.dll, msvcp140.dll). This is a great default option to choose, as it allows you to take advantage of the latest available on the system and minimizes memory usage. The /MT option specifies that the runtime libraries will be statically linked (via libucrt.lib, libvcruntime.lib, libcpmt.lib, etc) in your program such that you have no VC++ DLL dependencies. This option is useful when dynamically linking complicates deployment and is most frequently used with projects like plugins or drivers.</p>
<p>Prior to Visual Studio 2022 v17.7 Preview 3, MSVC Address Sanitizer followed the same methodology and treated itself as one of the runtime libraries. If <code>/MD</code> was specified, ASan would be available as a DLL (clang_rt.asan_dynamic-&lt;arch&gt;.dll). If <code>/MT</code> was specified, ASan would be linked into the EXE. ASan can only have one instance at a time, so DLLs that were statically linked would assume the EXE of the process was also built with ASan and would call into that EXE for support. This caused problems for any software that could not recompile the host EXE with ASan enabled: plugins, COM components, Windows services, etc. Here is <a href="https://developercommunity.visualstudio.com/t/C-Address-Sanitizer:-statically-linked/1403680">an example reported on Developer Community</a>. Additionally, since each runtime configuration had its own version of ASan, you could not mix components with different runtime configurations.</p>
<p>As of Visual Studio v17.7 Preview 3, runtime configuration is no longer considered and there is one Address Sanitizer DLL per architecture. In addition to supporting more scenarios, this can also significantly simplify onboarding a complex project with ASan. A side effect is that projects statically linked with <code>/MT</code> or <code>/MTd</code> now have a dependency on the ASan runtime DLL.</p>
<h2 id="link-time-changes-inferasanlibs">Link Time Changes (/INFERASANLIBS)</h2>
<p>When <code>/fsanitize=address</code> is passed to the compiler, <code>/INFERASANLIBS</code> will automatically be passed to the linker, which will take care of the link time requirements for Address Sanitizer.</p>
<p>If you use <code>/INFERASANLIBS:NO</code> in your build and manually specify which ASan libraries you link with, you will also need to change which .lib files are passed to the linker.</p>
<table>
<tbody>
<tr>
<td></td>
<td colspan="2"><code>/INFERASANLIBS</code> prior to VS 2022 v17.7 Preview 3</td>
</tr>
<tr>
<td rowspan="2"><code>/MT</code></td>
<td rowspan="2">clang_rt.asan_cxx-&lt;arch&gt;.lib</td>
<td>EXE: <code>/wholearchive:clang_rt.asan-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td>DLL: <code>/wholearchive:clang_rt.asan_dll_thunk-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td rowspan="2"><code>/MTd</code></td>
<td rowspan="2">clang_rt.asan_cxx_dbg-&lt;arch&gt;.lib</td>
<td>EXE: <code>/wholearchive:clang_rt.asan_dbg-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td>DLL: <code>/wholearchive:clang_rt.asan_dbg_dll_thunk-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td><code>/MD</code></td>
<td>clang_rt.asan_dynamic-&lt;arch&gt;.lib</td>
<td><code>/wholearchive:clang_rt.asan_dynamic_runtime_thunk-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td><code>/MDd</code></td>
<td>clang_rt.asan_dbg_dynamic-&lt;arch&gt;.lib</td>
<td><code>/wholearchive:clang_rt.asan_dbg_dynamic_runtime_thunk-&lt;arch&gt;.lib</code></td>
</tr>
</tbody>
</table>
<table>
<tbody>
<tr>
<td></td>
<td colspan="2">/INFERASANLIBS as of VS 2022 v17.7 Preview 3</td>
</tr>
<tr>
<td><code>/MT</code></td>
<td>clang_rt.asan_dynamic-&lt;arch&gt;.lib</td>
<td><code>/wholearchive:clang_rt.asan_static_runtime_thunk-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td><code>/MTd</code></td>
<td>clang_rt.asan_dynamic-&lt;arch&gt;.lib</td>
<td><code>/wholearchive:clang_rt.asan_static_runtime_thunk-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td><code>/MD</code></td>
<td>clang_rt.asan_dynamic-&lt;arch&gt;.lib</td>
<td><code>/wholearchive:clang_rt.asan_dynamic_runtime_thunk-&lt;arch&gt;.lib</code></td>
</tr>
<tr>
<td><code>/MDd</code></td>
<td>clang_rt.asan_dynamic-&lt;arch&gt;.lib</td>
<td><code>/wholearchive:clang_rt.asan_dynamic_runtime_thunk-&lt;arch&gt;.lib</code></td>
</tr>
</tbody>
</table>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>The MSVC AddressSanitizer does not attempt to maintain compatibility with older versions, unlike other MSVC libraries. You should deploy a version of the AddressSanitizer DLL that matches the version of the toolset used when compiling your ASan-instrumented code. Here are some common issues you may see if you are mixing ASan-enabled projects built before and after Visual Studio 2022 17.7 Preview 3:</p>
<p><strong>“The code execution cannot proceed because clang_rt.asan_dynamic-x86_64.dll was not found.”</strong></p>
<p><strong>“The code execution cannot proceed because clang_rt.asan_dynamic-i386.dll was not found.”</strong></p>
<p>These messages are displayed when an ASan binary was deployed in an environment without the AddressSanitizer DLL. If you are seeing this immediately after updating to Visual Studio 2022 17.7 Preview 3 and you are statically linking to the C Runtime (<code>/MT</code>, <code>/MTd</code>), that binary has a new dependency on the ASan DLL named and must be included in the environment. Please update the PATH to include clang_rt.asan_dynamic-x86_64.dll (x64) or clang_rt.asan_dynamic-i386.dll (x86).</p>
<p><strong>“The procedure entry point __sanitizer_override_function could not be located in the dynamic link library.”</strong></p>
<p><strong>“The procedure entry point __sanitizer_register_weak_function could not be located in the dynamic link library.”</strong></p>
<p>These messages are displayed when a binary built with 17.7 Preview 3 is deployed in an environment with an AddressSanitizer DLL from a toolset prior to 17.7 Preview 3. Please update clang_rt.asan_dynamic-x86_64.dll (x64) or clang_rt.asan_dynamic-i386.dll (x86) to the latest version included with your current version of Visual Studio.</p>
<h2 id="let-us-know-what-you-think">Let us know what you think!</h2>
<p>Please check out the new MSVC AddressSanitizer improvements in Visual Studio 2022 v17.7 Preview 3 and let us know if you have any comments, questions, or other feedback in the comments below or on <a href="https://developercommunity.visualstudio.com/cpp/report">Developer Community</a>!</p>
<p>&nbsp;</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/msvc-address-sanitizer-one-dll-for-all-runtime-configurations/">MSVC Address Sanitizer &#8211; One DLL for all Runtime Configurations</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/msvc-address-sanitizer-one-dll-for-all-runtime-configurations/feed/</wfw:commentRss>
			<slash:comments>4</slash:comments>
		
		
			</item>
		<item>
		<title>Introducing CMake Debugger in VS Code: Debug your CMake Scripts using Open-Source CMake Debugger</title>
		<link>https://devblogs.microsoft.com/cppblog/introducing-cmake-debugger-in-vs-code-debug-your-cmake-scripts-using-open-source-cmake-debugger/</link>
					<comments>https://devblogs.microsoft.com/cppblog/introducing-cmake-debugger-in-vs-code-debug-your-cmake-scripts-using-open-source-cmake-debugger/#comments</comments>
		
		<dc:creator><![CDATA[Sinem Akinci]]></dc:creator>
		<pubDate>Wed, 09 Aug 2023 18:34:09 +0000</pubDate>
				<category><![CDATA[C++]]></category>
		<category><![CDATA[CMake]]></category>
		<category><![CDATA[Visual Studio Code]]></category>
		<guid isPermaLink="false">https://devblogs.microsoft.com/cppblog/?p=32660</guid>

					<description><![CDATA[<p>The new CMake Debugger that was introduced in Visual Studio is now available in VS Code. Now, you can debug your CMakeLists.txt scripts from VS Code using the CMake Tools Extension. To see the full release notes for this release and what else is included,</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/introducing-cmake-debugger-in-vs-code-debug-your-cmake-scripts-using-open-source-cmake-debugger/">Introducing CMake Debugger in VS Code: Debug your CMake Scripts using Open-Source CMake Debugger</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>The new CMake Debugger that <a href="https://devblogs.microsoft.com/cppblog/cmake-debugger-allows-you-to-debug-your-cmake-scripts-and-more/">was introduced in Visual Studio</a> is now available in VS Code. Now, you can debug your CMakeLists.txt scripts from VS Code using <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools">the CMake Tools Extension</a>. To see the full release notes for this release and what else is included, including bug fixes, please see the <a href="https://github.com/microsoft/vscode-cmake-tools/blob/main/CHANGELOG.md">release notes</a>.</p>
<h3 id="background">Background</h3>
<p>The Visual C++ team collaborated closely with Kitware, the CMake maintainers, to <a href="https://gitlab.kitware.com/cmake/cmake/-/merge_requests/8838">merge our CMake debugger implementation upstream</a> and make this widely available. This implementation is now available in <a href="https://www.kitware.com/software-releases/">CMake version 3.27</a>. Please download the latest version for your OS via <a href="https://cmake.org/download/">this link</a> or update via your system package manager to access the CMake debugger in VS Code. You can check your CMake version on your machine at any time by running <code>cmake –version</code> in a terminal window. CMake 3.27 will ship with Visual Studio in a later release in 17.8.</p>
<p>The debugger uses the widely supported <a href="https://microsoft.github.io/debug-adapter-protocol/implementors/tools">Debug Adapter Protocol,</a> which is compatible with many development environments.  We are excited to see how the open-source community works together to implement new ideas for the debugger.</p>
<h3 id="cmake-debugger-functionality">CMake Debugger Functionality</h3>
<p>As a user, you’ll see the same functionality as you would in a normal debugging session. This includes viewing variables, call stacks, and cache variables specific to CMake and the ability to set breakpoints on your CMakeLists.txt file and step through your code.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/CMakeDebugger.gif"><img decoding="async" class="size-full wp-image-32664 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/CMakeDebugger.gif" alt="Using the CMake Debugger to VS Code and viewing CMake variables" width="1897" height="989" /></a></p>
<p>To open the CMake Debugger in your project, you can select it from the command palette by pressing<code>Ctrl+Shift+P</code>.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-101918.png"><img decoding="async" class="size-full wp-image-32665 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-101918.png" alt="Command Palette dropdown to configure with CMake Debugger" width="663" height="112" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-101918.png 663w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-101918-300x51.png 300w" sizes="(max-width: 663px) 100vw, 663px" /></a></p>
<p>Additionally, it can be opened anywhere else you typically configure your project, such as in the CMake Project Outline in the CMake Tools side panel.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102117.png"><img decoding="async" class="size-full wp-image-32666 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102117.png" alt="Option to Configure Project with CMake Debugger in CMake side panel." width="663" height="121" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102117.png 663w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102117-300x55.png 300w" sizes="(max-width: 663px) 100vw, 663px" /></a></p>
<p>If your CMake configure ever fails, a notification will pop-up for you to interact with to launch the debugger.</p>
<p><a href="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102354.png"><img decoding="async" class="size-full wp-image-32667 aligncenter" src="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102354.png" alt="CMake Configure Fail Error to allow you to open CMake Debugger" width="646" height="169" srcset="https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102354.png 646w, https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2023/08/Screenshot-2023-08-01-102354-300x78.png 300w" sizes="(max-width: 646px) 100vw, 646px" /></a></p>
<h3 id="whats-next">What&#8217;s next?</h3>
<p>Next up, we are working on a few different things including <a href="https://github.com/microsoft/vscode-cmake-tools/issues/534" target="_blank" rel="noopener">implementing CMake language services</a> and re-vamping our overall CMake side panel and status bar experiences based on user feedback. Let us know what else you&#8217;d like to see!</p>
<h3 id="send-us-your-feedback">Send us your feedback!</h3>
<p>We hope this helps your CMake workflows in VS Code. Download the latest preview version of Visual Studio and give it a try. Download the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools">CMake Tools extension </a>for Visual Studio Code and let us know what you think. We would love to see what you contribute to our <a href="https://github.com/microsoft/vscode-cmake-tools">repo</a> and are active on reviews and collaboration. If you have any issues, please file an issue to our repo <a href="https://github.com/microsoft/vscode-cmake-tools/issues">here</a>. Comment below or reach us via email at <a href="mailto:visualcpp@microsoft.com">visualcpp@microsoft.com</a> or via Twitter at <a href="https://twitter.com/visualc">@VisualC</a>.</p>
<p>The post <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog/introducing-cmake-debugger-in-vs-code-debug-your-cmake-scripts-using-open-source-cmake-debugger/">Introducing CMake Debugger in VS Code: Debug your CMake Scripts using Open-Source CMake Debugger</a> appeared first on <a rel="nofollow" href="https://devblogs.microsoft.com/cppblog">C++ Team Blog</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://devblogs.microsoft.com/cppblog/introducing-cmake-debugger-in-vs-code-debug-your-cmake-scripts-using-open-source-cmake-debugger/feed/</wfw:commentRss>
			<slash:comments>2</slash:comments>
		
		
			</item>
	</channel>
</rss>
