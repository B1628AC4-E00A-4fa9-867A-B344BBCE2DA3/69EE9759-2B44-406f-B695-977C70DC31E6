<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[POSTD | ニジボックスが運営するエンジニアに向けたキュレーションメディア]]></title><description><![CDATA[POSTD は、ニジボックスが運営する、エンジニアに向けたキュレーションメディアです。ニジボックスはWebサービスの企画、制作、開発、運用を一貫して担うリクルートの100%子会社です。 リクルートグループのオンラインサービスをはじめ、様々な業種・業界・業態のサービス開発を行っております。]]></description><link>https://postd.cc</link><generator>GatsbyJS</generator><lastBuildDate>Fri, 27 Sep 2024 01:08:19 GMT</lastBuildDate><language>ja</language><atom:link href="https://postd.cc/feed/" rel="self" type="application/rss+xml"/><image><title>POSTD | ニジボックスが運営するエンジニアに向けたキュレーションメディア</title><link>https://postd.cc</link></image><item><title><![CDATA[React Compilerについて理解する]]></title><description><![CDATA[Reactのコアアーキテクチャは、与えられた関数（すなわちコンポーネント）を繰り返し呼び出します。この仕組みはReactのメンタルモデルを単純化し、その人気に一役を買いましたが、同時にパフォーマンス…]]></description><link>https://postd.cc/understanding-react-compiler/</link><guid isPermaLink="false">https://postd.cc/understanding-react-compiler/</guid><category><![CDATA[開発手法・プロジェクト管理]]></category><category><![CDATA[React]]></category><pubDate>Fri, 27 Sep 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p>Reactのコアアーキテクチャは、与えられた関数（すなわちコンポーネント）を繰り返し呼び出します。この仕組みはReactのメンタルモデルを単純化し、その人気に一役を買いましたが、同時にパフォーマンスの問題が生じる原因にもなりました。関数のパフォーマンスコストが高いと、アプリの動作は総じて遅くなります。</p>
<p>開発者はReactにどの関数をいつ再実行するか手動で指示しなくてはならなかったため、パフォーマンスチューニングが悩みの種になっていました。Reactチームが最近リリースしたReact Compilerというツールは、コードを書き直すことにより、開発者が手動で行っていたパフォーマンスチューニングの作業を自動化します。</p>
<p>React Compilerはコードに何をするのでしょうか？裏ではどのような処理が行われるのでしょうか？使った方がいいのでしょうか？こうした疑問について詳しく見ていきたいと思います。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>Reactの内部実装について詳しく学び、完全で正確なメンタルモデルを得たい方は、<a href="https://understandingreact.com/">Understanding React</a>という筆者の新しいコースでReactのソースコードを掘り下げて説明していますので、ぜひチェックしてみてください。Reactの使用経験が豊富な開発者でも、内部実装の理解を深めることは大いに役立ちます。</p></div></div>
<h2>コンパイラ、トランスパイラ、オプティマイザ</h2>
<p>モダンJavaScriptのエコシステムでは、コンパイラ、トランスパイラ、オプティマイザという用語がよく聞かれます。これらは何でしょうか？</p>
<h3>トランスパイル</h3>
<p>トランスパイラとは、コードを解析し、同等の機能を持つコードを別のプログラミング言語で出力するか、調整を加えたコードを同じプログラミング言語で出力するプログラムです。</p>
<p>React開発者は何年も前からトランスパイラを使用し、JSXをJavaScriptエンジンが実際に実行するコードに変換してきました。JSXは、基本的にはネストされた関数のツリー（これらはネストされたオブジェクトツリーを構築）を作成するための省略記法です。</p>
<p>ネストされた関数を記述するのは面倒でミスが生じやすいため、JSXは開発者を大いに助けます。トランスパイラはJSXを解析し、関数に変換するために必要です。</p>
<p>例えば、JSXを使用して次のReactコードを記述したとします。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>読みやすさに配慮し、このブログ記事ではコードはすべて大幅に簡略化しています。</p></div></div>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span> <span class="token attr-name">item</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> item <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>desc <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>これをトランスパイルすると、次のようになります。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_jsx</span><span class="token punctuation">(</span>Item<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">item</span><span class="token operator">:</span> item
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> item <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> item<span class="token punctuation">.</span>desc
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>こちらが実際にブラウザに送られるコードです。HTMLのような構文ではなく、Reactでは「props」と呼ばれるプレーンなJavaScriptオブジェクトを渡す、ネストされた関数です。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>トランスパイルの結果は、JSX内でif文を簡単に使用できない理由を示しています。関数内ではif文を使用できません。</p></div></div>
<p><a href="none">Babel</a>を使用すればJSXを素早くトランスパイルし、出力結果を確認できます。</p>
<h3>コンパイルと最適化</h3>
<p>では、トランスパイラとコンパイラの違いは何でしょうか？　その答えは、回答者のバックグラウンドや経験によって異なるでしょう。コンピューターサイエンス分野を歩んできた人であれば、大抵はコンパイラと言えば記述したコードを機械語（プロセッサが理解できるバイナリコード）に変換するプログラムという認識だと思います。</p>
<p>しかし、トランスパイラは「source-to-source compilers」とも呼ばれます。オプティマイザは「最適化コンパイラ」とも呼ばれます。つまり、トランスパイラとオプティマイザもコンパイラの一種なのです。</p>
<p>物事に名前を付けるのは簡単ではありません。したがって、何をもってトランスパイラ、コンパイラ、あるいはオプティマイザと呼ぶのかについては意見の相違があるでしょう。理解すべき重要な点は、トランスパイラも、コンパイラも、オプティマイザも、コードが記述されたテキストファイルを解析し、同等の機能を持つ別のコードを新しいテキストファイルに出力するプログラムだということです。コードを改良する場合もあれば、別の人が書いたコードを呼び出すコールで自分のコードの一部をラップすることで、新しい機能を追加する場合もあります。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>トランスパイラ、コンパイラ、オプティマイザは、コードが記述されたテキストファイルを解析し、同等の機能を持つ別のコードを出力するプログラムです。</p></div></div>
<p>React Compilerが行うのは後者です。あなたが書いたコードと同等の機能を持つコードを作成しますが、他のReact開発者が書いたコードを呼び出すコールであなたのコードの一部をラップします。そうすることで、あなたが意図したことに加え、プラスアルファの機能を備えたコードに書き換えます。その「プラスアルファ」が何かについては後ほど説明します。</p>
<h3>抽象構文木（Abstract Syntax Trees）</h3>
<p>ここで言うコードの「解析」とは、コードを1文字ずつ構文解析し、アルゴリズムを実行することで、コードをどう調整し、書き換えるか、どのようにして機能を追加するかなどを明らかにすることを言います。通常、構文解析の結果は抽象構文木（AST）として出力されます。</p>
<p>そう言うと仰々しく聞こえますが、要はコードを分析しやすいようツリー構造で表したものです。</p>
<p>例えば、次の1行がコードに含まれていたとします。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'Hi'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>これを抽象構文木で表すと、次のようになります。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> VariableDeclarator<span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> Identifier<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> Item
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">init</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> ObjectExpression<span class="token punctuation">,</span>
        <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> ObjectProperty<span class="token punctuation">,</span>
                <span class="token literal-property property">key</span><span class="token operator">:</span> id<span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> ObjectProperty<span class="token punctuation">,</span>
                <span class="token literal-property property">key</span><span class="token operator">:</span> desc<span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'Hi'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>生成されたデータ構造は、あなたが書いたコードを定義付けされた要素ごとに分解して説明します。各要素には、それがどういったものかを表す情報や、ひも付けされている値があればその値が含まれます。例えば、<code class="language-text">desc: 'Hi'</code>は<code class="language-text">ObjectProperty</code>であり、'desc'という<code class="language-text"> key</code>と'Hi'という<code class="language-text">value</code>がひも付けされています。</p>
<p>これが、トランスパイラやコンパイラなどがコードに対して行う処理について考える上でのメンタルモデルです。いずれも、あなたが書いたコード（テキストそのもの）をデータ構造に変換し、解析し、調整するために作成されたプログラムです。</p>
<p>最終的に生成されるコードはこのASTがもとになり、おそらくその他にもいくつかの中間言語が関与します。このデータ構造を繰り返し使用し、テキストを出力します（同じ言語で書かれた新しいコード、違う言語で書かれたコード、あるいは何らかの調整が加えられたコード）。</p>
<p>React Compilerは、ASTと中間言語の両方を使用し、あなたが書いたコードをもとに新しいReactコードを生成します。React自体がそうですが、React Compilerも「誰かが書いたコード」だということを忘れないでください。</p>
<p>コンパイラやトランスパイラ、オプティマイザなどのツールを謎めいたブラックボックスだとは考えないでください。時間さえあれば、自分にも作れるものだと考えましょう。</p>
<h2>Reactのコアアーキテクチャ</h2>
<p>React Compilerについて話す前に、明確にしておくべき概念があといくつかあります。</p>
<p>Reactのコアアーキテクチャがその人気の源泉であると同時に、パフォーマンスの問題の原因にもなり得ることはお話したかと思います。JSXを書く際、実際にはネストされた関数を記述しているのだということは説明した通りです。しかし、関数はReactに渡され、それをいつ呼び出すかはReactが判断します。</p>
<p>多数のアイテムを扱うReactアプリの最初の部分を例に見てみましょう。<code class="language-text">App</code>関数はいくつかのアイテムを取得し、<code class="language-text">List</code>関数はそれらを処理して表示すると仮定します。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: fetch some items here</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">List</span></span> <span class="token attr-name">items</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pItems <span class="token operator">=</span> <span class="token function">processItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> pItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> listItems <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>これらの関数は、子（ここでは最終的に複数のliオブジェクトになる）を含むulオブジェクトのようなプレーンなJavaScriptオブジェクトを返します。ulやliなどの一部のオブジェクトはReactに組み込まれています。Listなど、それ以外のオブジェクトは自分で作成します。</p>
<p>最終的に、Reactはこれらすべてのオブジェクトを使ってFiberツリーと呼ばれるものを構築します。ツリーの各ノードはFiber、またはFiberノードと呼ばれます。UIを説明するためにJavaScriptオブジェクトからなる独自のノードツリーを作成することを、「仮想DOM」を作成すると言います。</p>
<p><img src="https://anthonyalicea.com/assets/blogimages/ReactCompiler_FiberTree.png"></p>
<p>Reactでは、ツリーの各ノードから枝分かれする2本の枝があります。1つは"current"（DOMと一致）、もう1つは"work-in-progress"（関数を再実行した際に返された内容をもとに構築したツリーと一致）の枝（ツリー）です。</p>
<p><img src="https://anthonyalicea.com/assets/blogimages/ReactCompiler_Reconciliation.png"></p>
<p>Reactはこれら2つのツリーを比較した上で、DOMがwork-in-progress側のツリーと一致するように実際のDOMに対して行う変更を判断します。このプロセスを「差分検出処理（reconciliation）」と呼びます。</p>
<p>したがって、他にどのような機能をアプリに追加するかによっては、ReactはUIの更新が必要だと判断するたびに<code class="language-text">List</code>関数を繰り返し呼び出すかもしれません。そうするとメンタルモデルはかなり分かりやすくなります。UIの更新が必要な場合（例えば、ユーザーがボタンをクリックした場合など）、UIを定義する関数が再び呼び出され、Reactは関数が定義するUIの外観と一致するように、ブラウザ上で実際のDOMをどう更新するかを判断します。</p>
<p>しかし、<code class="language-text">processItems</code>関数が遅いと、<code class="language-text">List</code>を呼び出すコールも遅くなり、アプリ全体の反応が遅くなってしまいます。</p>
<h2>メモ化</h2>
<p>パフォーマンスコストの高い関数を繰り返し呼び出す必要がある場合、プログラミングによる解決策として、関数の結果をキャッシュします。このプロセスを「メモ化」と呼びます。</p>
<p>メモ化が機能するためには、関数が「純粋」でなくてはなりません。つまり、関数に同じ入力値を渡した場合、毎回同じ出力が得られなくてはならないということです。出力が毎回同じであれば、入力値と関連付けた形で出力を保存することができます。</p>
<p>次にそのパフォーマンスコストの高い関数を呼び出した際には、入力値を見て、同じ入力値の関数をすでに実行済みかをキャッシュで確認します。すでに実行していれば、再度その関数を呼び出すのではなく、キャッシュに保存された出力を取得します。前回その入力値が使用されたときと出力が同じであることが分かっているので、再度関数を呼び出す必要はありません。</p>
<p>前述のコード例で使用した<code class="language-text">processItems</code>関数がメモ化を実装した場合、次のようになります。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">processItems</span><span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> memOutput <span class="token operator">=</span> <span class="token function">getItemsOutput</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>memOutput<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> memOutput<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...run expensive processing</span>
        <span class="token function">saveItemsOutput</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> output<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">saveItemsOutput</code>関数は、アイテムと、この関数と関連する出力の両方を保存するオブジェクトを格納するものだと考えてください。<code class="language-text">getItemsOutput</code>は、<code class="language-text">item</code>がすでに保存されているかを確認し、保存されていればそれ以上の作業は行わず、キャッシュに保存された関連する出力を返します。</p>
<p>関数を繰り返し呼び出すReactのアーキテクチャにとって、メモ化はアプリの動作が遅くならないようにするための重要な技術です。</p>
<h2>Hooksの保存</h2>
<p>React Compilerを理解するために理解する必要のあるReactのアーキテクチャがもう1つあります。</p>
<p>アプリの「state」（UIの作成に必要なデータ）が変わると、Reactは再度関数を呼び出す必要があるか判断します。例えば、値がtrueかfalseである"showButton"というデータの場合、このデータの値に応じて、UIはボタンを表示するか、非表示にする必要があります。</p>
<p>Reactはクライアントのデバイス上にstateを保存します。どうやって保存するのでしょうか。いくつかのアイテムをレンダリングし、操作するReactアプリを例に見てみましょう。最終的に選択されたアイテムを保存し、アイテムをクライアント側でレンダリングし、イベントを処理し、リストをソートすると仮定します。アプリは次のようになります。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: fetch some items here</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">List</span></span> <span class="token attr-name">items</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>selItem<span class="token punctuation">,</span> setSelItem<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>itemEvent<span class="token punctuation">,</span> dispatcher<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>sort<span class="token punctuation">,</span> setSort<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> pItems <span class="token operator">=</span> <span class="token function">processItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> pItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> listItems <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>JavaScriptエンジンが<code class="language-text">useState</code>と<code class="language-text">useReducer</code>の行を実行した際、何が起きるでしょうか。<code class="language-text">List</code>コンポーネントをもとに作成したFiberツリーのノードには、データを保存するためのJavaScriptオブジェクトがいくつか追加されています。各オブジェクトは互いに連結し、連結リストと呼ばれるデータ構造になっています。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>多くの開発者は、<code class="language-text">useState</code>がReactにおけるstate管理の肝だと考えていますが、そうではありません。これは単に、<code class="language-text">useReducer</code>を呼び出すコールのラッパーです。</p></div></div>
<p><video controls src="/static.mp4" title="Title"></video></p>
<p><code class="language-text">useState</code>と<code class="language-text">useReducer</code>を呼び出すと、ReactはstateをFiberツリーに付け加え、アプリが実行されている間、これらは保持されます。したがって、関数が繰り返し再実行される間、stateはいつでも利用できる状態にあります。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>Hooksの保存方法は、Hooksをループまたはif文の中で呼び出せないという「Hooksのルール」の説明にもなります。Hooksを呼び出すたびに、Reactは連結リストの次のアイテムに移動します。したがって、Hooksを呼び出す回数は一貫している必要があります。一貫していないと、Reactは連結リストの中の間違ったアイテムを指す場合があります。</p></div></div>
<p>結局、Hooksはユーザーデバイスのメモリ上にデータ（および関数）を保存するオブジェクトに過ぎないのです。これは、React Compilerが実際に行う処理を理解する上で重要です。ただし、それだけではありません。</p>
<h2>Reactにおけるメモ化</h2>
<p>Reactは、メモ化の概念とHooksの保存の概念を組み合わせています。Fiberツリーの一部であり、Reactに渡すすべての関数（<code class="language-text">List</code>など）の結果をメモ化することも、それらの中で呼び出す個別の関数（<code class="language-text">processItems</code>など）をメモ化することもできます。</p>
<p>キャッシュは、stateと同じようにFiberツリー上に保存されます。例えば、<code class="language-text">useMemo</code>は<code class="language-text">useMemo</code>を呼び出すノード上に入力値と出力を保存します。</p>
<p>つまり、Reactにはパフォーマンスコストの高い関数の結果を、Fiberツリーの一部であるJavaScriptオブジェクトの連結リストに保存するという概念がすでに備わっているということです。これは素晴らしいことですが、1つ問題があります。メンテナンスです。</p>
<p>Reactにおけるメモ化は、メモ化が依存する入力値を明示的にReactに伝える必要があるため、面倒です。<code class="language-text">processItems</code>を呼び出すコールは次のようになります。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> pItems <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token function">processItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>items<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>最後の配列は「依存関係」のリスト、すなわち変更されたらReactに再度関数を呼び出すよう指示する入力値です。これらの入力値が正しくないと、メモ化は正しく機能しません。事務的な雑務として維持し続ける必要があります。</p>
<h2>React Compiler</h2>
<p>ここでReact Compilerの登場です。React Compilerは、Reactコードのテキストを解析し、JSXのトランスパイルを行うための準備ができた新しいコードを生成するプログラムです。ただし、その新しいコードには追加された要素があります。</p>
<p>この場合、React Compilerがアプリに対してどのような処理を行うのか見てみましょう。以下はコンパイル前の状態です。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO: fetch some items here</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">List</span></span> <span class="token attr-name">items</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>selItem<span class="token punctuation">,</span> setSelItem<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>itemEvent<span class="token punctuation">,</span> dispatcher<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>sort<span class="token punctuation">,</span> setSort<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> pItems <span class="token operator">=</span> <span class="token function">processItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> listItems <span class="token operator">=</span> pItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token punctuation">{</span> listItems <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>コンパイル後は次のようになります。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> t0<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"react.memo_cache_sentinel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t0 <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">List</span></span> <span class="token attr-name">items</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> t0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t0 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> t0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter">t0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> t0<span class="token punctuation">;</span>
  <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> t1<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"react.memo_cache_sentinel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> t1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t1 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> t2<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pItems <span class="token operator">=</span> <span class="token function">processItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t3<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"react.memo_cache_sentinel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">t3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>

      $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      t3 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    t2 <span class="token operator">=</span> pItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> items<span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> t2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t2 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> listItems <span class="token operator">=</span> t2<span class="token punctuation">;</span>
  <span class="token keyword">let</span> t3<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">!==</span> listItems<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t3 <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>listItems<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> listItems<span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t3 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> t3<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>これが新しく書き直されたList関数です。かなりの情報量なので、少し分解して説明します。</p>
<p>冒頭に次の行があります。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>この<code class="language-text">_c</code>関数（"c"は「キャッシュ」を表します）は、Hooksを使用して保存される配列を作成します。React Compilerは<code class="language-text">Link</code>関数を解析し、パフォーマンスを最大限に高めるには6つのものを保存する必要があると判断したのです。最初に関数が呼び出されたとき、その6つのものの結果を配列に保存します。</p>
<p>次に関数が呼び出されたときにはキャッシュが使われます。例として、<code class="language-text">processItems</code>を呼び出す部分を見てみましょう。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pItems <span class="token operator">=</span> <span class="token function">processItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t3<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"react.memo_cache_sentinel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">t3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
        $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        t3 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    t2 <span class="token operator">=</span> pItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> items<span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> t2<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t2 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>関数の呼び出しと<code class="language-text">li</code>の生成の両方を含む、<code class="language-text">processItems</code>に関するすべての処理がラップされた状態で、配列で2番目のキャッシュ（<code class="language-text">$[1]</code>）が、前回関数が呼び出されたときと同じ入力値かどうかを確認します（<code class="language-text">List</code>に渡される<code class="language-text">items</code>の値）。</p>
<p>同じであれば、キャッシュ配列で3番目の位置（<code class="language-text">$[2]</code>）が使われます。<code class="language-text">items</code>のマッピングが完了すると、生成されたすべての<code class="language-text">li</code>のリストが保存されます。React Compilerのコードはこう言っているのです。「前回この関数を呼び出したときと同じアイテムのリストを渡してくれたら、前回キャッシュに保存した<code class="language-text">li</code>のリストをあげます。」</p>
<p>前回と違う<code class="language-text">items</code>を渡すと、<code class="language-text">processItems</code>を呼び出します。その場合でも、リストの中の個々のアイテムについての情報をキャッシュに保存します。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"react.memo_cache_sentinel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">t3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t3 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">t3 = </code>の行をご覧ください。<code class="language-text">li</code>を返すアロー関数を再度作成するのではなく、キャッシュ配列で4番目の位置（<code class="language-text">$[3]</code>）に関数自体を保存しています。これにより、JavaScriptエンジンは次に<code class="language-text">List</code>が読み出されたときにこの関数を作成する必要がなくなります。この関数は決して変わることがないため、最初のif文は基本的にこう言っています。「キャッシュ配列のこの場所が空いているならキャッシュしてください。空いていなければキャッシュから取得してください。」</p>
<p>このようにして、Reactは自動的に値をキャッシュし、関数の結果をメモ化します。Reactが出力するコードは我々が書いたコードと機能は同じですが、これらの値をキャッシュするためのコードを含んでおり、Reactが繰り返し関数を呼び出すことでパフォーマンスが損なわれないようにしています。</p>
<p>ただし、React Compilerのキャッシュは開発者が一般的にメモ化で行うキャッシュよりも詳細であり、しかも自動的にこれを行っています。つまり、開発者は手動で依存関係やメモ化を管理する必要がないのです。コードさえ書けば、React Compilerがそれをもとに新しいコードを生成し、キャッシュを利用することで高速化も実現してくれます。</p>
<p>React CompilerがまだJSXを生成していることも言っておくべきでしょう。実際に実行されるコードは、JSXのトランスパイルを行った上でReact Compilerが生成したものです。</p>
<p>JavaScriptエンジンで実際に実行される（ブラウザに送られるか、サーバー上で実行される）<code class="language-text">List</code>関数は、次のようなものです。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter">t0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    items
  <span class="token punctuation">}</span> <span class="token operator">=</span> t0<span class="token punctuation">;</span>
  <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> t1<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"react.memo_cache_sentinel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> t1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t1 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> t2<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pItems <span class="token operator">=</span> <span class="token function">processItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t3<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">"react.memo_cache_sentinel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">t3</span> <span class="token operator">=</span> <span class="token parameter">item</span> <span class="token operator">=></span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> item
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      t3 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    t2 <span class="token operator">=</span> pItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> items<span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> t2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t2 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> listItems <span class="token operator">=</span> t2<span class="token punctuation">;</span>
  <span class="token keyword">let</span> t3<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">!==</span> listItems<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t3 <span class="token operator">=</span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> listItems
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> listItems<span class="token punctuation">;</span>
    $<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    t3 <span class="token operator">=</span> $<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> t3<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>React Compilerは、値をキャッシュするための配列と、そのために必要なすべてのif文を追加しました。JSXトランスパイラはJSXをネストされた関数に変換しました。あなたが書いたコードとJavaScriptエンジンが実行するコードの間には大きな違いがあります。つまり、他人が書いたコードが、自分が当初意図したとおりのものを生成してくれることを信用する必要があります。</p>
<h2>CPUの命令サイクルとデバイスメモリのトレードオフ</h2>
<p>メモ化とキャッシュは、大まかに言うとメモリを犠牲にしてCPUへの負荷を軽減することを意味します。CPUがパフォーマンスコストの高い演算を行わなくて済む代わりに、メモリ容量を消費してデータを保存しているのです。</p>
<p>React Compilerを使用するということは、デバイスのメモリ上にできるだけデータを保存するということです。ユーザーデバイスのブラウザ上でコードを実行する場合、この点はアーキテクチャの面で意識する必要があります。</p>
<p>多くのReactアプリでは大きな問題にならないでしょう。しかし、アプリ上で大量のデータを扱う場合、実験ステージを経たReact Compilerを使うのであれば、少なくともデバイスメモリが使用されることを意識し、メモリの使用状況を注視する必要があるでしょう。</p>
<h2>抽象化とデバッグ</h2>
<p>形式を問わず、コンパイルはすべて自分が書いたコードと実際に実行されるコードの間の抽象化レイヤーに相当します。</p>
<p>この記事で説明したように、React Compilerの場合、実際にブラウザに送られるコードの内容を理解するためには、自分のコードをReact Compilerにかけて、生成されたコードをJSXトランスパイラにかけてみる必要があります。</p>
<p>コードに抽象化レイヤーを加えることにはデメリットもあります。デバッグが難しくなる場合があるのです。だからと言って使用を避けた方がいいというわけではありませんが、デバッグ対象のコードは自分が書いたものだけではなく、ツールが生成したものだということは頭に入れておく必要があります。</p>
<p>抽象化レイヤーから生成されたコードをデバッグする上では、抽象化について正確なメンタルモデルを持っておくことが成果を大きく左右します。React Compilerの仕組みを完全に理解することで、生成されたコードをデバッグできるようになり、ストレスなく開発作業を行えるようになるでしょう。</p>
<h2>さらに深く掘り下げる</h2>
<p>このブログ記事が有益だと感じていただけたなら、筆者が提供している<a href="https://understandingreact.com/">Understanding React</a>というコースもぜひご検討ください。計16.5時間にわたり、Reactのあらゆる機能について同様に深く掘り下げています。生涯にわたるアクセス権とすべてのソースコード、修了証が得られます。</p>
<p>筆者はReactのソースコードも、React Compilerのソースコードも、すべて読みました。なぜかと言うと、Reactの仕組みを内部実装レベルから説明できるようにするためです。</p>
<p>React自体は、Webを基礎とし、その上に構築された大きな抽象化レイヤーです。抽象化ではよくあることですが、Reactを使用する開発者のほとんどは、その仕組みについて正確なメンタルモデルを持っていません。それが、Reactベースのアプリケーションをビルドし、デバッグする上で大きな影響を及ぼしています。しかし、Reactについて深く理解することは可能です。</p>
<p>React 19の機能とReact Compilerに関する新しい内容を近々コースに追加する予定です。すでに受講されている方は無料でご利用いただけます。<a href="https://understandingreact.com/">コースの方もぜひチェックしてみてください</a>。最初の6時間分の内容は、筆者のYouTubeチャンネルで無料公開しています。以下がその動画です。</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-XKvVyC6si0" title="Understanding React: The First 6 Hours" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<p>単に誰かが書いたコードをまねするだけではなく、自分の仕事を本当の意味で理解する旅に、一緒に出かけてみませんか？
-- トニー</p>]]></content:encoded></item><item><title><![CDATA[まだまだある実例に沿った:has()の使い方]]></title><description><![CDATA[:has()疑似クラスは筆者が断トツで一番気に入っているCSSの新機能です。筆者と同じ意見の読者も多いでしょう。少なくとも、State of CSSのアンケートに回答した方の中には多くいるはずです。…]]></description><link>https://postd.cc/more-real-world-uses-for-has/</link><guid isPermaLink="false">https://postd.cc/more-real-world-uses-for-has/</guid><category><![CDATA[開発手法・プロジェクト管理]]></category><category><![CDATA[CSS]]></category><pubDate>Fri, 30 Aug 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p><a href="https://css-tricks.com/almanac/selectors/h/has/">:has()疑似クラス</a>は筆者が断トツで一番気に入っているCSSの新機能です。筆者と同じ意見の読者も多いでしょう。少なくとも、<a href="https://2022.stateofcss.com/en-US/features/selectors/#has_selector">State of CSSのアンケートに回答した方の中には多くいるはずです</a>。セレクタを逆向きに指定できることで、これまでできると思いもしなかったようなすごいことがもっと可能になります。</p>
<p>「もっと」と言うのは、すでに多くの人が極めてスマートなアイデアを色々と発表しているからです。以下に一部紹介します。</p>
<ul>
<li><a href="https://webkit.org/blog/13096/css-has-pseudo-class/">Using :has() as a CSS Parent Selector and much more</a>（Jen Simmons）</li>
<li><a href="https://www.bram.us/2022/12/13/quantity-queries-for-islands-of-elements-with-the-same-class-thanks-to-css-has/">Quantity Queries for “islands of elements” with the same class, thanks to CSS :has()</a>（Bramus）</li>
<li><a href="https://www.bram.us/2022/11/17/style-a-parent-element-based-on-its-number-of-children-using-css-has/">Style a parent element based on its number of children（Bramus）
Using combinators in :has()</a>（Manuel Matuzović）</li>
<li><a href="https://www.bram.us/2022/11/17/style-a-parent-element-based-on-its-number-of-children-using-css-has/">4 ways CSS :has() can make your HTML forms even better</a>（Austin Gil）</li>
<li><a href="https://www.youtube.com/watch?v=ljD_ENTYuB8&#x26;t=233s">Video: Practical Use Cases for :has() Pseudo-Class</a>（Zoran Jambor）
<a href="https://developer.chrome.com/blog/has-m105/">:has(): the family selector</a>（Jhey Tompkins）</li>
</ul>
<p>この記事は、:has()の使い方に関する包括的なガイドではありません。すでに誰かが語ったことを繰り返しているわけでもありません。ちょっとだけ流行に乗って(hi👋)筆者が考えている:has()の使い方を紹介できればと思い、この記事を書いています。ただし、実際に使うのはブラウザ側の対応がもう少し進んでからですが。（Firefoxだけが未対応ですが、もうすぐ対応すると思います。）（※訳註　2024年8月現在は対応済）</p>
<p>その日が来れば、間違いなく:has()を使いまくるでしょう。筆者が最近ビルドした実例から、:has()の恩恵を特に受けそうなものをいくつか紹介します。</p>
<h2>JavaScriptコンポーネントの外部要素と連携しなくて済む</h2>
<p>ページの他の部分のスタイルを変える必要のあるインタラクティブコンポーネントを作成したことはありますか？　次の例をご覧ください。ここで、<code class="language-text">&lt;nav></code>は<a href="https://css-tricks.com/i-saw-two-mega-menus-today/">メガメニュー</a>を表し、開くとその上の<code class="language-text">&lt;header></code>コンテンツの色が変わります。</p>
<p>筆者の仕事ではこうした処理がしょっちゅう必要になります。</p>
<p>これは、筆者があるサイトで使用するために作ったReactコンポーネントです。この例では、document.querySelector(...)を使用してページのReact以外の部分と連携し、<code class="language-text">&lt;body></code>、<code class="language-text">&lt;header></code>または別のコンポーネントのクラスを切り替える必要がありました。この世の終わりというほどのことではありませんが、面倒であることに違いありません。全部Reactで記述したサイト（Next.jsサイトなど）であっても、menuIsOpenのstateをコンポーネントツリーのずっと上の方で管理するか、あまりReact的ではありませんが、先程挙げた例と同じように、DOM要素の取得とクラスの切り替えを行う必要があります。</p>
<p>この問題は、:has()を使うことで解決します。</p>
<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">header:has(.megamenu--open)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* style the header differently if it contains 
    an element with the class ".megamenu--open"
  */</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>JavaScriptコンポーネントの他のDOM要素をいじる必要はもうありません！</p>
<h2>ストライプテーブル作成UXの向上</h2>
<p>1行おきに背景色を追加した「ストライプテーブル」は、UXの向上に役立ちます。行を目で追いやすくなるため、表が見やすくなります。
しかし、筆者の経験では2、3行しかない表ではあまりうまく行きません。例えば、<code class="language-text">&lt;tbody></code>が3行の表で「偶数」行に背景色を付けた場合、色付きの行は1行だけになります。そうするとあまり意味はなく、ハイライトされた1行に何か特別な意味があるのではないかと逆にユーザーを困惑させてしまうことになり兼ねません。</p>
<p><a href="https://www.bram.us/2022/11/17/style-a-parent-element-based-on-its-number-of-children-using-css-has/">Bramus氏が:has()を使用して子の数に応じてスタイルを使い分ける</a>方法を説明していますが、このテクニックを使用することで、4行以上ある表にストライプスタイルを適用することができます。</p>
<p class="codepen" data-height="300" data-default-tab="html,result" data-slug-hash="dyjyqmR" data-pen-title="Conditional table striping with :has()" data-user="liamj" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/liamj/pen/dyjyqmR">
  Conditional table striping with :has()</a> by Liam (<a href="https://codepen.io/liamj">@liamj</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
<p>もっと手の込んだことがしたければ、列の数が一定数以上の場合のみストライプスタイルを適用することもできます。</p>
<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">table:has(:is(td, th):nth-child(3))</span> <span class="token punctuation">{</span>
  <span class="token comment">/* only do stuff if there are three or more columns */</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2>テンプレートから条件ロジックを含むクラスを取り除く</h2>
<p>ページの内容に応じてレイアウトを変えなくてはならないことがよくあります。以下のグリッドレイアウトをご覧ください。サイドバーの有無に応じて、メインコンテンツが配置されるグリッド領域が変わっています。</p>
<p><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/12/s_3C0A8FC3F034E5EE17FAF2704E4BF0FB7F3CBE50853FB2A8A6B7B502A838DC20_1671494338550_ScreenShot2022-12-19at11.23.58AM.png?resize=1024%2C861&#x26;ssl=1"></p>
<p>これは、CMSに兄弟ページが設定されているかどうかで変わる可能性があります。筆者は通常、両方のレイアウトに対応するため、テンプレートロジックを使用してレイアウトのラッパーに<a href="https://css-tricks.com/taming-the-cascade-with-bem-and-modern-css-selectors/">BEM修飾子クラス</a>を条件付きで追加しています。その場合、CSSは次のようになります（簡略化のため、レスポンシブルールなどは省いています）。</p>
<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* m = main content */</span>
<span class="token comment">/* s = sidebar */</span>
<span class="token selector">.standard-page--with-sidebar</span> <span class="token punctuation">{</span>
  <span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">'s s s m m m m m m m m m'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.standard-page--without-sidebar</span> <span class="token punctuation">{</span>
  <span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">'. m m m m m m m m m . .'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>CSS的には、もちろんこれでも全く問題ありません。しかし、若干ごちゃごちゃしたテンプレートコードにはなってしまいます。テンプレートに使用する言語によっては、多くのクラスを条件付きで追加すると、かなり乱雑な見た目になってしまう場合があります。多くの子要素も使用しなければならない場合は特にそうです。</p>
<p>では、:has()を使ったやり方と比べてみてください。</p>
<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* m = main content */</span>
<span class="token comment">/* s = sidebar */</span>
<span class="token selector">.standard-page:has(.sidebar)</span> <span class="token punctuation">{</span>
  <span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">'s s s m m m m m m m m m'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.standard-page:not(:has(.sidebar))</span> <span class="token punctuation">{</span>
  <span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">'. m m m m m m m m m . .'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>正直なところ、CSS的にはそれほど大きな改善ではありません。しかし、HTMLテンプレートからモディファイアー部分のクラス名を省けるのはプラスだと思います。</p>
<p>:has()を使ったデザインの小技は簡単に思い浮かびます（<a href="https://css-tricks.com/creating-animated-clickable-cards-with-the-has-relational-pseudo-class/">例えば画像入りのカードなど</a>）が、こうしたレイアウトの大きな変更にもかなり威力を発揮すると思います。</p>
<h2>詳細度を管理しやすい</h2>
<p><a href="https://css-tricks.com/taming-the-cascade-with-bem-and-modern-css-selectors/">前回の記事</a>を読んだ方であれば、筆者が詳細度にうるさいことはご存じかと思います。筆者のように、スタイル全体に:has()や:not()を追加することで詳細度が上がりすぎるのを避けたい場合は、:where()を使用するようにしましょう。</p>
<p>これは、:has()の詳細度は引数リストの中で最も詳細度の高い要素に基づくためです。したがって、IDのようなものが含まれていれば（なぜかは分かりませんが）、カスケード上でセレクタがオーバーライドされにくくなります。</p>
<p>一方、<a href="https://css-tricks.com/almanac/selectors/w/where/">:where()の詳細度は常にゼロ</a>なので、詳細度が上がることはありません。</p>
<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* specificity score: 0,1,0.
  Same as a .standard-page--with-sidebar 
  modifier class
*/</span>
<span class="token selector">.standard-page:where(:has(.sidebar))</span> <span class="token punctuation">{</span>
  <span class="token comment">/* etc */</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>未来は明るい</h2>
<p>これらはほんの一部ですが、本番環境で使えるようになるのが待ち遠しいです。（※訳註　2024年8月現在は対応済）
<a href="https://css-tricks.com/almanac/selectors/h/has/#aa-use-cases">CSS-Tricks Almanacでも多くの実例が紹介されています</a>。皆さんは:has()を使ってどんなことがしたいですか？　あなたが実際に直面したシチュエーションで、:has()が完璧な解決策になりそうなものはこれまでにありましたか？</p>]]></content:encoded></item><item><title><![CDATA[useDeferredValueを使用してUIを素早く最適化する]]></title><description><![CDATA[登場以来、Reactはアプリケーションのパフォーマンスを最適化するためのツールを多数供してきました。中には極めて有益でありながら、あまり知られていないものもあります。はその一つです。このツールは、特…]]></description><link>https://postd.cc/use-deferred-value/</link><guid isPermaLink="false">https://postd.cc/use-deferred-value/</guid><category><![CDATA[開発手法・プロジェクト管理]]></category><category><![CDATA[React]]></category><pubDate>Mon, 22 Jul 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p>登場以来、Reactはアプリケーションのパフォーマンスを最適化するためのツールを多数供してきました。中には極めて有益でありながら、あまり知られていないものもあります。<code class="language-text">useDeferredValue</code>はその一つです。このツールは、特定の状況においてユーザーエクスペリエンスを大きく左右することができます。⚡</p>
<p>筆者は最近このフックを使用し、このブログの厄介なパフォーマンス問題を解決したのですが、そのあまりの効果に衝撃を受けました。低性能デバイスでは反則級の改善が見られ、まるで黒魔術のようでした。</p>
<p><code class="language-text">useDeferredValue</code>には若干気後れさせるような評判があり、実際かなり洗練されたツールではあるのですが、正しいメンタルモデルで向き合えば恐るるに足りません。このチュートリアルでは、その仕組みと、アプリケーションのパフォーマンスを劇的に改善させる使い方を詳しく説明します。</p>
<h2>問題</h2>
<p>数年前、筆者は本物のような影を生成する<a href="https://www.joshwcomeau.com/shadow-palette/">Shadow Palette Generator</a>というツールをリリースしました。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/videos/use-deferred-value/shadow-palette-initial.mp4"></video></p>
<p>スライダーなどのUIコントロールを動かしてみることで、自分だけの影をデザインすることができます。CSSコードを自分のアプリケーションにコピペすることも可能です。</p>
<p><strong>問題は次の点です</strong>。このUI上のコントロールは、「即座に」結果が反映されるよう設計されています。例えば、ユーザーが「Oomph」スライダーを動かすと、その効果がすぐに見られます。つまり、スライダーを動かす間、UIが「1秒間に数十回再レンダリングされる」ということです。</p>
<p>Reactは高速ですし、このUIの大部分は容易にアップデート可能です。問題は、<strong><em>シンタックスハイライトされた下部のコードスニペット</em></strong>です。</p>
<p><img src="https://www.joshwcomeau.com/_next/image/?url=%2Fimages%2Fuse-deferred-value%2Fcss-snippet.png&#x26;w=640&#x26;q=75"></p>
<p>シンタックスハイライトの処理は驚くほど複雑です。まず、rawコードを「トークン化」する必要があります。この工程では、コードをいくつかに分けてラベルを付けます。各トークンには異なる色を付けられるため、それぞれ<code class="language-text">&lt;span></code>タグでラップする必要があります。</p>
<p>このスニペットの中の1行に対して必要なマークアップの量は以下の通りです。</p>
<p><img src="https://www.joshwcomeau.com/images/use-deferred-value/single-line-of-code.png"></p>
<p>最適化していない状態だと、Reactはこれだけのマークアップを
<strong><em>1秒間に何十回も</em></strong>再計算する必要があります。ほとんどのデバイスでは、ブラウザの処理が追いつかず、画面がカクカクします。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/videos/use-deferred-value/shadow-palette-janky.mp4"></video></p>
<p><code class="language-text">change</code>イベントは1秒間に最大60回発生しますが、UIが1秒間に処理できる更新の数はわずかです。UIの質が低く、反応が悪いと感じるのはそのためです。</p>
<p><strong>これは興味深い問題です</strong>。このUIで最も重要な部分は、影の外観を示した左側の図です。この部分は、ユーザーが設定変更の影響を把握できるよう、変更が行われたら直ちに更新することが望まれます。また、コントロール自体も反応良くスムーズに動かないといけません。</p>
<p>一方、コードスニペットは1秒間に何十回も更新する必要はありません。ユーザーにとって重要なのは、自分のアプリケーションにコピーする最終的なコードだけです。変更を加えるたびに再計算を行うと、ユーザーエクスペリエンス全体が損なわれてしまいます。
言い換えると、このUIには優先度の高い領域（High Priority）と低い領域（Low Priority）があるということです。</p>
<p><img src="https://www.joshwcomeau.com/images/use-deferred-value/high-vs-low-priority.png"></p>
<p>優先度の高い領域はリアルタイムに、できるだけ迅速に更新し、優先度の低い領域は後回しにします。</p>
<h2>不完全なソリューション</h2>
<p>この問題を解決するために、私は当初「スロットリング」という手法を用いました。具体的に言うと、このコンポーネントに対して200ミリ秒ごとにしか再レンダリングできないように制限をかけたのです。
その結果がこちらです。</p>
<p><video controls src="https://www.joshwcomeau.com/videos/use-deferred-value/shadow-palette-initial.mp4" title="ttps://www.joshwcomeau.com/videos/use-deferred-value/shadow-palette-janky.mp4"></video></p>
<p>UIの他の部分に比べてコードスニペットの更新頻度が低いことに気づいたでしょうか。UIの他の部分は必要に応じて何度でも再レンダリングできますが、この部分は200ミリ秒に1回、つまり1秒間に5回しか更新されません。</p>
<p><em>この方法でも問題は改善します</em>が、完全なソリューションと言うには程遠い結果です。</p>
<p>まだ少し遅く、低品質に感じます。UIの一部を意図的に遅くしていることはユーザーには分からないので。</p>
<p>もっと重要な点は、超高性能な最新のコンピューターや低価格の古いAndroidスマホなど、人によって使用するデバイスはさまざまだということです。ユーザーのデバイスが十分高速なら、スロットリングは不要であり、意味もなく処理速度を下げているだけです。一方、デバイスが本当に遅ければ、200ミリ秒でさえ十分ではない可能性があり、そうするとUIの重要な部分がスムーズに表示されません。</p>
<p>こうした問題の解決に有効なのが、useDeferredValueです。</p>
<h2>useDeferredValueの紹介</h2>
<p><code class="language-text">useDeferredValue</code>は、UIを優先度の高い領域と低い領域に切り分けられるReactフックです。何か重要なことが起きると、Reactが処理を中断できるようにします。</p>
<p><strong>仕組みを理解するために、簡単な例から見ていきましょう</strong>。次のコードをご覧ください。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ImportantStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SlowStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Increment
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>ここでのstateは<code class="language-text">count</code>です。これは、ボタンをクリックするごとに増えていく数字です。<code class="language-text">ImportantStuff</code>はUIの中で優先度の高い部分を表します。つまり、<code class="language-text">count</code>が増えるたびに直ちに更新したい部分です。<code class="language-text">SlowStuff</code>は、UIの中で重要性が低い部分を表します。</p>
<p>ユーザーがボタンをクリックして<code class="language-text">count</code>が増えるたびに、ReactはUIを更新する前にこれらの子コンポーネントを両方とも再レンダリングする必要があります。</p>
<p><strong>詳しく分析してみましょう</strong>。下のボタンをクリックして、実際にレンダリングが行われる様子をご覧ください。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="/static.mov"></video>
（訳注：<a href="https://www.joshwcomeau.com/react/use-deferred-value/">イメージはキャプチャーです。インタラクティブサンプルは翻訳元サイトで確認できます</a>）</p>
<p>このデモのUIは、録画されたインタラクションの動画です。<strong>タイムラインのスライダーを動かすと、その時点のUIの状態を確認することができます</strong>。ボタンをクリックするとレンダリングが始まりますが、レンダリングが完了するまでUIが更新されない点に注目してください。</p>
<p><code class="language-text">ImportantStuff</code>と<code class="language-text">SlowStuff</code>の両方のレンダリングが、Reactが行う必要のある処理の全体です。<strong>次のスナップショットをクリックまたはタップして、中をのぞいてみてください</strong>。</p>
<p><a href="https://www.joshwcomeau.com/react/use-deferred-value/"><img src="/static.png"></a>
（訳注：<a href="https://www.joshwcomeau.com/react/use-deferred-value/">イメージはキャプチャーです。インタラクティブサンプルは翻訳元サイトで確認できます</a>）</p>
<p>この仮想的な例では、<code class="language-text">ImportantStuff</code>は極めて高速でレンダリングされ、ほとんどの時間は<code class="language-text">SlowStuff</code>のレンダリングに費やされます。</p>
<p>ユーザーがボタンをクリックする間隔が短すぎると、Reactが処理を完了する前に次の更新が行われるため、レンダリングが積み重なってしまいます。そうすると、UIが低品質に感じられます。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="/static.mov"></video>
（訳注：<a href="https://www.joshwcomeau.com/react/use-deferred-value/">イメージはキャプチャーです。インタラクティブサンプルは翻訳元サイトで確認できます</a>）</p>
<p>最初のレンダリング（<code class="language-text">count: 1</code>）が完了する前にユーザーが再度ボタンをクリックし、<code class="language-text">count</code>が<code class="language-text">2</code>になります。Reactは最初のレンダリングを放棄し、正しい<code class="language-text">count</code>値で新しいレンダリングを開始します。UIは、レンダリングが正常に完了して初めて更新されます。</p>
<p>これらを踏まえた上で、<code class="language-text">useDeferredValue</code>を使ってどのように問題を解決できるのか見てみましょう。</p>
<p>以下がコードです。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deferredCount <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ImportantStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SlowStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>deferredCount<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Increment
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>最初のレンダリングでは、<code class="language-text">count</code>と<code class="language-text">deferredCount</code>の値はどちらも(<code class="language-text">0</code>)です。しかし、ユーザーが「Increment」ボタンをクリックすると興味深い現象が起こります。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="/static.mov"></video>
（訳注：<a href="https://www.joshwcomeau.com/react/use-deferred-value/">イメージはキャプチャーです。インタラクティブサンプルは翻訳元サイトで確認できます</a>）</p>
<p>今度は、レンダリングごとに<code class="language-text">count</code>の値と、<SlowStuff>に渡される遅延させた値（deferred value）が表示されます。ラベルを表示するスペースがない場合、<code class="language-text">count</code>と<code class="language-text">deferredCount</code>の値のみ、線で区切られて表示されます。</p>
<div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><strong>試してみよう</strong> <br>
何が起きているのかは後ほど詳しく説明します。まずは自分で少し触ってみてください。Reactがどのような処理を行っていて、それがなぜ有益なのか分かりますか？</p><p><strong>タイムラインは友達です</strong>。黄色いスライダーをクリックするか押さえてドラッグすることで、動画を前後に進めることができます。もしくは、タイムラインを選択し、左右の矢印キーで1フレームずつ動かすこともできます。</p></div></div>
<p>では詳しく見てみましょう。<code class="language-text">count</code> stateが変わると、<code class="language-text">App</code>コンポーネントは直ちに再レンダリングを行います。<code class="language-text">count</code>は<code class="language-text">1</code>になりますが、興味深いことに、<code class="language-text">deferredCount</code>は変わっておらず、<code class="language-text">0</code>のままです。</p>
<p>これはつまり、<code class="language-text">SlowStuff</code>に渡されたpropsが前回のレンダリング時と全く同じだということです。<code class="language-text">React.memo()</code>によってメモ化されている場合、Reactは何を生成するかすでに分かっているため、わざわざ再レンダリングすることなく、最初のレンダリング時のデータを再利用します。</p>
<p>そのレンダリングが完了すると、すぐに2回目の再レンダリングが始まりますが、今度は<code class="language-text">deferredCount</code>が更新されており、<code class="language-text">count</code>の値と同じ1になっています。これは、今回は<code class="language-text">SlowStuff</code>の再レンダリングが行われることを意味します。ここまでの処理が完了すると、UIが完全に更新されます。</p>
<p><strong>そこまでする必要はあるのでしょうか？</strong>ここまで読んで、不必要に複雑だと感じている読者もいるかもしれません。結果は前と同じなのに、処理が増えているのではないかと。</p>
<p><strong>この仕組みが非常に優れている理由を説明しましょう</strong>。再度stateが変わり、Reactの処理が中断された場合、重要な情報はすでに更新されています。Reactは、重要性の低い2回目のレンダリングを放棄し、より重要な部分のレンダリングを直ちに開始することができます。</p>
<p>言葉で説明するのは難しいですが、次の録画を見ていただくと違いが分かるのではないでしょうか。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="/static.mov"></video>
（訳注：<a href="https://www.joshwcomeau.com/react/use-deferred-value/">イメージはキャプチャーです。インタラクティブサンプルは翻訳元サイトで確認できます</a>）</p>
<p>前に見た動画と同じように、ユーザーがクリックする間隔が短すぎて、Reactは全ての情報を更新することができていません。しかし、再レンダリングごとに優先度の高い部分と低い部分が分かれているため、Reactはクリック間に重要な部分を更新することができているのです。追加でクリックが行われると、Reactは進行中のレンダリングを放棄しますが、優先度が低い情報のため問題ありません。</p>
<p>これはなかなか難しい問題です。少し難しすぎると感じているようでしたら、次のセクションで基本的な仕組みを説明しているので、こちらを読んでいただくといいでしょう。</p>
<h2>落とし穴：メモ化が必要</h2>
<p>一つ重要な点を述べます。<code class="language-text">useDeferredValue</code>は、優先度の低い、レンダリングの遅いコンポーネントが<code class="language-text">React.memo()</code>でラップされている場合のみ機能します。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">SlowComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Component stuff here</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>SlowComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">React.memo()</code>はReactに対し、propsまたはstateが変わった場合のみこのコンポーネントを再レンダリングするよう指示します。<code class="language-text">React.memo()</code>がなければ、countのpropsが変わったかどうかにかかわらず、<code class="language-text">SlowComponent</code>は親コンポーネントが再レンダリングされるたびに再レンダリングされます。</p>
<p><strong>これは本当に重要なことなので、きちんと理解する必要があります。もう少し深掘りしてみましょう</strong>。繰り返しになりますが、以下がコードです。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deferredCount <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ImportantStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SlowStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>deferredCount<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Increment
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>ユーザーが初めてボタンをクリックすると、<code class="language-text">count</code> stateが<code class="language-text">0</code>から<code class="language-text">1</code>に増えます。Appコンポーネントは再レンダリングしますが、<code class="language-text">useDeferredValue</code>フックは前回の値を再利用します。<code class="language-text">deferredCount</code>は<code class="language-text">1</code>ではなく<code class="language-text">0</code>に設定されます。</p>
<p>デフォルトでは、Reactはpropsが変わったかどうかにかかわらず、全ての子コンポーネントを再レンダリングします。<code class="language-text">React.memo()</code>が設定されていなければ、<code class="language-text">ImportantStuff</code>も<code class="language-text">SlowStuff</code>も再レンダリングされるため、<code class="language-text">useDeferredValue</code>を使用するメリットが得られません。</p>
<p><code class="language-text">SlowStuff</code>を<code class="language-text">React.memo()</code>でラップすると、Reactは現在のpropsを前回のものと比較し、再レンダリングが必要かどうかを判断します。<code class="language-text">deferredCount</code>が<code class="language-text">0</code>のままなので、Reactは「新しい情報はないようだ。UIのこの部分を再計算する必要はない」と判断します。</p>
<p><strong>これは筆者にとって目からうろこでした</strong>。<code class="language-text">useDeferredValue</code>は、UIの中で優先度が低い部分のレンダリングを（退屈な宿題を先延ばしにするように）後回しにすることを可能にします。最終的にはレンダリングが行われ、UIは全て更新されますが、一旦保留にするということです。stateが変わるたびに、Reactはレンダリングを中断し、より重要な情報のレンダリングに注力するのです。</p>
<div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><strong>Reactのレンダリングについて考える上でのメンタルモデル</strong> <br>
Reactのレンダリングの仕組みについて、かなり熟知している前提で話していることは分かっています。頭がクラクラしている読者には、筆者による次のブログ記事が大いに役立つと思います。</p><ul>
<li>“<a href="https://www.joshwcomeau.com/react/why-react-re-renders/">Why React Re-Renders</a>”（「Reactはなぜ再レンダリングするのか」）</li>
</ul></div></div>
<p>実に多くのReact開発者がReactのレンダリングの仕組みを誤解しているので、この記事を読んで誤解を解き、<code class="language-text">useDeferredValue</code>を理解する上で必要な知識を得ていただければと思います。</p>
<h2>落とし穴：複数のstate変数を扱う</h2>
<p>ここまでは、countのような単一のプリミティブ値を扱う場合における<code class="language-text">useDeferredValue</code>の仕組みについて見てきましたが、現実の世界では物事がそこまで単純なことはほとんどありません。</p>
<p>筆者が開発した「Shadow Palette Generator」では、関連するstateがいくつかあります。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ShadowPaletteGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>oomph<span class="token punctuation">,</span> setOomph<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>crispy<span class="token punctuation">,</span> setCrispy<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>backgroundColor<span class="token punctuation">,</span> setBackgroundColor<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'#F00'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tint<span class="token punctuation">,</span> setTint<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>resolution<span class="token punctuation">,</span> setResolution<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lightPosition<span class="token punctuation">,</span> setLightPosition<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cssCode <span class="token operator">=</span> <span class="token function">generateShadows</span><span class="token punctuation">(</span>oomph<span class="token punctuation">,</span> crispy<span class="token punctuation">,</span> backgroundColor<span class="token punctuation">,</span> tint<span class="token punctuation">,</span> resolution<span class="token punctuation">,</span> lightPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* Other stuff omitted for brevity */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CodeSnippet</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span> <span class="token attr-name">code</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>cssCode<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>最初は、それぞれのstateについて遅延させた値を作成しなくてはならないと考えていました。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">const</span> deferredOomph <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>oomph<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deferredCrispy <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>crispy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deferredBg <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deferredTint <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>tint<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deferredResolution <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>resolution<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deferredLight <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>lightPosition<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>そうすることもできますが、もっと簡単な方法があります。レンダリング時に生成されるCSSコードである計算値を遅延させるのです。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">const</span> cssCode <span class="token operator">=</span> <span class="token function">generateShadows</span><span class="token punctuation">(</span>oomph<span class="token punctuation">,</span> crispy<span class="token punctuation">,</span> backgroundColor<span class="token punctuation">,</span> tint<span class="token punctuation">,</span> resolution<span class="token punctuation">,</span> lightPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deferredCssCode <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>cssCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token comment">/* Other stuff omitted for brevity */</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CodeSnippet</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span> <span class="token attr-name">code</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>deferredCssCode<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>このフックは<code class="language-text">useDeferredState</code>ではなく、<code class="language-text">useDeferredValue</code>というものです。useDeferredValue() に渡す引数がstate変数でなくてはならないというルールはないのです！</p>
<p>基本的な仕組みを理解するのが非常に重要である理由はここにあります。重要なのは、優先度の高い部分のレンダリングを行っている際に、優先度の低いコンポーネント（この場合は<code class="language-text">CodeSnippet</code>）のpropsに新しい値が渡されないようにすることです。</p>
<h2>ローデ​​ィングアイコンの表示</h2>
<p>再計算が進行中であり、UIの一部の情報が古いことをユーザーに知らせたい場合があるかもしれません。</p>
<p>例えば、次のような表示を使用することもできます。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/videos/use-deferred-value/deferred-loading.mp4"></video></p>
<p><code class="language-text">&lt;SlowStuff></code>の更新が反映されるまでの間、その部分の画面を半透明にし、スピナーを表示します。そうすることで、ユーザーはUIの再計算が進行中であると分かります。</p>
<p><strong>では、どうすればUIの一部がまだ更新されていないと分かるのでしょうか？</strong>実は、それを判別するためのツールがすでにあるのです。</p>
<p>以下がコードです。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deferredCount <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isBusyRecalculating <span class="token operator">=</span> count <span class="token operator">!==</span> deferredCount<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ImportantStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SlowWrapper</span></span>
        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> isBusyRecalculating <span class="token operator">?</span> <span class="token number">0.5</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SlowStuff</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>deferredCount<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>isBusyRecalculating <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Spinner</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">SlowWrapper</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Increment
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>UIの情報が古いかどうかは、<code class="language-text">count</code>と<code class="language-text">deferredCount</code>を比較することで分かります。
筆者が最初にこれを見たときは、あまりに単純すぎて疑わしいと思いました。しかし、よく考えてみると理にかなっていたのです。</p>
<ul>
<li>優先度の高い最初のレンダリングで、<code class="language-text">deferredCount</code>は前回の値を再利用します。<code class="language-text">count</code>は<code class="language-text">1</code>に更新されますが、<code class="language-text">deferredCount</code>は<code class="language-text">0</code>のままです。両者の値は異なります。</li>
<li>次に行われる優先度の低いレンダリングでは、<code class="language-text">deferredCount</code>が最新の値である<code class="language-text">1</code>に更新されます。<code class="language-text">count</code>と<code class="language-text">deferredCount</code>の両方が同じ値になります。</li>
</ul>
<p>最初のレンダリング時に<code class="language-text">&lt;SlowStuff></code>のレンダリングを後回しにすることを可能にするのと同じ仕組みにより、UIがまだ完全に同期されていないことを見分けられるのです。実に秀逸ではないでしょうか。</p>
<p>実際にこれを行いたいかどうかは別問題です。筆者のShadow Palette Generatorで試してみました。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/videos/use-deferred-value/shadow-loading.mp4"></video></p>
<p>個人的には、この場合は改善しているとは言えないと思います。ユーザーには影の図に注目してもらいたいのに、コードスニペットの方に目が行ってしまいます。
しかし、場合によってはUIの一部の情報が古いことをユーザーに知らせる方法として役立つかもしれません。</p>
<h2>最初のレンダリングを高速化する</h2>
<p>数週間前にReact 19がベータ版に移行しました。間もなく公開されるこのメジャーアップデートでは、さまざまな変更が行われており、<code class="language-text">useDeferredValue</code>も大幅にパワーアップされる予定です。
React 19以前では、<code class="language-text">useDeferredValue</code>は与えられた値で初期化されていました。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deferredCount <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// On the initial render:</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>deferredCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count <span class="token operator">===</span> deferredCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Reactには使用可能な前回値がないため、ここで説明したような二重レンダリングは行いません。したがって、実質的に<code class="language-text">useDeferredValue</code>は最初のレンダリングに対しては効果がないのです。
しかし、React 19からは初期値を指定できるようになります。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">const</span> deferredCount <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p><strong>なぜそうする必要があるのでしょうか？</strong>このパターンでは、最初のレンダリングを高速化できる可能性があります。</p>
<p>例えば、Shadow Palette Generatorを使用して次のようなことができます。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">const</span> cssCode <span class="token operator">=</span> <span class="token function">generateShadows</span><span class="token punctuation">(</span>oomph<span class="token punctuation">,</span> crispy<span class="token punctuation">,</span> backgroundColor<span class="token punctuation">,</span> tint<span class="token punctuation">,</span> resolution<span class="token punctuation">,</span> lightPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deferredCssCode <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useDeferredValue</span><span class="token punctuation">(</span>
  cssCode<span class="token punctuation">,</span>
  <span class="token keyword">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token comment">/* Other stuff omitted for brevity */</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token punctuation">{</span>deferredCssCode <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CodeSnippet</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>css<span class="token punctuation">"</span></span> <span class="token attr-name">code</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>deferredCssCode<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>優先度の高い高速レンダリングでは、<code class="language-text">deferredCssCode</code>は<code class="language-text">null</code>となるため、<code class="language-text">&lt;CodeSnippet></code>はレンダリングすらされません。しかし、高速レンダリングが終わると、すぐにこのコンポーネントの再レンダリングが自動的に行われ、枠にコードが表示されます。</p>
<p>重要度の低いUI要素を待つ必要がないため、アプリケーション全体としてはレスポンスが向上するはずです。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p><strong>Reactのドキュメント</strong> <br>
このチュートリアルでは、useDeferredValueの主なユースケースの一つについて説明しましたが、Suspenseに対応したデータ取得ライブラリを使用する場合など、他にも役立つ場面があるでしょう。詳しくは<a href="https://react.dev/reference/react/useDeferredValue">Reactの公式ドキュメント</a>をご覧ください。</p></div></div>
<h2>劇的な変化</h2>
<p>それでは、<code class="language-text">useDeferredValue</code>フックを使用した場合の結果を見てみましょう。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/videos/use-deferred-value/shadow-palette-smooth.mp4"></video></p>
<p>最高です！何もかも非常に滑らかです。💯</p>
<p>でもちょっと待ってください。筆者がテストに使用しているのは高性能なMacBook Proです。より性能の低いデバイスではどうでしょうか？</p>
<p>数年前、近所のPCショップで一番安い新品のWindowsノートパソコンを買いたいと言ったところ、インテルCeleronプロセッサーを搭載した110米ドルのAcer製ノートパソコンを引っ張り出してきてくれました。このマシンを使用し、<code class="language-text">useDeferredValue</code>を実装した状態で動かすとこうなります。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/videos/use-deferred-value/shadow-palette-celeron.mp4"></video></p>
<p>さっきほど滑らかではありませんが、スタートメニューを開くのさえ時間がかかるマシンにしては悪くありません。コントロールの操作を終えるまでコードスニペットが更新されない点に注目してください。ここでは<code class="language-text">useDeferredValue</code>が大いに役立っています。</p>
<hr>
<p>Reactの多くの点について言えることですが、適切なメンタルモデルで臨まなければ<code class="language-text">useDeferredValue</code>は非常に複雑に感じられます。Reactは非常に洗練されたツールへと進化を遂げてきましたが、効果的に使いこなすためには、その仕組みを直感的に理解できるようになる必要があります。</p>
<p>筆者は2年近くかけてReactについて学べる究極のリソースを作り上げました。その名も<a href="https://www.joyofreact.com/">The Joy of React</a>です。仕事で10年近くReactを使ってきた経験から得た知識を全て網羅しています。</p>
<p>もしこのブログ記事が役に立ったと感じていただけたなら、筆者のコースから得られるものは多いと思います。このコースは、多くの気づきが得られ、Reactの仕組みに関する強力なメンタルモデルを形成でき、Reactを使用して豊かでダイナミックなWebアプリケーションを構築する方法を学べる内容となっています。</p>
<p><a href="https://www.joyofreact.com/"><img src="https://www.joshwcomeau.com/_next/image/?url=%2Fimages%2Fjoy-of-react.png&#x26;w=1920&#x26;q=75" alt="(https://www.joyofreact.com/)"></a></p>
<p>コースに関する詳細は以下をご覧ください。</p>
<ul>
<li><a href="https://joyofreact.com/">The Joy of React</a></li>
</ul>
<p>最後まで読んでいただきありがとうございました！ 💖</p>]]></content:encoded></item><item><title><![CDATA[言葉で説明できないとき：対話型インターフェースを超えるAIのためのデザイン]]></title><description><![CDATA[クイックサマリー：人工知能がコンピューティングパラダイムの進化をもたらしており、それに伴いデザイナーはより直感的なユーザーインターフェースを開発するチャンスに恵まれています。新しい機能のほとんどは、…]]></description><link>https://postd.cc/designing-ai-beyond-conversational-interfaces/</link><guid isPermaLink="false">https://postd.cc/designing-ai-beyond-conversational-interfaces/</guid><category><![CDATA[生成AI]]></category><category><![CDATA[UIデザイン]]></category><category><![CDATA[UXデザイン]]></category><pubDate>Fri, 21 Jun 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p><strong>クイックサマリー</strong>：人工知能がコンピューティングパラダイムの進化をもたらしており、それに伴いデザイナーはより直感的なユーザーインターフェースを開発するチャンスに恵まれています。新しい機能のほとんどは、テキストベースの大規模言語モデルによって実現されているため、グラフィカルインターフェースからチャットボットのような対話型インターフェースへの移行が必要との声が多く聞かれるようになっています。しかし、多くのインタラクションパターンにおいて、対話は優れたインターフェースではないことをかなりの証拠が示しています。最新のAI機能によって、対話だけにとどまらずヒューマンコンピューターインタラクションの未来がどう変わりうるのか、マクシミリアン・ピラスが考察します。</p>
<hr>
<p>人間とコンピューターのインタラクションのあり方を根本から変えうるような技術革新はそうそうありません。幸運なことに、次のパラダイムシフトは今まさに私たちの目の前で展開されているようです。</p>
<p>こうした変化は、新たな抽象化レイヤーを解放し、サブシステムの詳細な仕組みを覆い隠す傾向にあります。詳細を一般化することで、複雑なシステムをより単純で直感的なものとして見せることができます。それにより、コンピュータープログラムのコーディングや、コンピューターを操作するためのインターフェースの設計が合理化されます。</p>
<p>例えば、<strong>コマンドラインインターフェース</strong>は抽象化レイヤーを作り出し、格納されたプログラムによるインタラクションを可能にしました。その結果、スイッチを用いて1と0を入力することでしかプログラミングできなかった以前のコンピューターではあらわになっていたサブシステムの詳細が見えなくなりました。</p>
<p><strong>グラフィカルユーザーインターフェース（GUI）</strong> は、視覚的メタファーを用いてコンピューターを操作できるようにすることで、この概念をさらに抽象化しました。これらの抽象概念により、コンピューターは大勢の一般ユーザーにも使えるものになりました。</p>
<p>こうした進歩を遂げてきたものの、まだ完璧に直感的なインターフェースは見つかっていません。インターネット上に公開されている大量の関連論文からもそれは明らかです。しかし、近年見られるAIの進歩を受け、多くの技術者はコンピューティングの次なる進化のサイクルが始まっていると確信しています。</p>
<p><img src="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/1-smashing-abstraction-intro.gif"></p>
<p><em>インターフェースの抽象化レイヤー（下から上）：コマンドラインインターフェース、グラフィカルユーザーインターフェース、AI搭載の対話型インターフェース。（出典：<a href="https://www.maximillian.nyc/">マクシミリアン・ピラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/1-smashing-abstraction-intro.gif">拡大プレビュー</a>）</em></p>
<h2>次のインターフェース抽象化レイヤー <a href="#次のインターフェース抽象化レイヤー">#</a><a name="次のインターフェース抽象化レイヤー"></a></h2>
<p>近年のイノベーションの大半は、機械学習の一種である<strong>生成AI</strong>によって推進されています。データセット内のパターンを認識し、確率分布を推定することで、テキストやメディア、コードの斬新な構成を可能にします。コンピューターの制御がさらに簡単になることから、「グラフィカルユーザーインターフェース以来最も重要なテクノロジーの進化」であると<a href="https://www.gatesnotes.com/The-Age-of-AI-Has-Begun">ビル・ゲイツ氏は語っています</a>。自然言語のような非構造化データを解釈する能力を新たに手に入れたことで、これまでにない形の入出力が可能になり、<a href="https://twitter.com/AviSchiffmann/status/1708439854005321954">今までにない</a> <a href="https://www.youtube.com/watch?v=9lNIwOOMVHk">斬新な</a> <a href="https://www.youtube.com/watch?v=Yla0f5JZg78">物理仕様</a>を実現できるようになりました。</p>
<p>今では、人間同士で話すように直感的なインターフェースを通して即座に膨大な量の情報を呼び出せるようになりました。これらは『スタートレック』に登場する「データ（※訳注：劇中に登場するアンドロイドキャラクター）」に搭載されたシステムのような、私たちが夢見てきたSF世界のコンピューターです。もしかすると、これまでのコンピューターは試作品に過ぎず、これから出てくるのが本当の製品なのかもしれません。<strong>インターネットの構築が線路を敷く行為だと仮定すると、AIは猛スピードで情報を運ぶ列車かもしれません</strong>。これらの列車がものすごいスピードで街に入ってくるとどうなるか、これから目の当たりにすることになるでしょう。</p>
<blockquote>
<p>「画面をタップするのではなくコマンドプロンプトを入力してコンピューターを使っていた日々のようにAI以前の時代はもうすぐ遠い過去に感じられるようになるでしょう」<br>
— ビル・ゲイツ、『<a href="https://www.gatesnotes.com/The-Age-of-AI-Has-Begun">The Age of AI Has Begun（AIの時代が始まった）</a>』</p>
</blockquote>
<p>今後何もかも変わるのであれば、ソフトウェアデザイナーのメンタルモデルも変わらなくてはいけません。<a href="https://www.lukew.com/ff/entry.asp?933">ルーク・ウルブレフスキー氏</a>がかつてモバイルファーストデザインを普及させたように、次のトレンドはAIファーストになるでしょう。AIの制約と能力を理解することで、初めて人に喜ばれるものを作れます。インターフェースの進化に関する議論にはすでに影響を与え始めています。</p>
<p>例えば、大規模言語モデル（LLM）は多くの新しいアプリケーションで使われているAIで、テキストベースであるため、将来的にはチャットボットのような対話型インターフェースが適していると多くの人が考えています。AIが語りかける対象であるという考え方は、<a href="https://www.wired.com/2013/03/conversational-user-interface/">何年も前から業界内で広がっています</a>。『UXマガジン』誌の共同オーナーであるロブ・ウィルソン氏は、著書『The Age of Invisible Machines（透明な機械の時代）』（2022年）の中で、対話は「無限に拡張可能なインターフェース」であると語っています。<a href="https://www.designerfund.com/blog/how-figma-midjourney-and-databricks-harness-ai-in-design/">フィグマ社のプロダクトデザイン担当バイスプレジデントであるノア・レヴィン氏</a>は、「対話の仕方を学ぶというのは、非常に直感的なものである」と述べています。GUIの先駆者である<a href="https://www.gatesnotes.com/The-Age-of-AI-Has-Begun">ビル・ゲイツ氏</a>でさえ、「カーソルを合わせてクリックするというコンピューターの制御方法は、今後主流ではなくなります」と断言しています。</p>
<p><img src="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/2-smashing-abstraction-mscopilot-800px.gif"></p>
<p><em>Microsoft Copilotは、マイクロソフト社のオフィススイート全体への統合が進められている新しい対話型AI機能です。（出典：<a href="https://www.microsoft.com/en-us/microsoft-365/blog/2023/03/16/introducing-microsoft-365-copilot-a-whole-new-way-to-work/">マイクロソフト社</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/2-smashing-abstraction-mscopilot.gif">拡大プレビュー</a>）</em></p>
<p>対話型コンピューターにより、学習曲線が平坦化することが望まれています。<a href="https://www.rabbit.tech/keynote">ラビット社の創設者であるジェシー・リュー氏</a>は、自然言語によるアプローチは「使い方を学ぶ必要がないほど直感的」だと言います。</p>
<p>『スタートレック』の「データ」も取扱説明書が付いてきたわけではありません。その観点で言うと、GUIに取って代わる対話型インターフェースの<a href="https://www.shopify.com/partners/blog/conversational-interfaces">進化の物語</a>も必然的であるように感じられ、過去に見られたコマンドラインからの転換を彷彿させます。しかし、チャットボットのような対話型インターフェースを「怠惰な解決策」とまで呼ぶ<a href="https://maggieappleton.com/lm-sketchbook">マギー・アップルトン氏</a>のように、<a href="https://wattenberger.com/thoughts/boo-chatbots">異論</a>を唱える者もいます。</p>
<p>一見すると意見が分裂しているように見えるかもしれませんが、むしろインターフェースの進化を単純に捉え過ぎた結果だと言えるでしょう。コマンドラインは決して廃れてなどいません。柔軟性や効率性に優れるため、技術者は今でも好んで使用しています。ソフトウェア開発や自動化スクリプトの作成などのユースケースの場合、コードを使用しないグラフィカルツールにおいて追加された抽象化レイヤーは、橋渡しどころか障壁となることがあります。</p>
<blockquote>
<p><a class="pull-quote__link" aria-label="Share on Twitter" href="https://twitter.com/share?text=%0aGUIs%20were%20revolutionary%20but%20not%20a%20panacea.%20Yet%20there%20is%20ample%20research%20to%20suggest%20conversational%20interfaces%20won%e2%80%99t%20be%20one,%20either.%20For%20certain%20interactions,%20they%20can%20decrease%20usability,%20increase%20cost,%20&%20introduce%20security%20risk%20relative%20to%20GUIs.%0a%0a&url=https://smashingmagazine.com%2f2024%2f02%2fdesigning-ai-beyond-conversational-interfaces%2f">GUIは革命的ではありましたが、万能薬ではありませんでした。多くの研究結果が、対話型インターフェースも万能薬にはならないことを示しています。インタラクションによっては、GUIに比べて使い勝手が損なわれ、コストが増し、セキュリティリスクがもたらされる可能性があります。</a></p>
</blockquote>
<p>（訳注：原文同様 XへのPOSTリンクとなっています）</p>
<p><strong>では、人工知能を搭載したアプリケーションにはどのようなインターフェースが適しているのでしょうか？</strong>この記事では、インターフェースとしての対話の可能性と制約を比較することで、その判断を下すのに必要な情報を提供します。</p>
<h2>ピクセルをつなぐ <a href="#ピクセルをつなぐ">#</a><a name="ピクセルをつなぐ"></a></h2>
<p>過去を振り返ることから始めるのが、未来を知るための鍵になることが多いため、まずは歴史的背景から見ていきましょう。対話型インターフェースは新しいもののように感じられますが、実はコンピューターと会話することは何十年も前から可能でした。</p>
<p>世界初のチャットボットである<a href="https://en.wikipedia.org/wiki/ELIZA">ELIZA</a>は、ジョセフ・ワイゼンバウム氏が1966年にMITで行った実験によって発明されました。これが、音声アシスタントのAlexaや、電話の自動音声応答など、以後何世代にもわたる言語モデルの基礎を築いたのです。しかし、チャットボットの大半は、<a href="https://www.theverge.com/2021/12/23/22851451/amazon-alexa-by-the-way-use-case-functionality-plateaued">タイマーをセットするといった基本的な作業</a>にしか使われず、それ以上の用途を与えられることはほとんどありませんでした。</p>
<p>ほとんどの消費者は、さほどコンピューターと対話したいとは思っていないようでした。しかし、昨年何かが変わったようです。<a href="https://www.cnet.com/tech/computing/why-were-all-obsessed-with-the-mind-blowing-chatgpt-ai-chatbot/">CNETの記事</a>では、「72%の人がチャットボットは時間の無駄と考えている」と報じられていたにもかかわらず、<a href="https://techcrunch.com/2023/11/06/openais-chatgpt-now-has-100-million-weekly-active-users/">ChatGPTの1週間のアクティブユーザー数が1億人に達した</a>のです。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/3-abstraction-eliza.png"></p>
<p><em>1966年に発明された世界初のチャットボットELIZAとの会話。（画像出典：<a href="https://en.wikipedia.org/wiki/ELIZA">ウィキペディア</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/3-abstraction-eliza.png">拡大プレビュー</a>）</em></p>
<p>不毛と見られていたチャットボットの驚くべき躍進をもたらしたものは何でしょうか？多くの専門家がその要因として挙げるのが、<a href="https://cdn.openai.com/research-covers/language-unsupervised/language_understanding_paper.pdf">OpenAI社が2018年に発明</a>（PDF）した<strong>GPT（Generative Pre-trained Transformer</strong>）です。GPTは、自然言語の理解力が大幅に改善した新しいタイプのLLMです。しかし、GPTの中核にあるのは、それ以前の<a href="https://arxiv.org/pdf/1706.03762.pdf">2017年に紹介されたTransformerアーキテクチャの技術革新</a>（PDF）です。このアーキテクチャにより、自然言語の入力の前後にある長期間にわたる文脈を捕捉するために必要な並行処理が可能になりました。さらに掘り下げると、このアーキテクチャが可能なのは、<a href="https://arxiv.org/pdf/1409.0473.pdf">2014年に紹介された注意機構</a>（PDF）のおかげです。これにより、入力の異なる部分を選択的に比較検討することが可能になりました。</p>
<p>こうした相補的な技術革新を組み合わせることで、対話型インターフェースはより幅広い作業でGUIと競い合える存在になったのです。GUIがコマンドラインの有望な代替技術として実用化された際も、驚くほど類似した経過をたどっています。もちろん、キーストロークを超えるユーザーシグナルを捕捉するにはマウスのようなハードウェアが必要であり、十分な解像度の画面も必要でした。しかし、研究者らは何年も後になってビットマップを発明したことで、欠けていたソフトウェアの要素を発見したのでした。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/4-abstraction-sketchpad.png"></p>
<p><em>1963年にSketchpadのグラフィカルユーザーインターフェースを使用するアイバン・サザランド氏。（画像出典：<a href="https://www.researchgate.net/figure/Ivan-E-Sutherland-al-lavoro-con-il-suo-sistema-di-disegno-Sketchpad-ca-1963-da-Blau_fig2_310004778">ResearchGate</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/4-abstraction-sketchpad.png">拡大プレビュー</a>）</em></p>
<p>ビットマップは、以前のベクターディスプレイが苦手とした複雑なピクセルパターンを可能にしました。例えば、アイバン・サザランド氏が発明したSketchpadは初めてのGUIでしたが、ウィンドウの重なりといった概念には対応できませんでした。『IEEEスペクトラム』誌の「<a href="https://spectrum.ieee.org/graphical-user-interface">Of Mice and Menus（マウスとメニュー）</a>」（1989年）に、ゼロックス社パロアルト研究所のアラン・ケイ氏率いるグループによるビットマップの発明につながった進歩について記されています。この新しいテクノロジーにより、革命的な<a href="https://en.wikipedia.org/wiki/WIMP_(computing)">WIMP（ウィンドウ、アイコン、メニュー、ポインター）</a>パラダイムが可能になり、直感的な視覚的メタファーを通じて誰もがパソコンを使える時代の到来を後押ししました。</p>
<p>コンピューティングには、あらかじめ考えられた一連のステップを最初に用意しておく必要がなくなりました。後から考えると些細なことのように思えるかもしれませんが、1963年に<a href="https://www.youtube.com/watch?v=6orsmFndx_o">MITでSketchpadのデモ</a>が行われた際、発表者らはすでに人工知能システムに言及していました。これは、<strong>精巧な計算機が探索ツールへと変貌を遂げた転換点となりました</strong>。これにより、デザイナーは発見に対するニーズが、コマンドラインがもたらす柔軟性や効率性に対するニーズを上回る体験のためにインターフェースを設計できるようになりました。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/5-abstraction-susankare.png"></p>
<p><em>スーザン・ケア氏による、アップル社のGUIにおけるポインターアイコンの初期のスケッチ。（画像出典：<a href="https://www.itsnicethat.com/news/susan-kare-apple-macintosh-icons-california-designing-freedom-design-museum-240517">It’s Nice That</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/5-abstraction-susankare.png">拡大プレビュー</a>）</em></p>
<h2>並行するパラダイム <a href="#並行するパラダイム">#</a><a name="並行するパラダイム"></a></h2>
<p>新しいインターフェースが登場する度に、既存の技術に対して斬新な調整を行うことで一般ユーザーに受け入れられてきました。言うなれば、サンデーにさくらんぼを乗せるようなものです。いずれの場合も、土台のシステムはすでに存在していましたが、データ処理に関して異なる判断を下すことで出力が意義深いものとなり、技術者以外の一般ユーザーを惹きつけました。</p>
<p>ビットマップでは、GUIはピクセルをグリッドの並びに整理し、複雑なスキュアモーフィック構造を生み出すことができます。GPTでは、対話型インターフェースは非構造化データセットを整理し、人間のような（あるいは人間を超える）知性で応答を作成することができます。</p>
<p>どちらのパラダイムも原型となるインターフェースは1960年代に発明されていますが、その後の開発の進行には時系列的に大きな差が開きました。それ自体一つのケーススタディになりそうですが、<strong>ここでもう一つの転換点が訪れます。すなわち、計算機や探索ツールとしてだけでなく、コンピューターは生き物のように振る舞うこともできるのです</strong>。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/6-abstraction-movie-her.png"></p>
<p><em>ジェフ・マクフェトリッジ氏による、映画『her/世界でひとつの彼女』に登場する対話型インターフェースの初期のスケッチ。（画像出典：<a href="https://gizmodo.com.au/2014/03/an-interview-with-geoff-mcfetridge-on-the-interfaces-from-her/">ギズモード</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/6-abstraction-movie-her.png">拡大プレビュー</a>）</em></p>
<p>しかし、グラフィカルインターフェースより対話型インターフェースが求められるようなニーズとはどのようなものでしょうか？主人公がデジタルアシスタントに恋する映画『her/世界でひとつの彼女』の中で、他者との交わりに対する欲求に対する理論的解決策が見られます。しかし、生身の人間との関係に満足している人にとってのメリットは何でしょうか？<strong>対話がより直感的なインターフェースである</strong>との仮定の検証に期待しましょう。WIMPパラダイムの中核的要素のいくつかは十分に裏付けられたユーザビリティの問題があるため、この仮定には妥当性があるように思われます。</p>
<p><a href="https://www.nngroup.com/articles/icon-usability/">ニールセン・ノーマン・グループ</a>のレポートによると、文化的違いにより、アイコンが万国共通の認識を得ることはほとんどないようです。メニューは時間とともに必然的に複雑性が増し、徐々に使い物にならなくなります。対話型インターフェースの場合、混乱して分からなければシステムにそう伝えればいいだけなので、より使い勝手は良さそうです。しかし、この後のセクションで見ていくように、対話型インターフェースにもユーザビリティの問題はあります。</p>
<blockquote>
<p><a class="pull-quote__link" aria-label="Share on Twitter" href="https://twitter.com/share?text=%0aBy%20replacing%20menus%20with%20input%20fields,%20we%20must%20wonder%20if%20we%e2%80%99re%20trading%20one%20set%20of%20usability%20problems%20for%20another.%0a&url=https://smashingmagazine.com%2f2024%2f02%2fdesigning-ai-beyond-conversational-interfaces%2f">メニューを入力欄に置き換えることで、ユーザビリティに関する問題の中身が変わるだけではないのか、考える必要があります。</a></p>
</blockquote>
<p>（訳注：原文同様 XへのPOSTリンクとなっています）</p>
<h2>対話のコスト <a href="#対話のコスト">#</a><a name="対話のコスト"></a></h2>
<p>SF映画の中で対話型インターフェースの人気が高いのはなぜでしょうか？<a href="https://rhizome.org/editorial/2014/feb/03/ill-send-os-world-her-product-spec/">Rhizomeに掲載されたエッセー</a>の中で、マーティン・シムス氏は対話型インターフェースが「より映画的なやりとりや制作のスリム化」に役立つと論じています。同じ費用対効果はアプリケーションの開発にも当てはまります。書き言葉または話し言葉による文章補完はLLMの中核的機能です。これにより、デザインおよび技術的観点から対話がこの機能を製品化する最も簡単な方法となっています。</p>
<p>著名なAIリサーチエンジニアであるライナス・リー氏は、「アルゴリズムの生のインターフェースをあらわにする」ものだと<a href="https://thesephist.com/posts/latent/">述べています</a>。インタラクションのパターンや構成要素はすでにほとんど定義されているため、新たに発明するものはあまりありません。すべてチャットウィンドウに盛り込むことができます。</p>
<blockquote>
<p>「エンジニアまたはデザイナーとして、これらのモデルの力をソフトウェアのインターフェースに組み込む作業を課せられたのであれば、この機能をUIに実装する最も簡単で自然な方法は、対話型インターフェースでしょう」<br>— ライナス・リー氏、「<a href="https://thesephist.com/posts/latent/">Imagining Better Interfaces to Language Models</a>（言語モデルのより良いインターフェースについて考える）」</p>
</blockquote>
<p>このことは、<a href="https://www.theatlantic.com/technology/archive/2023/11/sam-altman-open-ai-chatgpt-chaos/676050/?gift=bQgJMMVzeo8RHHcE1_KM0WVuODpKll0A708pOI0Ple4&#x26;utm_source=copy-link&#x26;utm_medium=social&#x26;utm_campaign=share">ChatGPTの発表に関するアトランティック誌のレポート</a>が「目立たないリサーチプレビュー」として扱われたことでも証明されています。OpenAI社が製品化することをためらっていたことは、ユーザーエクスペリエンスに対する自信の欠如を示すものです。社内の期待値は極めて低く、社員が予想した1週目の採用者数で最も高かったのは10万人でした（実際のユーザー数はこの数を90%上回りました）。</p>
<blockquote>
<p><a class="pull-quote__link" aria-label="Share on Twitter" href="https://twitter.com/share?text=%0aConversational%20interfaces%20are%20cheap%20to%20build,%20so%20they%e2%80%99re%20a%20logical%20starting%20point,%20but%20you%20get%20what%20you%20pay%20for.%20If%20the%20interface%20doesn%e2%80%99t%20fit%20the%20use%20case,%20downstream%20UX%20debt%20can%20outweigh%20any%20upfront%20savings.%0a&url=https://smashingmagazine.com%2f2024%2f02%2fdesigning-ai-beyond-conversational-interfaces%2f">対話型インターフェースは開発コストが安いため、スタート地点として理にかなってはいますが、金額相応のものしか得られません。インターフェースがユースケースに合わなければ、先行投資を節約できてもUX面での負債がそれを上回る可能性があります。</a></p>
</blockquote>
<p>（訳注：原文同様 XへのPOSTリンクとなっています）</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/7-abstraction-llmwrapper.png"></p>
<p><em>LLMの生の出力を対話型インターフェースに表示するのがいかに簡単であるかを示す例。（画像出典：<a href="https://www.maximillian.nyc/">マクシミリアン・ピラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/7-abstraction-llmwrapper.png">拡大プレビュー</a>）</em></p>
<h2>忘れられたユーザビリティの原則 <a href="#忘れられたユーザビリティの原則">#</a><a name="忘れられたユーザビリティの原則"></a></h2>
<p><a href="https://www.bloomberg.com/news/articles/1998-05-25/steve-jobs-theres-sanity-returning">スティーブ・ジョブズ氏はかつてこう言いました</a>。「人は形にして見せてもらうまで、自分は何が欲しいのか分からないものだ。」この考え方をインターフェースに当てはめると、発見可能性と呼ばれるユーザビリティの評価と一致します。<a href="https://www.nngroup.com/articles/navigation-ia-tests/">ニールセン・ノーマン・グループ</a>は、これをユーザーが「知らなかった新しいコンテンツや機能を見つけられる」ことと定義しています。</p>
<p>優れた設計のインターフェースは、存在する機能をユーザーが見つけやすくします。今日人気のある多くの生成AIアプリケーションのインターフェースは、ユーザーが任意のシステムプロンプトを入力できる入力欄が中心となっています。問題は、ユーザーが望む出力を得るためには何を入力すればいいのかが不明な場合が多いことです。皮肉なことに、理論的な<a href="https://www.forbes.com/sites/forbesagencycouncil/2023/07/20/generative-ai-and-solving-the-blank-page-problem/">ライターズブロックの解決策</a>自体、空白ページ問題があるかもしれません。</p>
<blockquote>
<p>「AIは、ユーザーインターフェースが欠けていることに問題があるように思います。ほとんどの場合、空白の入力欄が用意されているだけであり、AIに何ができるのかは自分で見つけなくてはいけません」<br>— ケイシー・ニュートン氏、ハード・フォーク・ポッドキャスト</p>
</blockquote>
<p>対話型インターフェースは、人と人とのインタラクションの模倣には優れていますが、それ以外の点では不十分な場合もあります。例えば、「Midjourney」という人気の画像生成AIは、当初テキスト入力のみに対応していましたが、現在は「使いやすさ向上」のため<a href="https://www.zdnet.com/article/later-discord-midjourney-ai-tool-is-moving-to-dedicated-website/">GUIに移行しています</a>。</p>
<p>これは、この新たな未開の領域を進む上で、ドン・ノーマン氏の重要な著書『The Design of Everyday Things』（1988年）に書かれているように、古典的な人間中心の原則を忘れてはならないということを思い出させてくれます。明確なアフォーダンスとシグニファイアを提供することで発見可能性を高めよというノーマン氏のアドバイスには、今でもグラフィカルな構成要素の方が適しているように思われます。</p>
<p>また、ヤコブ・ニールセン氏が提唱する<a href="https://www.nngroup.com/articles/ten-usability-heuristics/">ユーザビリティ10原則</a>もあります。今日の対話型インターフェースの多くは、これらの原則をすべて無視しているように見えます。システムの状態を可視化することで、ユーザーに対して自らの行為の結果について認識させることができると述べた<strong>1つ目のユーザビリティ原則</strong>について考えてみてください。比喩的な地図上の「現在地」ピンを使用することで、適切な方向付けが次のステップを踏み出す上で重要であることを説明しています。</p>
<p>インタラクションはすべて同じチャットウィンドウ上で行われますが、<strong>ナビゲーションはチャットボットのような対話型インターフェースにとって見かけ以上に重要です</strong>。ChatGPTのような製品のバックエンドは、ニューラルネットワーク全体をナビゲートし、訓練データセットの異なる部分に注目することで各回答を作成します。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/8-abstraction-roleplay.png"></p>
<p><em>プロンプトエンジニアリングにおけるロールプレイがAIモデルを大まかに導き、異なる出力を作成する方法を可視化した図。
（画像出典：<a href="https://www.maximillian.nyc/">マクシミリアン・ピラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/8-abstraction-roleplay.png">拡大プレビュー</a>）</em></p>
<p>パラメーターで表現される知識の地図にピンを置くことは、些細なことではありません。LLMは極めて不透明であり、<a href="https://openaipublic.blob.core.windows.net/neuron-explainer/paper/index.html">OpenAI社でさえ「仕組みを理解していない」と認めています</a>。しかし、モデルを大まかに導き、異なる知識領域から回答を作成するような方法で入力をカスタマイズすることが可能です。</p>
<p>注意を向ける手法としてよく使われるのが、<strong>ロールプレイング</strong>です。「自分は歴史家であると想像してください」と入力するなどして、LLMに特定の役割（ロール）を演じさせることで、効果的にモードを切り替えることができます。<a href="https://promptengineering.org/role-playing-in-large-language-models-like-chatgpt/">プロンプト・エンジニアリング・インスティテュートは次のように説明しています</a>。「多彩なドメインから集めたテキストデータの大規模なコーパスを用いて訓練する際、モデルはさまざまなロールとそれらに関連付けられた言語について複雑な理解を形成します。」ロールを演じることで、AIの訓練データの関連する要素（トーン、スキル、合理性など）が呼び出されるのです。</p>
<p>例えば、歴史家のロールは事実に基づく詳細によって回答するのに対し、語り手のロールは叙述的説明によって回答します。また、データサイエンティストのロールを割り当ててPythonコードによる回答を生成するなどして、作業の効率化を図ることもできます。</p>
<p><a href="https://www.youtube.com/watch?v=ieWT6X2Yh_g">ジェイソン・ユアン氏</a>が「バンキングAIエージェントはおそらくあなたと深い哲学的な会話をできるべきではないでしょう」と述べるように、ロールは社会規範を強化するものでもあります。しかし、対話型インターフェースはこの手のシステムステータスをメッセージ履歴に埋没させてしまうため、我々は<a href="https://www.nngroup.com/articles/working-memory-external-memory/">作業記憶</a>に留めておく必要があります。</p>
<p><img src="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/9-abstraction-rolebot.gif"></p>
<p><em>セグメント化されたコントローラーを使用してユーザーがワンクリックでロールを特定できる理論上のAIチャットボット—各ボタンが自動的にLLMのシステムプロンプトを調節する。（出典：<a href="https://www.maximillian.nyc/">マクシミリアン・ピラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/9-abstraction-rolebot.gif">拡大プレビュー</a>）</em></p>
<p>ロールプレイのようなコンテキストに対する永続的なシグニファイアが欠けていると、ユーザビリティの問題につながる場合があります。明確化のため、ターミナルに<code class="language-text">ls</code>や<code class="language-text">cd</code>コマンドを打ち込むのと同じように、頻繁にAIのステータスを尋ねる必要があります。専門家であれば問題ないでしょうが、素人の頭には負担が大きいでしょう。問題は人間の記憶力にとどまらず、システムにも同様の認知的過負荷がかかります。コンテキストウィンドウに表示できるデータ量が限られているため、ユーザーは最終的にシステムより下位のレベルでロールプレイを再び開始する必要があります。こうした情報がインターフェース上に永続的に表示されたら、ユーザーにとって明確になり、プロンプトごとにAIに対して自動的に繰り返し思い出させることができます。</p>
<p><a href="http://character.ai/">Character.ai</a>は、歴史上の人物をなじみのある焦点として用いることで、これを実現しています。文化的な共通認識により、「アル・パチーノ」に対して行う質問は、「ソクラテス」に対して行う質問とは違ったものになるでしょう。「キャラクター」が、ユーザーの期待を設定し、システム設定を自動的に調整するための原則となるのです。これは、レストランのメニューを掲示するのと似ています。客はどんな料理があるのか聞く必要がなくなり、直ちに注文することができます。</p>
<blockquote>
<p>「人間の短期記憶には限界があります。認識を促すインターフェースは、ユーザーに求められる認知的労力を減らします。」<br>
— ヤコブ・ニールセン氏、「<a href="https://www.nngroup.com/articles/ten-usability-heuristics/">10 Usability Heuristics for User Interface Design</a>（ユーザーインターフェースデザインのためのユーザビリティ10原則）」</p>
</blockquote>
<p>ユーザビリティに関する教訓でもう一つ忘れられているのが、タスクの中には説明するより行う方が簡単なものがあるということです。これは、GUIで普及しているような<a href="https://www.nngroup.com/articles/direct-manipulation/">直接操作</a>するスタイルのインタラクションを通して行う場合に特に当てはまります。</p>
<p>Photoshopの新しい生成AI機能は、グラフィカルインターフェースと統合することでこの概念を強化しています。<a href="https://www.adobe.com/products/photoshop/generative-fill.html">生成塗りつぶし</a>には入力欄がありますが、定番のなげなわツールのようなスキュアモーフィックコントロールも使用します。画像のどの部分を操作するのか説明するのは、クリックするよりもはるかに面倒です。</p>
<p><strong>言葉が非効率な場合、インタラクションは入力欄以外の方法で行うべきです</strong>。サイズを変更したいとき、「大きくして」と言葉で言うと主観が入り込む余地があまりに大きすぎるため、スライダーを使用する方が良いでしょう。色やアスペクト比は、説明するより選択した方が簡単です。また、標準化されたコントロールの方が、システムが裏でプロンプトを整理しやすいでしょう。例えば、モデルがパラメーターに対する特定の値を受け取った場合、インターフェースが自然なマッピングで入力方法を示すことができます。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/10-abstraction-promptgui.png"></p>
<p><em>Visual Electricの入力欄。システムが裏でプロンプトを整理するのにグラフィカルコントロールがどう役立つかが分かります。（画像出典：<a href="https://www.maximillian.nyc/">マクシミリアン・ピラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/10-abstraction-promptgui.png">拡大プレビュー</a>）</em></p>
<p>これらのユーザビリティ原則のほとんどは30年以上前のものであるため、今でも重要なのか疑問に思う人もいるでしょう。<a href="https://www.nngroup.com/articles/ten-usability-heuristics/">ヤコブ・ニールセン氏が最近、この点について次のように考えを述べています</a>。「26年間有効であったなら、未来の世代のユーザーインターフェースにも当てはまるでしょう。」しかし、必ずしも古典的な構成要素を使用しなくても、これらのユーザビリティ原則に従うことはできます。Kreaのようなアプリは、生成AIを操作する<a href="https://twitter.com/MaximillianNYC/status/1733627162517794899/video/1">新しいGUI</a>をすでに模索しています。</p>
<h2>プロンプトエンジニアリングは専門的な技術である <a href="#プロンプトエンジニアリングは専門的な技術である">#</a><a name="プロンプトエンジニアリングは専門的な技術である"></a></h2>
<p>現在の対話型インターフェースのユーザビリティに関する最大の問題は、一般ユーザーに技術的な作業を押し付けることです。
コマンドラインとの共通点で言うと、見つけにくさの他に、<strong>コマンドを学ばなければ望ましい出力が得られない</strong>ことが挙げられます。生成AIシステムと効果的にコミュニケーションを取るために入力をカスタマイズすることを「プロンプトエンジニアリング」と呼びます。その名前からも分かるように、プロンプトエンジニアリングは専門家が行うものです。その技術を磨けば<a href="https://www.wsj.com/tech/ai/talking-to-chatbots-is-now-a-200k-job-so-i-applied-258bd5f0">年収20万ドル</a>の仕事を獲得することも可能です。</p>
<p>自然言語によるプログラミングは素晴らしい進歩ですが、消費者向けアプリケーションの要件とするのは間違っているように感じます。誰もがコンピューターと同じ言語を話せるからと言って、何を言えばいいか、どう言うのが一番いいかを知っているとは限りません。一般のユーザーは専門家による手引きが必要です。新しいテクノロジー使いこなすためには学習が不可欠ですが、対話型インターフェースに関しては習得が難しく、それがさらなる普及と長期的な定着の妨げになりそうです。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/11-abstraction-magicstudio.jpeg"></p>
<p><em>Canva社のAI機能「マジックスタジオ」。（画像出典：<a href="https://www.businesswire.com/news/home/20231004078842/en/Canva-Celebrates-10th-Anniversary-With-Launch-of-World%E2%80%99s-First-All-In-One-AI-Design-Offering-for-Everyone-and-Every-Business">ビジネスワイヤ</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/11-abstraction-magicstudio.jpeg">拡大プレビュー</a>）</em></p>
<p>質の高い出力を得るために必要なプロンプトエンジニアリングは、黒魔術のような神秘的雰囲気をまとっているように感じます。AI機能を紹介する販促資料の多くが「魔法」といった表現を使用していることも、そうした印象を強めています。正のフィードバックループが働いていると仮定すると、この不透明さが消費者の好奇心をそそるのでしょう。</p>
<p>しかし、呪文書やシャーマンの領域に製品を位置付けるのは、理解不能な体験であることを示唆することにもなります。これは長期的に良い戦略なのでしょうか。スティーブ・クリュッグ氏が『<a href="https://sensible.com/dont-make-me-think/">Don’t Make Me Think</a>』（2000年）で紹介し、大きな影響を及ぼした教訓がまだ当てはまると仮定した場合、ほとんどの人は適切なプロンプトをわざわざ学習しようとは思わず、どうにか乗り切ろうとするでしょう。</p>
<p>試行錯誤しながら生成AIを使うことの問題は、毎回何かしら回答が得られるため「失敗」がないことです。例えば、LLMに数学の問題を解いてもらった場合、自信満々に出した答えが<a href="https://garymarcus.substack.com/p/math-is-hard-if-you-are-an-llm-and">完全な間違い</a>であることもあります。回答が全くの誤り（ハルシネーション）であっても、それが分からなければ失敗から学ぶのは難しくなります。OpenAI社の<a href="https://twitter.com/karpathy/status/1733299213503787018">アンドレイ・カルパシー氏が言うように</a>、LLMは「夢のマシン」であるため、ハルシネーションは必ずしもバグとは言えません。したがって、<strong>すべてはインターフェースがユーザーに何を期待させるのかによる</strong>のです。</p>
<blockquote>
<p>「相手が人である場合と同じように、AIから最も意味のある答えを引き出すには、最適な質問をする必要があります。AIは超能力者でもテレパシーが使えるわけでもありません」<br>
— ステファン・J・ビゲロウ氏、「<a href="https://www.techtarget.com/whatis/feature/Skills-needed-to-become-a-prompt-engineer">5 Skills Needed to Become a Prompt Engineer</a>（プロンプトエンジニアになるために必要な5つのスキル）」</p>
</blockquote>
<p>魔法を思わせるような表現を使用すると、素人はAIが全知的存在であると考えてしまうかもしれません。AIの知識が訓練データに限られていることは、必ずしも明白ではありません。</p>
<ul>
<li>
<p>データセットの限界に達した場合、ユーザーはRAG（<a href="https://blogs.nvidia.com/blog/what-is-retrieval-augmented-generation/">Retrieval-Augmented Generation</a>：検索拡張生成）によって補完できることを知っているか？</p>
</li>
<li>
<p>ユーザーは、AIの推論を調整するため、<a href="https://www.promptingguide.ai/techniques/fewshot">フューショット</a>や<a href="https://www.promptingguide.ai/techniques/cot">思考の連鎖</a>といった別のプロンプトテクニックが使えることを知っているか？</p>
</li>
</ul>
<p>魔法の粉の効果が失われると、ソフトウェアデザイナーは<strong>こうした判断が</strong>ユーザー体験につながることに気付くでしょう。</p>
<p>ユーザーが喜ぶものを作るには、適切なプロンプトテクニック、ナレッジソース、モデルを選択する必要があります。この作業をいかにユーザーに押し付けないようにするかを考えるべきです。</p>
<ul>
<li>AIの知識の限界を何も表示しないことによって示せば、ユーザーは必要に応じて不足を補うことができます。</li>
<li>導入フローの中でユーザーの目的を確認すれば、最適な推論が可能な適切なモデルを提案できます。</li>
<li>あいまい検索と同様の機能により、ユーザーの入力にマーキングすることで、有効な調整の仕方を教えることができます。</li>
</ul>
<p>ユーザーの入力を裏で<a href="https://community.openai.com/t/api-image-generation-in-dall-e-3-changes-my-original-prompt-without-my-permission/476355">リライトする</a>ことで、出力結果を最適化できるOpenAI社の画像生成AIが一つのヒントを提示しています。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/12-abstraction-promptengineering.png"></p>
<p><em>グラフィカルユーザーインターフェースと自由形式の入力を組み合わせることで、RAGのようなテクニックを使用してプロンプトエンジニアリングを自動化できることを示す例。（画像出典：<a href="https://www.maximillian.nyc/">マクシミリアン・ピラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/12-abstraction-promptengineering.png">拡大プレビュー</a>）</em></p>
<h2>ランボルギーニでピザ宅配 <a href="#ランボルギーニでピザ宅配">#</a><a name="ランボルギーニでピザ宅配"></a></h2>
<p>ユーザビリティの問題がもたらす認知コストの他に、<strong>経済的コスト</strong>についても考慮する必要があります。対話型インターフェースとのインタラクションは、すべてAIが推論して回答を出す必要があります。これには、GUIのボタンをクリックするよりはるかに高い処理能力が求められます。現在のコンピューティングコストだと、かなり法外な費用がかかります。高い知能がもたらす価値が値段に見合わないタスクも中にはあります。</p>
<p>例えば、<a href="https://www.wsj.com/tech/ai/ais-costly-buildup-could-make-early-products-a-hard-sell-bdd29b9f">ウォール・ストリート・ジャーナル紙</a>はメールの要約などのタスクにLLMを使用するのは、「ランボルギーニでピザを宅配してもらうようなものだ」と論じています。コストがかさむ要因の一つは、AIシステムが一般的なソフトウェアのようにスケールメリットを生かせていないことにあります。あらゆるインタラクションに膨大な計算が求められるため、使えば使うほどコストは直線的に増え続けます。限界費用ゼロの複製が使えないため、一般的なソフトウェアのサブスクリプションモデルは現実的ではありません。</p>
<p>消費者は高い値段を払って対話型インターフェースを買うでしょうか。それとも、AI機能を搭載した、コスパの良いGUIを選ぶでしょうか。皮肉にも、この苦境は初期のGUIが直面した困難を思い出させます。基礎となるビットマップの処理に必要なCPUのロジックとメモリの処理速度が現実的に使えるようになったのは、何年も後になってメモリチップの価格が下がってからです。歴史は繰り返すことを願いましょう。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/13-abstraction-ramchips.jpeg"></p>
<p><em>ゼロックス社製「Alto」の初期のラスターディスプレイを描いたスケッチ。メモリチップの価格が下がるまでは膨大なコストがかかっていました。（画像出典：<a href="http://worrydream.com/EarlyHistoryOfSmalltalk/">ブレット・ビクター</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/13-abstraction-ramchips.jpeg">拡大プレビュー</a>）</em></p>
<p><strong>セキュリティリスク</strong>も考慮すべきコストの一つです。ピザの宅配中にランボルギーニが盗難されたとしたら？AIに何でも自由に質問できるようにすれば、質問を通じて意図的に操ろうとする人も出てきます。自然言語によりシステムを操ろうとすることを<a href="https://developer.nvidia.com/blog/securing-llm-systems-against-prompt-injection/">プロンプトインジェクション</a>と言います。言葉の順番を工夫すれば、入力欄が攻撃ベクトルになり、悪意のあるユーザーが個人の<a href="https://stackdiary.com/chatgpts-training-data-can-be-exposed-via-a-divergence-attack/">情報やシステム</a>にアクセスできてしまう可能性もあります。</p>
<p>したがって、AIを<a href="https://www.lindy.ai/blog/announcing-a-new-way-to-create-ai-employees">チームの一員</a>と位置付ける場合は注意が必要です。なぜなら、従業員はすでにサイバーセキュリティ対策における最も大きな脆弱性の一つと見なされているからです。間違ったビジネスロジックを使うことで、会社に被害をもたらすフィッシングメールの数を誤って最大化してしまう可能性もあります。</p>
<p>優れたデザインにより、AIがユーザーにとって最も有意義であるポイントを特定することで、こうしたコストを低減することができます。そのような場面では人間のような会話ベースのインタラクションを重視し、他ではよりコスパに優れた要素を使用すると良いでしょう。プロンプトインジェクション対策としては、セキュアなシステムしかアクセスできない場所に機密性の高いデータを置くことです。LLMがあまり計算を得意としないことは分かっているので、請求書の処理のような退屈な仕事をさせるのではなく、創造的コラボレーションに注力させると良いでしょう。</p>
<h2>生成は予測である <a href="#生成は予測である">#</a><a name="生成は予測である"></a></h2>
<p><a href="https://www.smashingmagazine.com/2023/08/friction-feature-machine-learning-algorithms/">筆者が以前Smashingに投稿した記事</a>で、アルゴリズムに適したインターフェースの概念について説明しました。これらのインターフェースは、あらゆるインタラクションを、双方向のフィードバックを通じて理解を深める機会と捉えます。ユーザーにシステムフィードバックを提供しつつ、システムにはパフォーマンスフィードバックを返します。予測精度を最適化するデータ収集ポイントを最大化することがその成功を左右します。出力の予測精度を高めると、ユーザーの定着率が上がる傾向にあります。したがって、優れたデータはネットワーク効果を通じて強化され、価値が一層高まります。</p>
<p>筆者は以前コンテンツレコメンデーションアルゴリズムを専門としていましたが、これを生成AIに適用することは可能でしょうか。出力は全く異なりますが、どちらも予測モデルです。個人ユーザーの特徴、好み、行動といった具体的なデータを使用することで、これらの予測をカスタマイズすることが可能です。</p>
<p>Spotifyがユーザーの音楽の好みを学習し、新曲をレコメンドするのと同様に、理論上では生成AIをパーソナライズすることは可能でしょう。使用履歴や好みをもとにMidjourneyが画像生成パラメーターをレコメンドすることもできるはずです。ChatGPTは、状況に応じて適切なロールを演じることができるでしょう（システムステータスも可視化できるとなお良いですが）。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/14-abstraction-signals.jpeg"></p>
<p><em>アルゴリズムに適したインターフェースのフィードバックループ。（画像出展：<a href="https://www.maximillian.nyc/">マクシミリアン・ピラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/14-abstraction-signals.jpeg">拡大プレビュー</a>）</em></p>
<p>この領域はまだ若干未知のところもあるため、対話型インターフェースがどの程度アルゴリズムに適しているのかは不明です。対話型インターフェースの使い勝手に影響を及ぼしている同じ発見可能性の問題が、エンゲージメントシグナルを分析する能力にも影響を及ぼす可能性があります。ノイズとシグナルを区別できなければ、パーソナライゼーションの実現性は低くなるでしょう。「いいね」ボタンをタップするという簡単なインタラクションを検討してみましょう。バックエンド側には非常にクリーンなシグナルが送られます。</p>
<p>対話においてこれと同等のインタラクションは何でしょうか。「いいね」という言葉を入力するのは、この言葉が普段の会話の中で何気なく使われるものであるため、シグナルとしては確実性に劣るかもしれません。筆者が以前の記事で紹介した知見によると、効果的なパーソナライゼーションは極めて価値が高く、不具合があった場合は会社の収益に大きな影響を及ぼすことが示唆されます。</p>
<p>別のLLMを推論エンジンとして使用し、非構造化入力の体裁を自動的に整えて、明瞭なエンゲージメントシグナルに変換することが解決策になるかもしれません。しかし、<strong>データ収集の効率性が明確になるまでは、対話型インターフェースのメリットがパーソナライゼーションの後退によるリスクを上回るのか、デザイナーは問うべきでしょう</strong>。</p>
<h2>次の抽象化レイヤーに向けて <a href="#次の抽象化レイヤーに向けて">#</a><a name="次の抽象化レイヤーに向けて"></a></h2>
<p>コンピューティングにおけるこの新たなパラダイムシフトが進む中で、この記事がインターフェースの次なる抽象化につい考える上で参考になることを願っています。対話側インターフェースは次のAIファーストデザイン時代の主流になることは間違いないでしょう。音声機能が追加されることで、私たちはパソコンの前に座り、健康を害するほど長時間作業しなくても、コンピューターが能力を引き出してくれるようになります。しかし、対話だけでは不十分であり、言葉では説明できないニーズに対応したデザインも求められます。</p>
<p>したがって、インターフェースが万能薬にならないのであれば、単純な進化のストーリーを語るのはやめ、優れたエクスペリエンスの原則を目指しましょう。我々が求めているのは、<strong>統合された、コンテキストベースで、マルチモーダルなインターフェース</strong>です。このインターフェースは、私たちがジャスチャーや図でしか意図を伝えられないこともあることを知っています。私たちが忙しすぎて会話できず、簡単な質問だけしたくても、理解してくれます。実際に会話をするときになると、このインターフェースは私たちの視点で考えることができるため、長い説明を書く煩わしさもありません。言葉でうまく説明できなくても、趣旨は伝わります。</p>
<h2>未来に対し視野を狭めない <a href="#未来に対し視野を狭めない">#</a><a name="未来に対し視野を狭めない"></a></h2>
<p>モバイルファーストデザインの時代にさかのぼる教訓が思い出されます。iPhoneが登場した数年後、タッチスクリーンが共通の未来像として人気のテーマになりました。しかし、ヒューマンインターフェースインベンター（<a href="http://worrydream.com/#!/Apple">アップル社での肩書き</a>）として尊敬を集めるブレット・ビクター氏には、タッチスクリーンは未来に対する<em>視野を狭める</em>ものと映ったようです。</p>
<p><a href="http://worrydream.com/ABriefRantOnTheFutureOfInteractionDesign/">同氏がさまざまな可能性についてざっくばらんに語った記事</a>の中で、タッチスクリーンが皮肉にも触覚を完全に無視していると指摘されています。手を通じたハプティックフィードバックにはさまざまな可能性があるものの、ほとんどのインタラクションは主に視覚に頼っています。AIファーストデザインが私たちの能力を余すことなく増強するにはどうすればよいでしょうか。</p>
<blockquote>
<p>「ツールは人間の能力を増強することによって、人のニーズを解決します。」<br>
— ブレット・ビクター氏、「<a href="http://worrydream.com/ABriefRantOnTheFutureOfInteractionDesign/">A Brief Rant on the Future of Interaction Design</a>（インタラクションデザインの未来を語る）」</p>
</blockquote>
<p>対話型インターフェースを使うべきタイミングについて、法則のようなものはあるのでしょうか。説明可能性（D）は、グラフィカルな利便性（G）と逆相関の関係にあるため、説明の複雑さが増すほど、対話型インターフェースの利便性は低くなるという観察可能な法則を、「D∝1/G」という数式で表すことは可能かもしれません。これは事実かもしれませんが、あまり役には立ちません。</p>
<p>正直なところ、現時点ではあまりに不確実なことが多いため、新しいデザイン原則について予測を立てるのは避けたいと思います。その代わり、最近亡くなったチャーリー・マンガー氏の言葉からヒントを得て、問題を反転させて考えてみることはできるかもしれません。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/16-abstraction-inversion.jpg"></p>
<p><em>私たちは基本的に優れた成果を目指し、前向きにデザインを進めますが、愚かな結果を避けるため、問題を反転させて後ろ向きにデザインしなくてはならないこともあります。（画像出展：<a href="https://www.maximillian.nyc/">マクシミリアン・ミラス</a>）（<a href="https://files.smashing.media/articles/designing-ai-beyond-conversational-interfaces/16-abstraction-inversion.jpg">拡大プレビュー</a>）</em></p>
<h2>後ろ向きにデザインする <a href="#後ろ向きにデザインする">#</a><a name="後ろ向きにデザインする"></a></h2>
<p>前を向いて次の抽象化レイヤーをデザインしようとすると、チャットボットのようなものに行き着くようです。これだけでは解決策として不完全である理由は、今では分かっています。<strong>では、問題を逆向きに捉えて、避けるべき望ましくない結果を特定してみたらどうでしょうか</strong>。優れた成果を目指すよりも、愚かな結果を避ける方が簡単でしょう。</p>
<p>避けるべき明らかな間違いは、時間の制約を考慮せず、ユーザーに対話を強要することです。対話がふさわしいときには、ユーザビリティに関する既存の問題が、同じくらいストレスのたまる新しい問題に置き換わることがないような方法で行えるようにすべきです。ピザの宅配と同等の簡単なタスクには、ランボルギーニを運転するのに匹敵するほど大掛かりなものではない、実用的な解決策を見つけるべきです。さらに、一般ユーザーに対して、プロンプトエンジニアリングの習熟を要求するのも避けるべきです。最後に、システムがより人間らしくなるにつれて、だまされやすいところも似ることがないようにしなくてはいけません。そうなった場合、我々の努力が仇となり、個人データにはるかに簡単にアクセスできるようになってしまいかねません。</p>
<p>より<strong>インテリジェント</strong>なインターフェースであれば、そのような愚かな間違いをおかすこともないでしょう。</p>
<p>本記事の草稿時に貴重なご意見をいただいた<a href="https://www.michael-sands.com/">マイケル・サンズ</a>氏、<a href="https://www.evanmiller.org/">エヴァン・ミラー</a>氏、<a href="https://www.youtube.com/@TheRiceRocketeer">コリン・カウリー</a>氏に、この場を借りて感謝の意を表します。</p>]]></content:encoded></item><item><title><![CDATA[グラフィックデザインにおけるAIジレンマ：卓越したタイポグラフィとその先へ]]></title><description><![CDATA[クイックサマリー：AIはタイポグラフィに大変革をもたらしつつあります。それは、デザイナーにとってチャンスをもたらすと同時に、課題も突きつけています。品質に影響はあるのでしょうか。また、デザインの役割…]]></description><link>https://postd.cc/ai-dilemma-graphic-design-typography/</link><guid isPermaLink="false">https://postd.cc/ai-dilemma-graphic-design-typography/</guid><category><![CDATA[AI]]></category><category><![CDATA[タイポグラフィ]]></category><pubDate>Fri, 31 May 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p><strong>クイックサマリー</strong>：AIはタイポグラフィに大変革をもたらしつつあります。それは、デザイナーにとってチャンスをもたらすと同時に、課題も突きつけています。品質に影響はあるのでしょうか。また、デザインの役割や活字の使用は今後どう変わっていくのでしょうか。この未知の領域を進みながら、私たちはグーテンベルクによる印刷機の発明以来の重要な岐路に立っていることに気づかされます。近い将来、テキストとの関わり方やビジュアルコミュニケーションは大きく変わるでしょう。</p>
<hr>
<p>時は2028年、あなたは今よりもはるかにグレードアップしたワークステーションの前に座り、壁に映し出された画面を見つめています。「ねえ、AI」とあなたは語りかけます。「このページの見出しなんだけど、いくつか字体の選択肢を…」あなたが話し終わる前に、「タイプマスター3000」の愛称で呼ばれるAIアシスタントが熱心に口を挟みます。「大胆かつ奇抜なデザインがいいですか？それとも、洗練された雰囲気の中に遊び心も感じさせるセリフにしますか？」</p>
<p>あなたはあきれた顔でこう言います。「選択肢を10個出してちょうだい。今回は遊びの要素は抜きで。」</p>
<p>AIが見栄えのいいフォントや統一感のある質の高いデザインを生み出せなかった時代は終わりました。ライセンスの問題も過去の話です。2028年のAIは、独創的なフォントファミリーを複数の言語で提示できるようになっています。グリフ（訳注：一般的には「字体」などの意）も一つひとつ完璧な仕上がりです。しかし、完璧とは言え、癖がないわけではありません。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/1-typemaster3000-jamieclarketype.jpg">
<a href="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/1-typemaster3000-jamieclarketype.jpg"><em>拡大プレビュー</em></a></p>
<p>タイプマスター3000が瞬時に生成したフォントのサンプルを見てみると、「Sandy Serif」や「Desert Island Display」といった具合に、どのデザインにもどこか海辺のバカンスを思わせるような雰囲気があります。</p>
<p>あなたはため息をつきます。「ビーチ感は抑えて、もっとビジネスライクにしてくれる？」</p>
<p>「了解です」とタイプマスター3000は言います。「ビジネスモードに戻ります！」</p>
<p>気に入ったフォントが見つかったのでタップすると、あなたが作成したデザインに即座に反映されます。バランスや位置関係も調整されて、まるで初めからそこにあるべきであったかのような自然な仕上がりです。</p>
<h2>タイポグラフィにおけるテクノロジーの進化</h2>
<p>では、現在に視点を戻しましょう。最新のソフトウェアを駆使しても、プロフェッショナルな書体を新たに生み出す作業は時間がかかり、細心の注意が求められます。木活字に始まり、金属、フィルム、デジタルへと進化を遂げてきた活字産業は、歴史を通して常にテクノロジー革新の最前線を走ってきました。</p>
<p>新たなテクノロジーが生まれる度に、活字の生産方法は大きく変わり、活字の作成と使用の両方でデザイナーの活躍の機会が広がってきました。他の業界と同様に、我々もAIという山を麓から見上げ、この先待ち受ける険しい変化の道のりに身構えています。</p>
<p>人工知能が活字デザインに及ぼす中期的影響に関する予想は、主には大抵次の2つのシナリオに集約されます。</p>
<ol>
<li><strong>コラボレーションツールとしてのAI（副操縦士としてのAI）</strong><br>
このシナリオでは、AIは活字のデザインプロセスを支援し、太字やイタリック体の書体の作成など、時間のかかる作業を行います。活字デザイナーは反復作業の負担から解放されるため、ワークフローを合理化し、より多くの時間をクリエイティブな作業にあてることができます。</li>
<li><strong>完全AI生成フォント（オートパイロットとしてのAI）</strong><br>
タイプマスター3000のシナリオで見たように、このシナリオでは、AIは独自にフォントを作成します。その結果、愛好家がプロンプトを使用して作成した無料の書体が大量に生まれるでしょう。最初は、プロのデザインと比べて新規性や一貫性、クラフトマンシップに欠ける可能性があり、市場はより信頼できる、専門家によって生成されたAIフォントに傾くでしょう。</li>
</ol>
<p>しかし、やがて素人が作成した「海辺のバカンスにぴったりなフォントを作って」といった簡単なプロンプトでも、人の手による成果物に匹敵するものをAIが生成できるようになるでしょう。そのため、長期的にはオートパイロットフォントが優勢になってくると思われます。活字ユーザーにとっては、いずれにしても使えるフォントの選択肢が増えるため、どちらのシナリオでも喜ばしいでしょう。しかし、このような変化は活字業界を大混乱に陥れるものになります。</p>
<h2>グーテンベルク規模の大変革</h2>
<p>しかし、AIの山の頂はまだこのシナリオのはるか先です。混乱は伴うものの、これは活字産業が将来大きな革新を遂げるために必要で、重要な変化なのです。道のりは険しいかもしれませんが、AIは画期的なフォントを生成するだけでなく、テキストによるコミュニケーションに根本的な革命を起こし、動的でインタラクティブなタイポグラフィの新時代への道を開くでしょう。</p>
<p>過去にもテクノロジー革新はありましたが、タイポグラフィそのものは600年前に発明されて以来大きく変わっておらず、テキストをより広く普及させるために写字生の創造性が大いに犠牲になってきました。次の進化では、コンテキストによって変わる動的な書体が登場するでしょう。それにより、特定のコンテキストやユーザーの要望に応じてテキストをカスタマイズし、より細かいニュアンスを正確に伝えることが可能になります。</p>
<p>このようなタイポグラフィの革命は、世界の文明に大きな恩恵をもたらすと考えられ、我々の最終目的であるべきです。</p>
<h2>AI革命における最新の進歩</h2>
<p>AI画像生成は、特にディープラーニングの領域において急速な進歩を遂げています。ピクセルベースの画像を中心に、素晴らしい成果物を生み出しています。これらの画像は、ニューラルネットワークを駆使し、<a href="https://www.youtube.com/watch?v=oGvHtpJMO3M&#x26;t=78s">デジタルのモザイク画を作成するように</a>個々のピクセルを操作して生成されます。一方で、フォントの作成に不可欠なベクターグラフィックスは進化のペースが緩慢で、2023年に発表された論文の数もわずかです。</p>
<p><a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">ベジェ曲線</a>によって定義されるベクターグラフィックスは、そのアルゴリズムの特性により、ニューラルエンコーディングの面でより複雑な課題を突きつけています。しかし、この分野に<a href="https://alexandre01.github.io/deepsvg/">言語モデルの手法を応用</a>する動きが広がっており、より高度な応用が期待できそうです。</p>
<p>とりわけ目覚ましい進展がみられるのが、AIが学習することで<a href="https://arxiv.org/abs/2303.14585">ある画像のスタイルを別の画像に適用</a>するスタイル転換の研究です。これは、円形書体とモダンなサンセリフ体を融合し、巻きひげや、ストロークのコントラストをあしらったHelveticaを作るようなものです。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/2-font-style-transfer.png">
<em>フォントスタイル変換</em> <a href="https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/2-font-style-transfer.png"><em>拡大プレビュー</em></a></p>
<p>AIが少数の文字からフォントのスタイルを学習し、それを当てはめることで完全なフォントを生成する<a href="https://arxiv.org/abs/2305.10462">フューショットフォント生成タスク</a>と呼ばれる手法でも、大きな進展がみられています。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/3-few-shot-font-generation.png">
<em>フューショットフォント生成</em>  <a href="https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/3-few-shot-font-generation.png"><em>拡大プレビュー</em></a></p>
<p>このアプローチは、特に多言語フォントや、巨大な文字セットを持つ日本語や中国語のフォントをデザインする上で、商業面でもクリエイティブ面でも大きな可能性を秘めています。</p>
<p>ベクターグラフィックスやタイポグラフィの生成におけるAIの可能性はまだ初期段階にあるものの、現在の動向は有望な未来を示すものであり、複雑性の問題は徐々に克服されていき、デザイナーに新たな道を開くでしょう。</p>
<h2>未来を導く：AIタイポグラフィにおけるデザイナーの重要な役割</h2>
<p>こうした流れや、高らかにうたわれているAIの可能性を受けて、クリエイティブ領域のプロフェッショナルは当然のことながらその短期的影響について検討しています。AIを活用する愛好家が増えるにつれ、タイポグラフィを含む専門テクノロジーが軽視されるようになるのではないかと、デザイナーは懸念を募らせています。</p>
<blockquote>
<p><a class="pull-quote__link" aria-label="Share on Twitter" href="https://twitter.com/share?text=%0aTo%20preserve%20our%20creative%20integrity%20and%20professional%20effectiveness,%20it%e2%80%99s%20crucial%20for%20designers%20to%20influence%20the%20development%20of%20AI%20tools%20and%20insist%20on%20high%20design%20standards%20to%20positively%20shape%20the%20future%20of%20our%20industry.%0a&amp;url=https://smashingmagazine.com%2f2024%2f01%2fai-dilemma-graphic-design-typography%2f">クリエイターとしての本来の姿とプロフェッショナルとしての立場を守るため、デザイナーがAIツールの発展に影響を及ぼし、高いデザイン基準を主張することは、我々の業界の未来を良い方向に導く上で極めて重要です。</a></p>
</blockquote>
<p>（訳注：原文同様 XへのPOSTリンクとなっています）</p>
<p>グーテンベルクの印刷機も、当初は懸念や論争を引き起こしたものの、史上最も革命的な発明の一つになりました。AIも同様の可能性を秘めていますが、それがどのような道筋をたどのるかは我々のアプローチにかかっています。</p>
<h2>デザイナーのジレンマ：品質を保ちつつAIを受け入れる</h2>
<p>人工知能を利用して創造性を高め、効率化を図るのか、それとも素人主導の自動化がプロの仕事の質の低下を招くリスクを黙って見過ごすのか、我々は選択を迫られています。受け身の姿勢で傍観者になるのではなく、AIの発展が品質主導の結果につながり、これらのツールがデザイナーとしての我々の力を弱めるのではなく、強化するよう積極的に関わる必要があります。</p>
<p>デザイナーは、アイデアを構築する方法について造詣が深いため、AIツールをより効果的に使いこなせると言われています。しかし、こうした新しいツールを受け入れることは、ガードを緩め、他者が基準を設定するのを認めることとは違います。そうではなく、我々はAIをインスピレーションやイノベーションへの踏み台として利用すべきです。</p>
<p>例えば、現在のAI生成画像は分かりにくいテキストプロンプトと大量のデータセットの組み合わせにより、予期しない結果を生み出すことが少なくありません。しかし、インスピレーションを得て、新しいアイデアを生み出すきっかけとして有効なツールです。</p>
<h2>AIタイポグラフィにおいて立場を守る</h2>
<p>タイポグラフィにおいて、デザイナーは書体を選ぶ際により慎重になる必要があります。独創的で創意に富んだアマチュアフォントが市場に大量に出回り、それらの品質について掘り下げた評価が必要になる可能性があります。デザイナーは、文字セット、スペーシング、デザイン全体をより注意深く確認しなくてはいけません。</p>
<p>書体を巧みに使うことは、仕事を際立たせるだけでなく、業界のトレンドや基準に影響し、活字デザイナーのインスピレーションや指針になるという意味でも、これまで以上に重要です。</p>
<h2>活字デザインにおいてAIに適応する</h2>
<p>AIツールの発展と方向性は、テクノロジーに巨額の投資を行っている大企業の手にのみ委ねる必要はありません。タイプファウンドリー各社が協力し、互いのリソースを出し合って<strong>共通のAIソフトウェアモデル</strong>を構築できれば有効な手立てになるでしょう。こうした協力的アプローチにより、AI主導のイノベーションを利用できるだけでなく、独自のデザインを無断使用から守ることもできます。</p>
<p>また、<strong>大規模なAIモデルより小規模なものの方がパフォーマンス面で優れている場合がある</strong>ことを示す<a href="https://www.semianalysis.com/p/google-we-have-no-moat-and-neither#%C2%A7large-models-arent-more-capable-in-the-long-run-if-we-can-iterate-faster-on-small-models">研究結果</a>もあります。つまり、独立系のファウンドリーが独自のニーズに合わせた小規模なカスタムAIツールを開発することも可能ということです。</p>
<h2>デザイナーが未来を形作る：静的なタイポグラフィからAI主導のイノベーションへ</h2>
<p>品質がまちまちのアマチュアフォントが大量に出回るのは懸念材料ですが、AIはプロによる書体の品質と新規性も大幅に改善するでしょう。活字デザイナーは開発者と協力し、活字の次なる進化をリードしていく存在です。</p>
<blockquote>
<p><a class="pull-quote__link" aria-label="Share on Twitter" href="https://twitter.com/share?text=%0aWhat%20we%e2%80%99ve%20become%20used%20to%20in%20terms%20of%20typography%20is%20woefully%20static,%20lacking%20the%20ability%20to%20dynamically%20adjust%20to%20content,%20context,%20or%20reader%20interaction.%20At%20present,%20our%20options%20are%20limited%20to%20changing%20font%20styles%20and%20incorporating%20emojis.%0a&amp;url=https://smashingmagazine.com%2f2024%2f01%2fai-dilemma-graphic-design-typography%2f">私たちが見慣れたタイポグラフィはひどく静的で、コンテンツやコンテキスト、読み手の反応に応じて動的に調整することができません。現時点では、フォントスタイルを変えたり、絵文字を取り入れたりするくらいしか選択肢がありません。
</a></p>
</blockquote>
<p>（訳注：原文同様 XへのPOSTリンクとなっています）</p>
<p>過去に活躍した写字生は、強調や装飾を施したテキストを作成するテクノロジーにたけており、情報の伝達をより豊かなものにしていました。ヨハネス・グーテンベルクが印刷機を発明した際、彼の目的は写字生の芸術性を超えることではなく、知識と情報を一般大衆に届けることでした。その点について言えば、グーテンベルクは成功しました。しかし、活字はその後創造的進化を遂げたものの、テキストを視覚的により豊かにし、微妙なニュアンスを表現する写字生の能力は失われました。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_1600/https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/4-illuminated-manuscript-on-vellum-vienna.jpeg">
<em>活字の発明によって失われた表現の豊かさや柔軟性を示す挿絵入り原稿。ウィーン、1430〜1435年頃。</em>（<em>画像出典：</em><a href="https://upload.wikimedia.org/wikipedia/commons/4/49/2014_CKS_01584_0011_001%28missal_use_of_udine_illuminated_manuscript_on_vellum_vienna_c1430-35%29.jpg"><em>Wikipedia</em></a>）<a href="https://files.smashing.media/articles/ai-dilemma-graphic-design-typography/4-illuminated-manuscript-on-vellum-vienna.jpeg"><em>拡大プレビュー</em></a></p>
<h2>タイポグラフィの運命</h2>
<p>タイポグラフィの次なる革命は、<a href="https://typedrawers.com/discussion/comment/64337/#Comment_64337">テキスト表現の流動性、適応性、双方向性</a>の時代を開くものであるべきでしょう。<strong>活字はもっとカスタムレタリングのように振る舞うべきです</strong>。この変化は読者体験を大幅に向上させ、文字によるコミュニケーションをより汎用的かつ正確にし、以下を含むさまざまな要素への対応を可能にします。</p>
<ul>
<li><strong>コンテンツに応じたテキストの調整</strong><br>
本のクライマックスに合わせてスタイルやリズムを変えたり、元気が出る詩を読む際に文字をおどけた調子で浮かび上がらせたりといった、表示されたコンテンツに応じたテキストの変化。</li>
<li><strong>環境への適応</strong><br>
照明や、読者の目とテキストの距離などに応じたテキストの変化。</li>
<li><strong>感情の表現</strong><br>
色の変化やかすかなアニメーションなど、テキストの感情的なトーンに応じて変化する要素を取り入れた、表現豊かなコミュニケーション。</li>
<li><strong>ユーザーインタラクション</strong><br>
生体センサーを通じて検知するユーザーの読むスピードや目の動き、感情的な反応に応じたテキストの変化。</li>
<li><strong>デバイスとプラットフォームの応答性</strong><br>
CSSを使ってあらかじめ設定する必要もなく、画面のサイズ、解像度、向きなどの要素を考慮し、テキストを適応させることで実現する最適な可読性。</li>
<li><strong>アクセシビリティの強化</strong><br>
幼い読者や、失語症や視覚障害のある読者に合わせて文字の大きさやコントラストを動的に調整するテキスト。</li>
<li><strong>言語と文化への適応</strong><br>
タイポグラフィのデザイン意図を維持し、文化的なニュアンスに敏感に適応しつつ、言語間やスクリプト間でスムーズに移行できる活字。</li>
</ul>
<h2>最後に：デザインの未来を受け入れる</h2>
<p>我々は、タイポグラフィの大変革の入り口に立っています。他の業界と同様に、活字業界もこの先大きな変化が待ち受けています。タイプマスター3000のような未来のシナリオは、業界にとってその道のりがいかに混乱に満ちたものかを示しています。しかし、静的な活字の限界を押し広げ、我々の創造力を高め、異文化コミュニケーションの向上を促すためにも、この道は進む価値のあるものです。</p>
<p>変化は近づいており、我々デザイナーにとっては変化を受け入れるだけでは不十分です。専門知識、嗜好、判断力を頼りに、積極的に変化のかじ取りをしなくてはいけません。業界一丸となってタイポグラフィへのAIの導入を導き、単なる自動化にとどまらないようにすることが重要です。AIの導入は、タイポグラフィを高めるものであるべきです。目指す先には、フォントの静的な実用性を超越した、動的かつ正確で、コンテキストに応じて変化するタイポグラフィがあります。</p>
<p>各自が創造性や知見を持ち寄り、ともにAIを導くことで、自らの創造性を高められるだけでなく、デザインの水準を引き上げ、文明全体をより豊かにすることができるはずです。</p>
<h3>関連リンク</h3>
<ul>
<li><a href="http://www.jamieclarketype.com/">Jamie Clarke氏オフィシャルサイト</a></li>
<li><a href="https://www.lttrink.com/">LTTR/INK</a></li>
</ul>]]></content:encoded></item><item><title><![CDATA[分析による思考の麻痺を脱し、自信を持って決断を下す方法]]></title><description><![CDATA[「決断の時における最善の選択は、正しいことをすること。最悪の選択は、何もしないことだ。」セオドア・ルーズベルトの言葉です。 人生を左右する可能性のある重要な決断を下すとき、結果が不確実であることや、…]]></description><link>https://postd.cc/how-to-stop-analysis-paralysis-and-make-more-confident-decisions/</link><guid isPermaLink="false">https://postd.cc/how-to-stop-analysis-paralysis-and-make-more-confident-decisions/</guid><category><![CDATA[スタートアップ]]></category><category><![CDATA[起業家精神]]></category><category><![CDATA[意思決定]]></category><category><![CDATA[クリティカルシンキング]]></category><pubDate>Fri, 26 Apr 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p>「決断の時における最善の選択は、正しいことをすること。最悪の選択は、何もしないことだ。」セオドア・ルーズベルトの言葉です。</p>
<p>人生を左右する可能性のある重要な決断を下すとき、結果が不確実であることや、未知の領域に踏み込むことへの不安から、ひたすらデータを集めては分析を繰り返し、必要以上に考え過ぎてしまう非生産的な悪循環に陥ってしまうことがあります。</p>
<p>想像が膨らんでしまい、最悪のシナリオを想定してそれが最善だと思い込んでしまうこともあれば、頭の中にストーリーを描き、良い選択肢があるにもかかわらず、より良い選択肢があるのではと考えて全て却下してしまうこともあります。
<em>こうした決断の例としては、引越し、退職と起業、転職、企業戦略の大転換などがあります。</em></p>
<p>恐怖心、完璧主義、怠惰、集中すべき目標の欠如など、理由はさまざまですが、分析ばかりに時間を費やして一向に行動を起こさないでいると、「analysis paralysis（分析による思考の麻痺）」と呼ばれる一種の思考停止状態に陥ってしまいます。完璧な決断を下そうと思うあまり、決断できなくなってしまうのです。ありもしない確実性を追求し続けるため、結論が出ずもがき苦しみます。何が最善の決断で、どうすれば望む結果が得られるのかなど、誰にも分からないのです。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>考え過ぎると、分析が逆に思考を麻痺させてしまいます。考え抜くことは大事ですが、考えることを行動を起こさないことの言い訳にしている人が多いように思います。
— ロバート・ハージャベック</p></div></div>
<p>完璧な決断を下すことはできませんが、より自信を持って決断を下すことは可能です。そのために実践できる4つの方法をご紹介します。</p>
<h2>実現したい結果を明確に定義する</h2>
<p>問題の定義が曖昧だったり、実現したい結果が不明確だったりする中で決断を下そうとすると、何時間もデータと睨めっこするだけで、いつまで経っても結論が出ないということになりかねません。</p>
<p>決断を下せない原因について、問題が複雑であることや、インプットが足りないこと、データポイントが少ないことなどを挙げるかもしれませんが、これらは全て真実から目を逸らすための言い訳に過ぎません。真実とはすなわち、自分が何を望んでいるのかが分からないということです。</p>
<p>問題を明確にし、成功の基準を定義することが、決断を下すために行うべき作業の半分です。これが、決断を下して望む結果を手にするための足がかりとなります。この作業を怠ると、残り半分の作業にいくら労力を割いても徒労に終わります。</p>
<p>前半の作業を行うにあたり、以下の問いについて考えてみるとよいでしょう。</p>
<ol>
<li>解決したい問題は何か？</li>
<li>解決するべき問題は本当にこれでいいのか？</li>
<li>どのような結果を実現したいのか？自分にとって最も重要なことは何か？</li>
<li>結果を実現できたかどうかはどう確認するのか？成功基準は何か？</li>
</ol>
<p>思考の麻痺は、成功基準が達成不可能な場合にも起こります。挙げた目標を全て100%確実に実現することを期待し、一切の妥協を認めない場合などです。</p>
<p>望む結果を単に羅列しただけでは優れた成功基準とは言えません。自分にとって最も重要なことを一つ特定する必要があります。それがあなたの北極星（道しるべ）になります。道しるべが分かっていると、決断を下すのも容易になります。道しるべにたどり着けそうな、有望な選択肢を見つけるだけでいいのです。</p>
<p>問題と実現したい結果を明確に定義することで、常に目標をしっかりと見据え、意思決定プロセスを容易にすることができます。</p>
<h2>必要十分で満足する</h2>
<p>何かを決断するとき、さまざまな選択肢や異なる視点、複数の情報源を考慮するのは良いことです。そうすることで、バイアスや思い込み、その他の状況的制約によって、決断と実現する結果が制限されるのを防ぐことができます。</p>
<p>選択肢があるのは良い一方で、選択肢が多過ぎるとかえって圧倒されてしまいます。選択肢が多ければ多いほど、決断を下すのは難しくなります。情報過多と多過ぎる選択肢は決断力の低下を招くのです。</p>
<p>解決策の調査に多くの時間を費やし、それぞれの欠点にばかり注目し、最善の選択肢を見つけようとひたすら時間と労力を注ぎ込むことになりかねません。しかし、決断を下して前に進むどころか、選択肢が多過ぎると不安が膨らむばかりです。</p>
<p>選択肢が多過ぎると思考能力が奪われ、決断を先送りにしがちです。</p>
<p>選択肢が増えると満足度が下り、自分の選択に自信が持てなくなって、後で決断を後悔する可能性が高まることを示す<a href="https://www.researchgate.net/publication/265170803_Choice_Overload_A_Conceptual_Review_and_Meta-Analysis?ref=hackernoon.com">研究結果</a>もあります。</p>
<p>心理学者のバリー・シュワルツは、人間は「マキシマイザー（利益最大化人間）」と「サティスファイサー（満足化人間）」の2種類に分けることができると言います。マキシマイザーは、最大の利益をもたらす選択をしようと努力し、最高の結果のみを求め、受け入れます。全ての選択肢をよく吟味しなければ選択できないため、絶えず情報を求めては他者と比較します。一方、サティスファイサーはより控えめな基準を用いて、受け入れ可能なレベルを超える選択肢を選びます。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>「サティスファイス（満足化）」するということは、十分なレベルで満足し、より良い選択肢があるかもしれない可能性については考えないということです。」
— バリー・シュワルツ</p></div></div>
<p>思考の麻痺に陥らないために、サティスファイサーになりましょう。それには以下のことを行う必要があります。</p>
<ol>
<li>調査範囲に境界を設けましょう。無制限に調査を行うことは避けてください。収集する情報量や考慮するインプットを制限し、期限を設けましょう。</li>
<li>決断にも期限を設けましょう。危機感を持つためにも、問題の規模や複雑さを踏まえた期限を設定してください。</li>
<li>それぞれの選択肢について良い点と悪い点を挙げ、その時点で際立って優れて見えるものを選びましょう。</li>
<li>決断を下したら、より良い選択肢の可能性については考えないようにします。自分の決断について後からあれこれ悩むことはせず、決断を実行に移していきましょう。</li>
</ol>
<p>必要十分で満足するということは、平凡な選択肢を受け入れるのとは違います。十分な検討と思慮に基づいて選択を行う必要はありますが、一定の制限を設けた上で行うのであり、より良い選択肢の可能性についてくよくよ悩むのではなく、決断を行動に移すことに時間と労力を費やすということです。</p>
<h2>直感でデータを組み合わせる</h2>
<p>思考が麻痺すると、決断を前に尻込みしてしまいます。合理的な選択をしたいがために行き詰まりを感じます。それ自体は自然なことですが、問題は、知らず知らずのうちに合理性の追求から過度な分析を行うようになり、その結果、意思決定を先送りしてしまうことです。</p>
<p>合理的アプローチには、慎重な思考が求められます。脳の前頭葉を働かせ、さまざまな選択肢を考慮し、妥協点を比較した上で選択を行います。直感的思考は、感情や経験、知識を動員して行います。このような思考は非論理的でも非合理的でもなく、生涯を通じて養ってきた知性です。</p>
<p>脳はパターンを認識するようにできており、直感的思考ではあなたが現在置かれている状況を過去のパターンに照らし合わせ、それをもとに決断を下します。直感が時に正しく、時に間違っているのはそのためです。</p>
<p>判断と意思決定にまつわる心理学や行動経済学の研究で知られる心理学者および経済学者のダニエル・カーネマンは、直感の働きは次の3つの条件に基づくと言います。</p>
<ol>
<li>傾向やパターンを認識するためには、一定の規則性が求められます。直感は、目まぐるしく変化する複雑な状況下では養うことも、適用することもできません。</li>
<li>直感を信じるためには、その分野について豊富な経験と練習が必要です。それがなければ、直感を働かせて万事うまくいったとしても、それは単に運が良かっただけであり、直感がもたらした結果ではありません。</li>
<li>直感が正しかったかどうかについて、即座に具体的なフィードバックが得られます。</li>
</ol>
<p>これらのうち該当しないものがある場合、問題についてもっと合理的に考え抜いた方がいいでしょう。</p>
<p>ほとんどの人は、意思決定を行う際に分析的思考と直感的思考のいずれかを使用します。これは、両者が共存できない相反する戦略だと考えているからです。しかし、研究ではそれとは異なる事実が明らかになっています。私たちの最良の決断は、分析的思考と直感的思考のいずれかを使用するのではなく、両方を組み合わせて使用したときに生まれるのです。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>パターン照合のみに頼った純粋に直感的な戦略は、パターン照合がもたらす選択肢が間違っていることがあるため、リスクが大き過ぎます。逆に、思索のみに頼った分析的な戦略だと時間がかかり過ぎます。
— ゲーリー・クライン</p></div></div>
<p>思考の麻痺に陥ったときは、データのみに頼るのではなく、過去の知識や経験も加味して決断を下すとよいでしょう。脳の理性をつかさどる部分を使ってさまざまな選択肢を考慮し、直感も交えて最終的な決断を下しましょう。</p>
<h2>決断を下すのに適切な時間帯を選ぶ</h2>
<p>1日を通して小さな決断を何度も下すことは、それ自体さほど精神的負担を強いるものではないため、一見無害に思えるかもしれません。しかし、エネルギーを消費し続けて1日の終わりを迎える頃には、決断を下す余力が失われてきます。</p>
<p>実際に感じることができてすぐに現れる身体的疲労とは異なり、繰り返し意思決定を行ってきたことによる精神的疲労は目に見えません。</p>
<p>心理学者が意思決定疲労と呼ぶこの状態は、意思決定の質の低下を招きます。いくつもの意思決定を行った後は、折り合いをつけることを渋り、簡単な選択肢に落ち着こうとし、自制心を働かせることさえ難しく感じられるかもしれません。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>一日中難しい決断を迫られるような仕事だと、気力もいつかは底をつき、エネルギーを節約する方法を探し始めます。例えば、決断を避けたり、先送りしたりする言い訳を探すようになるでしょう。また、最も楽で安全な選択肢を探すようになるでしょう。そしてその選択肢とは、多くの場合、現状を維持することです。
— ロイ・バウマイスター</p></div></div>
<p>良い決断を下すためには、さまざまな領域の知識を動員し、異なるアイデアをつなぎ合わせ、アイデアの深さと幅広さの適切なバランスを保ち、新たなつながりを生み出し、いくつかの有望な候補に焦点を定める必要があります。</p>
<p>疲労により頭の働きが鈍ってくると、雑音と信号を聞き分けることも難しくなります。その結果、考え過ぎてしまうようになり、具体的な方向性を示すこともできないまま、いくつものアイデアを行ったり来たりするようになります。</p>
<p>意思決定疲労は、存在すらしない問題について延々と考えたり、偏った結論を導いたり、より良い選択肢の可能性にとらわれ分析による思考の麻痺状態に陥ったりする原因になり得ます。その時の状況で最良の決断を下すのではなく、完璧な解決策を追求しようとしてしまうかもしれません。</p>
<p>重要な決断について思考の麻痺に陥らないようにするため、そうした決断は、頭の情報処理能力がピークの時間帯に下すようにしましょう。気力が充実しているタイミングに合わせて精神的負担が強いられる決断を下すことで、考え過ぎてしまう悪循環に落ちる可能性を減らせるでしょう。</p>
<p>決断を下す前に、以下の問いを自問してみてください。</p>
<ol>
<li>今がこの決断を下すのにベストな時間帯か？</li>
<li>この決断を下すにあたって、ベストコンディションにあると言えるか？</li>
<li>普段に比べて周りが慌ただしく感じられるか？</li>
</ol>
<p>その決断を下すのに自分がベストの状態にある時間帯を確保し、カレンダーに書き込みましょう。そしてその時間になったら、それ以上決断を遅らせないよう自分に言い聞かせ、目標に集中しましょう。</p>
<p>初めはばからしく感じられるかもしれませんが、実際に繰り返し行うことで、考え過ぎることなく決断を下せるようになってくるはずです。</p>
<p>最後はテリー・グッドカインドの以下の言葉で終わりたいと思います。筆者が思考の麻痺に陥ったときに、いつも助けてくれる言葉です。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>「何も選択しないより、間違った選択をした方がいい場合もあります。あなたに前に進む勇気があるのであれば、それは稀有なことです。岐路に立ち、進むべき方向を選べない人は、どこにもたどり着けません。」</p></div></div>
<h2>考えることをやめ、今すぐ行動しましょう。</h2>
<h3>まとめ</h3>
<ol>
<li>重要な決断は先送りするべきではありませんが、そうしてしまいがちです。完璧な決断を下そうとすると、思考が麻痺してかえって決断を下せなくなってしまい、行動を起こして前に進むことができなくなります。</li>
<li>問題や実現したい結果を明確に定義しないことが、思考の麻痺に陥る最大の原因の一つです。なかなか決断を下せず苦しんでいる場合、問題と成功基準を明確に定義しましょう。</li>
<li>最良の選択肢のみを追求するマキシマイザーになるのではなく、サティスファイサーになり、十分満足できる選択肢を特定して心配することをやめましょう。</li>
<li>直感を無視して合理的思考に重点を置き過ぎると、思考が麻痺します。考え過ぎによる悪循環を断ち切り、積極的に行動を起こすには、直感と合理的思考を組み合わせる戦略が効果的です。</li>
<li>意思決定疲労により疲れた頭は、決断を下すことを拒むようになります。この現象に対処する方法として、気力が充実している時間帯に決断を下すようにするとよいでしょう。</li>
</ol>
<p>この記事は以前<a href="https://www.techtello.com/analysis-paralysis/?ref=hackernoon.com">こちら</a>で公開されたものです。他の記事にも興味のある方は、<a href="https://www.linkedin.com/in/sagivini/?ref=hackernoon.com">LinkedIn</a>またはこちらをぜひフォローしてください。</p>]]></content:encoded></item><item><title><![CDATA[ChatGPTはプロのUI/UXデザイナーによるアプリ設計にどの程度役立つのか？]]></title><description><![CDATA[none «自動化できるものはすべて自動化されるだろう» - ロバート・キャノン、インターネット法・政策専門家 人工知能（AI）が今年のトレンドであることは紛れもない事実です。AI技術が台頭し、さま…]]></description><link>https://postd.cc/how-well-can-chatgpt-help-uiux-professionals-design-an-app/</link><guid isPermaLink="false">https://postd.cc/how-well-can-chatgpt-help-uiux-professionals-design-an-app/</guid><category><![CDATA[生成AI]]></category><pubDate>Fri, 29 Mar 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>«自動化できるものはすべて自動化されるだろう» - ロバート・キャノン、インターネット法・政策専門家</p></div></div>
<p>人工知能（AI）が今年のトレンドであることは紛れもない事実です。AI技術が台頭し、さまざまな業界で急速に普及する中、UI/UXデザイナーやプロダクトデザイナーも当然その影響を受けています。ChatGPTやMidjourney、DALL-E 2（ダリ・ツー）、Stable Diffusionなどの製品はすでにかなり人気があり、筆者の同僚の中にも積極的なユーザーが多数います。</p>
<p>UI/UXデザイナーとして、筆者もChatGPTを作業プロセスに取り入れたことにより、より使いやすいインターフェースの開発能力が格段に向上したことをすでに実感しています。この記事では、ChatGPTの具体的な使い方を示しつつ、ChatGPTを利用することでどのようなメリットを享受でき、いかにして全体的な作業効率を高められるのかを説明します。では早速見ていきましょう！</p>
<h2>UI/UXデザイナーとプロダクトデザイナーの補助ツールとしてのChatGPT</h2>
<h3>リクエスト作成またはプロンプトエンジニアリング</h3>
<p>ChatGPTの可能性を最大限引き出せるかどうかは、効率的なクエリを作成する能力にかかっています。まずはリクエスト作成の基本をマスターし、さまざまなプロンプトスタイルを試してみましょう。</p>
<p>参考になりそうな例を以下にいくつか挙げましたので、ぜひご覧ください。</p>
<ul>
<li><a href="https://www.notion.so/642f21dc1ed94e2a8a6f719ff33ac540?ref=hackernoon.com">200+ ChatGPT UX Prompts</a></li>
<li><a href="https://drive.google.com/file/d/12Jj9A70GUaFuD1om_WbKYg9Ue9AWea9u/view?usp=sharing&#x26;ref=hackernoon.com">25 ChatGPT Use Cases for UX Designers</a></li>
<li><a href="https://drive.google.com/file/d/1O5-Ihv0pCOofr2oADZAVNJCi3dDUBFMn/view?usp=share_link&#x26;ref=hackernoon.com">45 ChatGPT Use Cases for Product Managers</a></li>
</ul>
<p><strong>完璧なリクエストの作成は、レシピを作る作業に似ています</strong>。期待する結果を得るためには、必要な材料をすべて適切な量加えて混ぜ合わせる必要があります。すべての工程を正しく行っても、完璧に仕上げるためには微調整が必要になるかもしれません。その要点についてこれからお話しします。
以下では、分かりやすい例として、数学を楽しく学べるモバイルアプリを開発しなければならないと仮定します。脳のトレーニングになるさまざまなテストやパズルを提供する数学クイズアプリを開発するとしましょう。</p>
<h3>要件とアイデアを集める</h3>
<p>ChatGPTは、ユーザーのリクエストを分析し、答えを生成することで、デザイナーが新しいプロジェクトの要件とアイデアを集める手助けをすることができます。コンセプトを考案し、主な機能やデザイン要件を決定する作業を含めることも可能です。</p>
<h3>では、実際にChatGPTがこの作業を行う上で助けになるのか見てみましょう。</h3>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-2ba3aye.jpeg">
<em>ChatGPTの会話</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>UX/UIデザイナーとして対応してください。主な目標は、製品やサービスのユーザーエクスペリエンスを可能な限りシームレスかつ直感的で、魅力的なものにすることです。デジタル製品やサービスのユーザーにとって、魅力的で楽しい体験を生み出します。あなたの仕事は、アプリ、ウェブサイト、その他のデジタル製品のユーザーエクスペリエンスを、創造的な方法で改善することです。結果はすべて英語で出力してください。最初のタスクは、iOS向けの数学クイズアプリのコンセプトを作成することです。</p><p><strong>タイトル：MathWiz</strong></p><p><strong>概要：</strong>
MathWizは、iOSデバイス向けに開発された対話型の数学クイズアプリであり、あらゆる年齢層のユーザーに、楽しく魅力的な教育体験を提供することを目指しています。このアプリは、各ユーザーに合わせた学習プロセスを通じて数学能力を高め、強化することに主眼を置いたさまざまなクイズや課題を提供します。</p><p><strong>特長：</strong></p><ol>
<li>カスタマイズされた学習パス：
MathWizは、ユーザーの習熟度と進捗に応じた学習パスを提供します。さまざまなクイズや課題におけるユーザーの成績を評価することで、ユーザーが効果的に力をつけられるよう最適なクイズや演習をアプリが提案します。</li>
<li>トピックの網羅性：
算数、代数、幾何学、三角法、微分積分など、幅広い数学トピックを網羅します。ユーザーは、自分の興味やレベルに応じてクイズを選択できます。</li>
<li>成績に応じた難易度設定：
MathWizは、ユーザーの成績に応じてクイズの難易度を変更する仕組みを使用します。これにより、ユーザーは常にやりがいのある問題に挑戦することができ、飽きたり不満を感じたりすることなく、関心を持って積極的に取り組むことができます。</li>
<li>ゲーム要素：
このアプリは、ポイント、バッジ、リーダーボードなどのゲーム要素を取り入れることで、学習プロセスを楽しく満足の得られるものにします。ユーザーは、クイズやチャレンジ問題をこなすとポイントやバッジを獲得します。これらはフレンドと共有したり、グローバルリーダーボードで成績を比較したりできます。</li>
<li>デイリークエスト：
日替わりのデイリークエストを実施すると、ユーザーは追加のポイントやバッジを獲得することができます。これらのクエストは、常にユーザーのモチベーションを高め、関心を引きつけ、アプリに戻ってくるよう促します。</li>
<li>進捗の管理と分析：
ユーザーが進捗を把握し、改善が必要な部分を確認できるよう、詳細な分析を行います。ユーザーはトピックやクイズ、チャレンジ問題ごとに成績を確認できるほか、進捗をフレンドと比べることもできます。</li>
<li>コラボレーションと交流：
MathWizは、クイズやチャレンジ問題、成果を共有しやすくすることで、ユーザー間のコラボレーションや競争を促します。また、チャット機能を取り入れることで、戦略を話し合ったり、助け合いながら複雑な問題に取り組んだりすることができます。</li>
<li>オフライン機能：
ユーザーは、オフラインでもクイズやチャレンジ問題に取り組むことができるため、インターネットに接続できない環境でも学習と練習を続けられます。</li>
<li>保護者機能：
保護者機能を搭載することで、保護者が子供の進捗を監督したり、目標を設定したり、特定のトピックスや機能へのアクセスを制限したりできるようにします。</li>
</ol><p><strong>デザインアプローチ：</strong></p><p>アプリはスムーズで直感的なユーザーエクスペリエンスの実現を優先したデザインとします。デザインの重要な要素は以下のとおりです。</p><ol>
<li>洗練されたモダンなUI：
MathWizは、無駄のないデザインと操作のしやすさに重点を置いた、洗練されたモダンなUIを搭載します。</li>
<li>魅力的なビジュアル：
アニメーションやイラスト、配色など、視覚的に魅力的なデザイン要素を取り入れることで、楽しく没入感のある学習環境を作り出します。</li>
<li>使いやすいナビゲーション：
アプリのナビゲーションは分かりやすく、使いやすいものにし、ユーザーはクイズやチャレンジ問題などの機能に迷うことなく簡単にアクセスできるようにします。</li>
<li>アクセシビリティ：
MathWizはアクセシビリティを念頭に置いてデザインします。ユーザーの能力や好みによらず、誰でも便利に使えるようにします。</li>
</ol><p>最後に、MathWizはカスタマイズされた学習プロセスを通じてユーザーが楽しみながら、興味を持って数学を学び、練習できる手段を提供することを目指します。トピックの網羅性、成績に応じた難易度設定、ゲーム要素、使いやすいデザインなどにより、年齢を問わずすべてのユーザーが楽しめるシームレスな体験を生み出します。</p></div></div>
</details>
<p>ご覧のとおり、ChatGPTはアプリのコンセプトをかなり詳細に記述しています。必要であれば、各機能についてさらに質問することも可能です。ChatGPTは明確な回答を提示し、さらには最も重要なポイントも示してくれます。</p>
<p>では、MathWizアプリをユーザーにとってより魅力的なデザインにするためのアイデアを尋ねてみましょう。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-n4b3a0s.jpeg">
<em>MathWizのデザイン案</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>MathWizアプリのデザイン案をいくつかリストアップしてください。</p><p>視覚的に魅力的で、ユーザーの興味を引き出すようなアプリにするためのデザイン案を以下にいくつか挙げます。</p><ol>
<li>カスタマイズ可能なアバター：ユーザーが自分のアバターを作成し、カスタマイズできるようにします。アバターは、プロフィール写真や、アプリ内での自分の分身として使用できます。こうしたパーソナライズ機能により、ユーザーエンゲージメントを高め、主体性を持たせることができます。</li>
<li>ゲーミフィケーション：ポイントやバッジ、リーダーボードなどのゲーム要素を取り入れることでモチベーションを高め、より楽しく学習できるようにします。クイズに答えるとポイントを獲得し、一定のマイルストーンに到達するとバッジが解放され、リーダーボードでフレンドや他のグローバルユーザーと成果を比べることができます。</li>
<li>進捗の可視化：視覚的に魅力的なチャートやグラフを使用して進捗を表示し、ユーザーが自分の向上過程を簡単に確認できるようにします。トピックごとの成績、合計獲得ポイント、集めたバッジを表示する進捗ダッシュボードを搭載します。</li>
<li>ダークモード：特に夜間や暗い場所での使用の際に目の疲れを軽減できるよう、ダークモードに切り替えられる機能を実装します。</li>
<li>アニメーションと画面遷移：ささやかなアニメーションやさりげない画面遷移により、スムーズでインタラクティブなユーザーエクスペリエンスを生み出します。正解や不正解の際のアニメーションや、画面の読み込み、アプリ内のセクション間のナビゲーションなどを含みます。</li>
<li>テーマに沿ったクイズ：人気のイベントや祝日、時事ネタなどをテーマにしたクイズを作成し、ユーザーの興味を引き出します。そうすることで目新しさを出し、ユーザーに新しいトピックやチャレンジ問題に挑戦するよう促すことができます。</li>
<li>共同学習：ソーシャル機能を組み込むことで、フレンドや他の学習者とつながったり、クイズやチャレンジ問題を送ったり、数学の問題について話し合ったり、成果を共有したりできるようにします。そうすることで、コミュニティとしての意識が芽生え、コラボレーションを通じた学習を促すことができます。</li>
<li>成績に応じた難易度設定：能力に合ったクイズや問題を提示することによる、ユーザーのスキルレベルに応じた難易度設定を可能にします。そうすることで、個別化された学習体験を生み出し、ユーザーを圧倒することなく、適度に難しい問題で興味を持続させます。</li>
<li>一貫した視覚言語：色やタイポグラフィ、アイコン、イラストなど、アプリ全体で一貫した視覚的言語を使用します。そうすることで、統一感のあるプロフェッショナルな外観になり、全体的なユーザーエクスペリエンス向上につながります。</li>
<li>マイクロインタラクション：ハプティックフィードバックや効果音、ビジュアルキューなどのマイクロインタラクションを取り入れることで、より興味を引きつけ、インタラクティブなアプリにします。例えば、ユーザーが答えを提出した際にハプティックフィードバックを使用したり、正解と不正解を効果音で知らせたりするといいでしょう。</li>
</ol><p>これらのデザイン案をMathWizアプリに取り入れることで、視覚的に魅力的で興味をかき立てられるような体験を生み出し、ユーザーに楽しみながら数学を学ぶよう促すことができます。</p></div></div>
</details>
<p>バーチャルアシスタントはポイントを10個挙げてくれました。どれもかなり的確で、これから開発するアプリのデザインコンセプトをまとめる手助けになりそうです。</p>
<h2>デザインの選択肢を出す</h2>
<p>ChatGPTを使うことで、要件を満たすさまざまなデザインの選択肢が得られます。その中から最も良いアイデアを選び、あまり有望でないものは除外します。</p>
<p>MathWizアプリについてはすでにアイデアが固まりましたので、情報アーキテクチャに関する詳細な説明を入手してみましょう。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-c8c3amj.jpeg"><br>
<em>デザインの選択肢を生成</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>次のタスクです。この数学クイズアプリに適した構造（情報アーキテクチャ）を作成してください。</p><p>MathWiz用にしっかりした情報アーキテクチャを作成するために、主要な画面とそれらの関係を概説します。この構造は、ユーザーとアプリのインタラクションを可能にする明確で直感的なナビゲーションシステムを提供します。</p><ol>
<li>
<p>スプラッシュスクリーン：<br>
・アプリのリソースを読み込む間、アプリのロゴ名前を表示<br></p>
</li>
<li>
<p>オンボーディング画面（新規ユーザー向けオプション）：<br>
・アプリの主な機能や利点をまとめた一連の紹介画面を表示し、新規登録やログインの方法を案内<br></p>
</li>
<li>
<p>ホーム画面：<br>
・個別化された推奨クイズやデイリークエスト、成果を含むユーザーの進捗概要。<br>
・以下のセクションへのアクセス：<br>
a. トピック<br>
b. デイリークエスト<br>
c. 成果<br>
d. プロフィール<br>
e. 設定<br></p>
</li>
<li>
<p>トピック画面：<br>
・利用可能な数学のトピック（算数、代数、幾何学、三角法、微分積分など）<br>
・トピックのフィルター・検索機能<br>
・各トピック内のサブトピックや関連するクイズへのアクセス<br></p>
</li>
<li>
<p>サブトピック画面：<br>
・選択したトピック内のサブトピックの一覧<br>
・各サブトピック内のクイズへのアクセス<br></p>
</li>
<li>
<p>クイズ画面：<br>
・選択されたクイズを、問題、答えの選択肢、タイマー（該当する場合）とともに表示<br>
・回答後、結果とともに正解、解説、獲得ポイントを表示<br></p>
</li>
<li>
<p>デイリークエスト画面：<br>
・実施できるデイリークエストの一覧<br>
・各クエストのステータス（実施済みかどうか）を、リワード（ポイントとバッジ）とともに表示<br></p>
</li>
<li>
<p>成果画面：<br>
・ユーザーが獲得したバッジや達成した成果の概要<br>
・リーダーボードを表示し、フレンドや他のグローバルユーザーと成果を比較する機能<br></p>
</li>
<li>
<p>プロフィール画面：<br>
・名前やプロフィール写真などのユーザーの個人情報や、進捗（ポイント、バッジ、完了したクイズ）の概要を表示<br>
・パフォーマンス分析やフレンドリストへのアクセス<br></p>
</li>
<li>
<p>パフォーマンス分析画面：<br>
・トピックごとの成績や強み、改善が必要な部分など、ユーザーの詳細なパフォーマンス分析を表示<br></p>
</li>
<li>
<p>フレンドリスト画面：<br>
・ユーザーのフレンドリストを、それぞれの成果とポイントとともに表示<br>
・フレンドを追加、削除、検索する機能<br>
・戦略を話し合ったり、複雑な問題について助け合ったりするためのチャット機能へのアクセス<br></p>
</li>
<li>
<p>設定画面：<br>
・通知やサウンド、アクセシビリティ（ユーザー補助）などの環境設定が可能<br>
・子供のアカウントを監視し、管理するための保護者設定<br></p>
</li>
<li>
<p>チャット画面：<br>
・フレンドと会話したり、クイズやチャレンジ問題を送ったり、数学の問題について話し合ったりすることが可能<br></p>
</li>
</ol><p>画面とそれらの関係をこのように整理することで、MathWizは十分に定義された情報アーキテクチャを持つことができ、使いやすくて楽しいユーザーエクスペリエンスを実現できます。<br></p></div></div>
</details>
<p>これはまだ製品の土台ではありませんが、この基本構造案をもとにユーザーとのインタラクションを開発し、この案をデザインの初期段階とすることができます。</p>
<p>悪くないではありませんか！</p>
<p>ChatGPTに製品の最適な配色を提案してもらうことはできるでしょうか？普段は<a href="http://colormind.io/?ref=hackernoon.com">Colormind</a>や<a href="https://colorhunt.co/?ref=hackernoon.com">Colorhunt</a>、<a href="https://coolors.co/?ref=hackernoon.com">Coolors</a>といった他のツールを使用していますが、今回はChatGPTの意見を聞いてみたいと思います。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-3wd3a1k.jpeg">
<em>ChatGPTの回答</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>それでは続けましょう。数学クイズアプリでは、色が重要な役割を果たす場合があります。次のタスクは、数学クイズアプリMathWizのブランドカラー、プライマリーカラー、セカンダリーカラーを含む、16進コード付きのカラーパレットを作成することです。</p><p>よく考えられたカラーパレットは、視覚的に魅力的で、やる気を起こさせる学習環境を生み出し、MathWizのユーザーエクスペリエンスを格段に向上させることができます。ここに挙げた色は、心地良く楽しい雰囲気を維持しつつ、興味をかき立て、やる気を引き出し、集中力を高める効果が期待できます。以下がブランドカラー、プライマリーカラー、セカンダリーカラーを含むMathWizのカラーパレット案になります。</p><ol>
<li>
<p>ブランドカラー：<br>
・ディープブルー（#274472）：この色は、信用、安定、信頼性を表します。これらは教育アプリに欠かせない要素です。ディープブルーはアプリのロゴ、ヘッダー、ナビゲーションの主要要素に使用します。</p>
</li>
<li>
<p>プライマリーカラー：<br>
・ライトブルー（#4B8BBE）：この色は気持ちを落ち着かせ、親近感を抱かせます。そのため、背景やボタン、インタラクティブ要素に適しています。<br>
・ティール（#009688）：この鮮やかな色は、アクセントに使用したり、CTAボタンや重要な情報などに注意を引き、行動を促したい場合にも使用できます。<br></p>
</li>
<li>
<p>セカンダリーカラー：<br>
・ソフトイエロー（#FFEB3B）：この色は暖かみとエネルギーを与え、進捗インジケータやバッジ、リワードのハイライトに使用できます。<br>
・ライトグレー（#F5F5F5）：この中立色は、背景色として適しています。また、強烈すぎる印象になったり、注意をそらせたりしないようにしつつ、コントラストを与えます。<br>
・ダークグレー（#616161）：この色は、テキストやアイコンに使用できます。クリーンでモダンな外観を保ちつつ、可読性を確保します。<br></p>
</li>
</ol><p>MathWizのカラーパレット案は、心地良くも興味をかき立てるような、視覚的に魅力的な環境を作り出し、ユーザーに学ぶことを促しつつ、アプリを楽しんでもらうことを意図しています。信頼できるブランドカラーを鮮やかなプライマリーカラーやセカンダリーカラーと組み合わせることで、MathWizはユーザーの注意を引き、長期間にわたる学習セッションを促します。</p></div></div>
</details>
<p>なかなか有望です！筆者は色の組み合わせの記述が詳細である点と、説明が簡潔にまとめられている点が特に気に入りました。このパレットを再現してみましたが、結果は概ね満足のいくものでした。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-5ke3a63.jpeg">
<em>カラーパレット</em></p>
<p>フォントはどうでしょうか？システムのSan FranciscoフォントとNew Yorkフォントは除外し、選択肢の多様化を図りたいと思います。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-gmf3a3t.jpeg">
<em>フォントの提案</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>見出しと本文のフォントの組み合わせを3つ提案してください。iOS向けのアプリであることを踏まえつつ、ネイティブのシステムフォント（San FranciscoとNew York）は除外してください。</p><p>MathWizのような数学クイズアプリに使用するフォントの最適な組み合わせを選ぶことは、可読性、ユーザーエンゲージメント、全体的な視覚的魅力を確保する上で極めて重要です。フォントはモダンで読みやすく、アプリのデザインを補完するものでなければなりません。MathWizに適した、見出しと本文のフォントの組み合わせを以下に3つ用意しました。</p><ol>
<li>見出し：Montserrat | 本文：Open Sans<br>
・Montserratはモダンで汎用性の高いサンセリフ体のフォントであり、見出しやタイトルの見栄えを良くします。独特な幾何学的構造を持ち、クリーンで現代的な雰囲気があります。<br>
・Open Sansは非常に読みやすく、汎用性の高いサンセリフ体のフォントであり、印刷用とデジタル用の両方に適しています。可読性に優れ、親しみやすくオープンな見た目であり、本文用として理想的です。<br></li>
<li>見出し：Roboto Slab | 本文：Roboto<br>
・Roboto Slabは現代的なスラブセリフ体のフォントであり、幾何学的な形状や親しみやすい曲線が特徴です。見出しに個性的なタッチを加えますが、過度に目を引くということもありません。<br>
・Robotoは人気のあるサンセリフ体のフォントであり、可読性と汎用性に定評があります。Roboto Slabと相性が良く、アプリ全体に統一感のあるモダンな外観を与えます。<br></li>
<li>見出し：Lato | 本文：Nunito<br>
・Latoはやや丸みを帯びたディテールが特徴で、親しみやすく暖かみのある外観のサンセリフ体のフォントです。見出しに適していて、クリーンでモダンな見た目を与えます。<br>
・Nunitoは丸みを帯びたサンセリフ体のフォントで、親しみやすさがあります。可読性に優れ、Latoとの相性も良く、調和のとれた視覚的に魅力的な組み合わせです。<br></li>
</ol><p>これらのフォントの組み合わせは、モダンなデザインと可読性のバランスが取れており、MathWizのユーザーにとってコンテンツを扱いやすくします。これらの内いずれかの組み合わせを選ぶことで、統一感の取れた視覚的に魅力的なデザインを生み出し、ユーザーエクスペリエンスを向上させることができます。</p></div></div>
</details>
<p>技術的な観点で言うと、回答はかなり正確ではありますが、一見すると面白味に欠けます。では、これらのフォントが実際どのように見えるのか確認してみましょう。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-xsg3a7m.jpeg">
<em>フォントの比較</em></p>
<h2>競合の一次分析</h2>
<p>競合アプリ（他の数学アプリ）に関する詳細な調査は、<a href="https://math-master.org/?ref=hackernoon.com">MathMaster</a>における筆者のデザインプロセスに欠かせない部分であり、AIが大いに役立っています。ChatGPTは、さまざまな情報源から大量のデータを自動的に集めて処理し、競合分析を手助けしてくれます。希望するデータの表示形式（表形式など）を指定するだけで、適切な分析結果が得られます。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-uwh3a2r.jpeg">
<em>MathWizの競合アプリ</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>同じタイプの競合するアプリをリストアップし、ステークホルダーに発表できるよう比較分析してください。比較分析結果は表にまとめてください。</p><p>MathWizの競合アプリを以下にリストアップし、比較分析結果を表にまとめました。この分析では、十分な情報をもとに意思決定を行い、MathWizのビジネスチャンスを見極められるよう、各アプリの主な機能、長所、短所、価格、対象ユーザーを比較しました。</p><table>
<thead>
<tr>
<th>競合アプリ</th>
<th>主な機能</th>
<th>長所</th>
<th>短所</th>
<th>価格</th>
<th>対象ユーザー</th>
</tr>
</thead>
<tbody>
<tr>
<td>Khan Academy</td>
<td>包括的なカリキュラム<br>個別化された学習パス<br>進捗管理<br>ゲーミフィケーション</td>
<td>確立されたブランド<br>充実したコンテンツ<br>年齢層を問わない</td>
<td>UIの情報量が多すぎる<br>ソーシャル機能がない</td>
<td>無料</td>
<td>生徒・学生<br>教員<br>保護者<br>独習者</td>
</tr>
<tr>
<td>Photomath</td>
<td>カメラベースの問題解答<br>ステップバイステップの解<br>複数の解答方法</td>
<td>画期的な問題解答のアプローチ<br>使いやすい</td>
<td>カメラを使った問題解答のみに対応、クイズや練習問題に重点を置いていない</td>
<td>無料<br>Photomath Plusのサブスクリプションは月額$9.99</td>
<td>生徒・学生<br>教員<br>保護者</td>
</tr>
<tr>
<td>Mathletics</td>
<td>アダプティブラーニング<br>ターゲットを絞った練習問題<br>リアルタイムの数学コンテスト<br>進捗管理</td>
<td>興味をそそるリアルタイムのコンテスト<br>強力なカリキュラム</td>
<td>サブスクリプションベース<br>気軽に学びたい人向けではない<br>社会人にあまり重点を置いていない</td>
<td>サブスクリプションベース<br>月額$12.99〜</td>
<td>幼稚園児から高校生<br>教員<br>保護者</td>
</tr>
<tr>
<td>Prodigy Math Game</td>
<td>カリキュラムに沿ったコンテンツ<br>アダプティブラーニング<br>ゲームベースの学習<br>進捗管理</td>
<td>興味をそそるゲーム要素<br>幼稚園児から中学生向け</td>
<td>幼稚園から中学校までのカリキュラムのみに対応<br>上級学習者や社会人向けではない</td>
<td>無料<br>オプションのPremiumサブスクリプションは月額$8.95</td>
<td>幼稚園児から中学生<br>教員<br>保護者</td>
</tr>
<tr>
<td>Brilliant</td>
<td>インタラクティブコース<br>問題解決型のアプローチ<br>クイズ<br>日替わりのチャレンジ問題</td>
<td>クリティカルシンキングと問題解決に重点<br>上級学習者向け</td>
<td>無料アクセスは制限あり<br>基本的な数学の知識にあまり重点を置いていない</td>
<td>制限付きで無料アクセス<br>Premiumサブスクリプションは月額$24.99</td>
<td>高校生<br>大学生<br>生涯学習者</td>
</tr>
</tbody>
</table><p>価格や対象ユーザーなどの情報も含めたこの詳細な比較分析表により、ステークホルダーは現在の市場状況に関する包括的な理解を得られるでしょう。MathWizのビジネスチャンスを見極め、ユーザーを獲得し、引きつける魅力的な製品を開発する上で、この情報が役立つはずです。</p></div></div>
</details>
<h2>モックアップやプロトタイプの作成プロセスを加速させる</h2>
<p>ChatGPTは、要素の説明を生成し、説明の配置やインタラクションを提案することで、モックアップの作成プロセスを一部自動化することができます。それにより、デザイナーは開発プロセスをスピードアップし、デザインのよりクリエイティブな部分に注力することができます。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-2qi3ayy.jpeg">
<em>モックアップの作成</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>MathWizアプリのフローとデザインを紹介するためにFigmaでプロトタイプを構築できるよう、プロトタイプのスクリプトを作成してください。</p><p>MathWizアプリの主な画面とインタラクションの概要を示すプロトタイプのスクリプトを以下に作成しました。このスクリプトを使用してFigmaでプロトタイプを構築し、アプリのフローとデザインを紹介できるでしょう。</p><ol>
<li>
<p>スプラッシュスクリーン：<br>
・MathWizのロゴと、その下にアプリの名前を表示<br>
・テキスト例：「MathWiz」<br></p>
</li>
<li>
<p>オンボーディング画面（新規ユーザー向けオプション）：<br>
・スライド1：「MathWizへようこそ！楽しいクイズやチャレンジ問題で数学をマスターしよう。」<br>
　・黒板に数学の問題を解いているキャラクターのイラストを入れる。<br>
・スライド2：「幅広い選択肢からトピックを選び、自分に合った学習体験を作ろう。」<br>
　・算数、代数、幾何学など、数学のさまざまなトピックを表すアイコンを表示<br>
・スライド3：「バッジを獲得し、デイリークエストを実施し、学習の進捗を管理しよう。」<br>
　・成果を表すバッジコレクションとプログレスバーを表示<br>
・スライド4：「準備はいいですか？新規登録またはログインして学習プロセスを始めましょう！」<br>
　・「新規登録」と「ログイン」のボタンを含める<br></p>
</li>
<li>
<p>ホーム画面：<br>
・ウェルカムメッセージと、一人ひとりに合わせたおすすめクイズを表示<br>
　・テキスト例：「[ユーザー名]さん、お帰りなさい！[ユーザー名]さんにおすすめのクイズをご案内します。」<br>
・水平スクロール可能なおすすめクイズリスト（画像、タイトル）を含める<br>
・画面下部に「トピック」「デイリークエスト」「プロフィール」に移動するためのアイコンを表示<br></p>
</li>
<li>
<p>トピック画面：<br>
・算数、代数、幾何学、三角法、微分積分など、数学のトピックの一覧を表示<br>
・画面上部にトピックを検索するための検索バーを含める<br>
　・難易度や学年に応じてトピックを絞り込むためのフィルターを追加する<br>
　・サブトピックやクイズにアクセスするため、各トピックを選択できるようにする<br></p>
</li>
<li>
<p>サブトピック画面：<br>
・選択したトピック内のサブトピックのリストを表示<br>
　・代数の例：線形方程式、二次方程式、多項式、連立方程式<br>
・クイズにアクセスするため、各トピックを選択できるようにする<br></p>
</li>
<li>
<p>クイズ画面：<br>
・選択式のクイズ問題とタイマー（該当する場合）を表示<br>
　・問題例：「次の方程式を解きなさい：2x + 3 = 11」<br>
　・多肢選択式解答：A) x = 4、B) x = 3、C) x = 2、D) x = 1<br>
・答えを送信、問題をスキップ、クイズを終了すためのボタンを含める<br>
　・ボタンテキスト：「送信」「スキップ」「終了」<br>
・クイズを終えたら、結果とともに正解、解説、獲得ポイントを表示<br>
　・テキスト例：「おめでとうございます！80ポイント獲得しました。以下の正解と解説を確認してください。」<br></p>
</li>
<li>
<p>デイリークエスト画面：<br>
・利用可能なデイリークエストとそれぞれのリワード（ポイント、バッジ）を表示<br>
　・クエスト例：「幾何学クイズを5問答えて50ポイントと幾何学マスターバッジを獲得しよう。」<br>
・プログレスバーで各クエストのステータス（実施済みかどうか）を表示<br>
　・テキスト例：進捗：5問中3問完了）<br>
・クエストの開始ボタンを含める<br>
　・ボタンテキスト：「クエスト開始」<br></p>
</li>
</ol><p>このスクリプトをもとに、MathWizアプリのフローとデザインを効果的に紹介するFigmaプロトタイプを作成することができます。それにより、ステークホルダーはユーザーエクスペリエンスを視覚化し、アプリの機能と外観についてフィードバックすることができます。</p></div></div>
</details>
<h2>テキストコンテンツの生成</h2>
<p>AIは、製品のランディングページやその他の部分に表示するさまざまなテキストを効率的に生成することができ、便利です。自動化により作業効率を向上させ、テキスト作成に要する時間を削減することができます。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-ncj3a0m.jpeg">
<em>テキストコンテンツの生成</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>MathWizアプリのランディングページ用のコピー文を作成してください。</p><p><strong>MathWiz – 楽しいクイズとチャレンジ問題で数学をマスターしよう</strong></p><p>思わず引き込まれてしまうクイズや、わくわくするチャレンジ問題を通じて、数学を学ぶ楽しさを発見してください。MathWizは、自分のペースで数学をマスターできる究極のアプリです。退屈な数学のレッスンにおさらばして、自分のレベルや目標に合わせた学習体験を始めましょう。</p><p><strong>特長：</strong></p><p>幅広いトピック</p><p>算数から代数、幾何学、微分積分に至るまで、MathWizは包括的なトピックとサブトピックを提供しており、年齢や能力を問わずあらゆる学習者にご利用いただけます。</p><p>アダプティブラーニング</p><p>独自のスマートアルゴリズムにより、ユーザーの成績に応じてクイズの難易度を調整し、真に個別化された学習体験を提供します。適度に難しい問題なので、圧倒されることもなく興味が続きます。</p><p>ゲーミフィケーションとリワード</p><p>クイズやデイリークエストをこなしてポイントを獲得し、バッジを解放し、リーダーボードの上位ランクインを目指しましょう。フレンドと競い合ったり、学習プロセスの新しいマイルストーン到達を目指して頑張りましょう。</p><p>パフォーマンスの追跡</p><p>自分の強みや改善が必要な部分、トピックごとの成績などを示した視覚的に魅力的なチャートや分析結果で、進捗を把握しましょう。</p><p>共同学習</p><p>インタラクティブな学習コミュニティを通じてフレンドとつながり、クイズやチャレンジ問題を送り、数学の問題について話し合い、成果を共有しましょう。</p><p>アクセシビリティと優れた操作性</p><p>iOS向けに開発されたMathWizは、直感的なインターフェース、カスタマイズ可能なアバター、そして誰もが楽しくシームレスな学習体験を味わうことを可能にするさまざまなアクセシビリティ機能を提供します。</p><p><strong>MathWizで内に秘めた数学のポテンシャルを解き放とう</strong></p><p>楽しさ満載の数学アドベンチャーに出発する用意はいいですか？今すぐMathWizをダウンロードして、やりがいを感じながら楽しく学べるクイズやチャレンジ問題を通じて数学をマスターしましょう。</p><p><strong>［App Storeでダウンロードボタン］</strong></p><p>［ユーザーの声をカルーセルで表示—満足したユーザーのコメントを表示し、アプリのメリットと有効性を強調する］</p><p>［フッター—SNS、プライバシーポリシー、利用規約、サポート／問い合わせ窓口情報を含める］</p></div></div>
</details>
<h2>デザインシステムのドキュメント作成の加速</h2>
<p>ChatGPTは、コンポーネントやその使用方法の説明を自動的に生成してくれるため、デザインシステムのドキュメント作成プロセスを容易にします。そのため、デザイナーはプロジェクトの重要な部分に注力でき、ドキュメントの一貫性や分かりやすさを確保することができます。</p>
<p>では、例としてAIが作成したカラーパレットの詳細な説明を見てみましょう。カラーパレットの説明にはデザイントークンも含まれ、その他にタイプスケールも作成してみました。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-m3k3aas.jpeg">
<em>カラーパレットの制作</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>先ほど提供した色情報を使用して、デザインシステムのカラーパレットを作成してください。名前、16進コード、デザイントークン名、色の使用目的を含め、表にまとめてください。</p><table>
<thead>
<tr>
<th>名前</th>
<th>16進コード</th>
<th>デザイントークン</th>
<th>使用目的</th>
</tr>
</thead>
<tbody>
<tr>
<td>ディープブルー</td>
<td>#274472</td>
<td>--color-brand</td>
<td>アプリのロゴ<br>ヘッダー<br>ナビゲーションの主要要素</td>
</tr>
<tr>
<td>ライトブルー</td>
<td>#4B8BBE</td>
<td>--color-primary-1</td>
<td>背景<br>ボタン<br>インタラクティブ要素</td>
</tr>
<tr>
<td>ティール</td>
<td>#009688</td>
<td>--color-primary-2</td>
<td>アクセント<br>CTAボタン<br>重要な情報</td>
</tr>
<tr>
<td>ソフトイエロー</td>
<td>#FFEB3B</td>
<td>--color-secondary-1</td>
<td>進捗インジケータ<br>バッジ<br>リワード</td>
</tr>
<tr>
<td>ライトグレー</td>
<td>#F5F5F5</td>
<td>--color-secondary-2</td>
<td>背景<br>コントラスト効果（強烈すぎず、注意をそらさない）</td>
</tr>
<tr>
<td>ダークグレー</td>
<td>#616161</td>
<td>--color-secondary-3</td>
<td>テキストとアイコン<br>クリーンでモダンな外観を保ちつつ可読性を確保</td>
</tr>
<tr>
<td>セカンダリーテキスト</td>
<td>#757575</td>
<td>--color-text-2</td>
<td>セカンダリーテキスト要素（キャプション、ラベル、重要性の低い情報など）</td>
</tr>
<tr>
<td>エラー</td>
<td>#D32F2F</td>
<td>--color-error</td>
<td>エラーメッセージ<br>アラート<br>問題やトラブルを知らせる通知</td>
</tr>
<tr>
<td>グレー1</td>
<td>#E0E0E0</td>
<td>--color-gray-1</td>
<td>淡い背景<br>境界線<br>セパレーター</td>
</tr>
<tr>
<td>グレー2</td>
<td>#BDBDBD</td>
<td>--color-gray-2</td>
<td>無効化された要素<br>無効なボタン<br>入力</td>
</tr>
<tr>
<td>グレー3</td>
<td>#9E9E9E</td>
<td>--color-gray-3</td>
<td>プレースホルダーテキスト<br>優先度の低い情報</td>
</tr>
</tbody>
</table><p>この表は、MathWizアプリのデザインシステム用のカラーパレットを表し、各色の名前、16進コード、デザイントークン名、使用目的を含みます。このような形で整理することで、アプリのビジュアルデザインを通して一貫性を保ち、デザイナーや開発者が適切な色を参照して適用しやすくなるでしょう。</p></div></div>
</details>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-axl3a6a.jpeg">
<em>デザインシステムの作成</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>iOS向けのアプリであることを踏まえ、MathWizデザインシステム用のタイプスケールを作成してください。</p><p>タイプスケールとは、フォントサイズ、フォントの太さ、行の高さを整理したものであり、デザインシステムにおいてタイポグラフィの視覚的階層を生み出します。以下はMathWizアプリのデザインシステム用のタイプスケールで、iOSのモバイルアプリ向けに作成されています。</p><table>
<thead>
<tr>
<th>レベル</th>
<th>フォントサイズ</th>
<th>行の高さ</th>
<th>フォントの太さ</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>ディスプレイ</td>
<td>32</td>
<td>40</td>
<td>ボールド</td>
<td>アプリのタイトル<br>オンボーディング画面の大見出し<br>特別プロモーション</td>
</tr>
<tr>
<td>見出し</td>
<td>28</td>
<td>36</td>
<td>ボールド</td>
<td>セクション見出し<br>ダッシュボードタイル</td>
</tr>
<tr>
<td>サブ見出し</td>
<td>24</td>
<td>32</td>
<td>セミボールド</td>
<td>サブセクション見出し<br>CTAボタン<br>クイズタイトル</td>
</tr>
<tr>
<td>本文</td>
<td>20</td>
<td>28</td>
<td>レギュラー</td>
<td>本文<br>クイズ問題<br>リスト項目<br>ラベル</td>
</tr>
<tr>
<td>キャプション</td>
<td>18</td>
<td>24</td>
<td>レギュラー</td>
<td>本文のセカンダリーテキスト<br>キャプション<br>ツールチップ</td>
</tr>
<tr>
<td>ラベル</td>
<td>16</td>
<td>22</td>
<td>レギュラー</td>
<td>小ラベル<br>入力欄<br>ナビゲーション項目</td>
</tr>
<tr>
<td>細字</td>
<td>14</td>
<td>20</td>
<td>レギュラー</td>
<td>細字<br>利用規約<br>プライバシーポリシー</td>
</tr>
</tbody>
</table><p>注：フォントサイズは、画面サイズや解像度が異なる場合でもアクセシビリティと一貫したユーザーエクスペリエンスを確保するため、sp（スケール非依存ピクセル）で指定します。</p><p>MathWizアプリデザインシステムでこのタイプスケールを使用することにより、一貫性のあるタイポグラフィ階層を維持し、可読性を高めるとともに、視覚的に魅力的なユーザーエクスペリエンスを創出することができます。前に提案したフォントペア（見出しはRoboto、本文はOpen Sans、など）を使用することで、アプリのデザインをより一層高めましょう。</p></div></div>
</details>
<h2>UXタスクの自動化</h2>
<p>ChatGPTを使用することで、ユーザー手順の分析やペルソナの特定、詳細な情報アーキテクチャの構築といったUX関連の複雑な作業を自動化できます。AIが詳細なデータ分析を行ってくれるので、よりインテリジェントで効果的なソリューションを作成できます。</p>
<p>例として、MathWizアプリのユーザーペルソナをいくつか作成したので見てみましょう。</p>
<p><img src="https://hackernoon.imgix.net/images/Hj6zDcAXL9SsFN0sThCgcr0SQva2-1zm3aip.jpeg">
<em>ユーザーペルソナ</em></p>
<details>
<summary><strong>画像内テキストの翻訳</strong></summary>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>UXペルソナとは、ユーザーベースを代表するユーザーに関する情報や知見を集約したものであり、主要なタイプと考えられるユーザー像（メインペルソナ）です。必要に応じて他にもいくつかのペルソナを作成します。MathWizアプリ用にUXペルソナを3つ生成してください。</p><p>ペルソナ1：<strong>メインペルソナ</strong></p><p><strong>名前</strong>：ソフィア<br>
<strong>年齢</strong>：14歳<br>
<strong>職業</strong>：生徒<br>
<strong>場所</strong>：米国ニューヨーク州<br>
<strong>略歴</strong>：ソフィアは勉強が大好きな高校生で、クラスでも良い成績を収めています。特に数学が好きで、数学コンテストに好んで参加しています。暇があればスマホでパズルゲームをして遊んでいます。<br></p><p><strong>目標</strong>：</p><ol>
<li>数学の力をつけて、数学コンテストで優位に立つ。</li>
<li>数学の練習問題を解ける、楽しくて夢中になれるアプリを見つける。</li>
<li>進捗を確認し、改善できる部分を見つける。</li>
</ol><p><strong>ペインポイント</strong>：</p><ol>
<li>彼女のレベルに合った難しい数学問題があまりない。</li>
<li>従来の数学の勉強方法ではモチベーションを保てない。</li>
<li>学校の勉強と課外活動、自由時間のバランスがをうまくとれない。</li>
</ol><p>ペルソナ2：<strong>セカンダリーペルソナ</strong></p><p><strong>名前</strong>：イーサン<br>
<strong>年齢</strong>：35歳<br>
<strong>職業</strong>：エンジニア<br>
<strong>場所</strong>：米国テキサス州オースティン<br>
<strong>略歴</strong>：イーサンは土木技師で、仕事で頻繁に数学を使用します。大学時代に比べて自分の数学の知識が少しサビついてきていると感じており、手軽に知識をリフレッシュして能力を維持できる方法を探しています。<br></p><p><strong>目標</strong>：</p><ol>
<li>数学の練習問題を定期的に解き、スキルの維持・向上を図る。</li>
<li>今の自分のレベルに合った、個別化された学習体験を提供するアプリを見つける</li>
<li>仕事の休憩時間や通勤時間にアプリを使う。</li>
</ol><p><strong>ペインポイント</strong>：</p><ol>
<li>数学のスキル向上に費やせる時間が限られている。</li>
<li>幅広い数学のトピックに対応したプラットフォームがなかなか見つからない。</li>
<li>柔軟なスケジュールで学べるアプリが必要。</li>
</ol><p>ペルソナ3：<strong>セカンダリーペルソナ</strong></p><p><strong>名前</strong>：グレイス<br>
<strong>年齢</strong>：27歳<br>
<strong>職業</strong>：小学校教師<br>
<strong>場所</strong>：米国カリフォルニア州ロサンゼルス<br>
<strong>略歴</strong>：グレイスは小学校の教師であり、生徒が算数の知識を身につける手助けをしたいと思っています。生徒や保護者に勧められる面白い教育アプリを常に探しています。<br></p><p><strong>目標</strong>：</p><ol>
<li>面白くて勉強になる、生徒に適した算数（数学）アプリを見つける。</li>
<li>生徒たちに学校以外の時間でも算数の練習をするよう促す。</li>
<li>生徒の進捗を確認し、アプリの有効性を評価する。</li>
</ol><p><strong>ペインポイント</strong>：</p><ol>
<li>さまざまなレベルに対応できて、年齢的にも相応しい算数（数学）アプリが見つからない。</li>
<li>生徒に安全でフレンドリーな環境を提供するアプリが必要。</li>
<li>生徒が飽きないよう、学びと楽しさのバランスが取れたアプリが必要。</li>
</ol></div></div>
</details>
<h2>ユーザー調査の実施</h2>
<p>ChatGPTはユーザーからのフィードバックを自動的に分析し、重要な問題やトレンドを示し、製品のさまざまな側面についての分かりやすさや有効性についてレポートを生成することができます。デザイナーはユーザーのニーズにより素早く対応し、製品に適切な変更を加えることができます。</p>
<h2>効果的なコミュニケーションの確保</h2>
<p>ChatGPTは、技術用語や複雑な概念を分かりやすく説明することで、デザイナーや開発者、その他のチームメンバーがコミュニケーションを取りやすくしてくれます。チーム全員がプロジェクトの目標や要件を理解し、連携を深め、より短時間で成果を出せるよう手助けしてくれます。</p>
<h2>ChatGPTを使って他にできること</h2>
<ul>
<li>ユーザーストーリー、シナリオ、ユーザージャーニーマップ、ユーザーフローの作成</li>
<li>デザインやテキストのABテストの選択肢作成</li>
<li>デザインスプリントの計画</li>
<li>ポートフォリオ用の独自ケース作成</li>
<li>記事や投稿、その他デザイン関連作業のアイデア出し</li>
<li>専門能力の開発</li>
<li>続く</li>
</ul>
<h2>結論の代わりに</h2>
<p>条件付きのMathWizアプリの例を用いて、UI/UXデザイナーやプロダクトデザイナーが仕事でChatGPTを使用する具体的な方法を説明しましたが、ご自身の仕事にも適用可能な有益な情報はありましたでしょうか。</p>
<p>最後に、ネット上で最も頻繁にされている質問の1つについて考えてみたいと思います。</p>
<p><strong>AIがデザイナーに取って代わり、その仕事を奪う日は来るのでしょうか？</strong></p>
<p>ドラムロール…
AIが近い将来デザインの仕事を完全に置き換える可能性は極めて低いと思います（ただし、反復作業や自動化できる作業は除きます）。なぜでしょうか。それは、あらゆるビジネスは個別化されたケースであり、ユーザーグループやその他さまざまな要素についても同じことが言えるからです。デザインは、視覚対象物の創出にとどまらず、共感性や創造性、人間中心のアプローチによる問題解決なども関わる仕事です。これらのスキルは、AIが容易に再現できるものではありません。</p>
<p>したがって、ChatGPTはAIのパーソナルアシスタントと見なすことができるでしょう。そのようなものであれば、誰もが欲しいと思うのではないでしょうか。現にこのようなツールがすでに存在するので、使い方を学ぼうではありませんか。</p>
<p>それでは最後のコメントです。<strong>AIがデザイナーに取って代わることはないでしょう。しかし、AIを利用しなければ、AIを使うデザイナーに淘汰されるかもしれません</strong>。</p>]]></content:encoded></item><item><title><![CDATA[テストピラミッド万歳]]></title><description><![CDATA[クイックサマリー：「テストピラミッド」は、自動テストをUI、サービス、ユニット単位に整理することで、開発に自動テストを組み込む方法を示すために作成されました。2012年に定義されて以降、このモデルは…]]></description><link>https://postd.cc/long-live-test-pyramid/</link><guid isPermaLink="false">https://postd.cc/long-live-test-pyramid/</guid><category><![CDATA[開発手法・プロジェクト管理]]></category><category><![CDATA[テスト]]></category><category><![CDATA[テストツール]]></category><pubDate>Wed, 28 Feb 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p><strong>クイックサマリー</strong>：<a href="https://martinfowler.com/bliki/TestPyramid.html">「テストピラミッド」</a>は、自動テストをUI、サービス、ユニット単位に整理することで、開発に自動テストを組み込む方法を示すために作成されました。2012年に定義されて以降、このモデルは次第に使われなくなってきたように思いますが、本当に廃れてしまったのでしょうか。この記事では、最新のテスト戦略を紹介するとともに、今日のソフトウェア開発におけるテストピラミッドの関連性を検討します。</p>
<hr>
<p>筆者の同僚である<a href="http://www.jpietrzyk.de/">ジャン・フィリップ・ピエトルチェク</a>が、かつてコードを書く開発者の責任について、次のように述べました。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>「我々の仕事の成果を最終的に使用する人々は、（中略）我々がただ最善を尽くすだけでなく、実際に機能するものを作ることを期待しているのです。」</p><p>— ジャン・フィリップ・ピエトルチェク</p></div></div>
<p>彼の言葉は、私たちが書くコードをそれに依存する人々の観点からとらえている点で非常に印象に残りました。目まぐるしく変化するこの世界では、ユーザーは私たちが可能な限り最高のコードを記述し、開発したソフトウェアが実際に機能することを期待しています。このレベルの期待に応えるのは当然容易ではなく、だからこそ、開発スタックにおいてはテストが重要な要素になるのです。テストでは、仕事の質を評価し、さまざまなシナリオに照らして検証を行うことで、顕在化する前に問題を特定します。</p>
<p>テストピラミッドは数あるテスト戦略の内の一つです。2012年に紹介されて以降、おそらく10年近くは主要なテストモデルとして利用されてきましたが、最近は以前ほど参照されなくなっています。テストピラミッドは今でも定番のテスト手法なのでしょうか。それとも、他の手法も多数台頭してきている中、昨今の開発事情により適した最新のモデルの影に隠れ、埋もれてしまっているのでしょうか。</p>
<p>この記事ではその点を探っていきたいと思います。</p>
<h2>テスト戦略の目的 <a href="#テスト戦略の目的">#</a><a name="テスト戦略の目的"></a></h2>
<p>ユーザーの信頼を得るためには、書いたコードによって製品がユーザーの期待どおり確実に機能するよう、強固なテスト戦略が求められます。優れたテストコードを書くためには、まず何から始めればよいのでしょうか。テストコードはいくつ必要でしょうか。これまで多くの人がこれらの問いへの答えを見つけようと取り組んできました。しかし、求めていた気づきを私に与えてくれたのは、ケント・C・ドッズの次の一言でした。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><p>「最大の問題は、何をテストするのかということと、実装に関する詳細をテストすることで得られる偽りの自信ではなく、真の自信が得られるような方法でテストを行うにはどうすればよいかを見極めることです。」</p><p>— ケント・C・ドッズ</p></div></div>
<p>これが出発点です。<strong>テストの目標を決めることが、テスト戦略を策定する上で最も重要な作業になります</strong>。ネット上には誤った判断を揶揄したミームが溢れていますが、そうした判断の多くは、単にテストの目的や、いくつテストを行えば確信が得られるのかが不明であったことに起因します。テストには、コードを適切に検証し、コードが期待どおり機能することを確認するための「最適な比率」があります。</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">2 unit tests. 0 integration tests. <a href="https://t.co/K2MZKwr8JT">pic.twitter.com/K2MZKwr8JT</a></p>&mdash; DEV Community (@ThePracticalDev) <a href="https://twitter.com/ThePracticalDev/status/892788721350836225?ref_src=twsrc%5Etfw">August 2, 2017</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><em>2つの単体テスト統合テストなし</em></p>
<p>問題は、さまざまなユニットを結合してどう連動させるのかについての戦略を持たず、1種類のテスト（多くの場合は単体テスト）にのみ重点を置く開発者が多いことです。例えば、洗面台のテストを行う際、蛇口と排水口を別々にテストしても、両者が正常に連動するのかは分かりません。単体テストでは蛇口が問題なく機能していても、排水口が詰まっているにも関わらず蛇口から水が流れ続ければ、洗面台として正常に機能しているとは言えません。</p>
<p>テスト手法について説明する際、ピラミッドモデルの例のようにしばしば「形」が用いられます。この記事では、筆者が見てきた形をいくつか紹介し、それぞれの形を実際のテストに当てはめるとどうなのか、結論としてどのテスト戦略が、筆者の考える今日の開発に適した包括的テストの基準を満たすのかを考察したいと思います。</p>
<h2>基本に戻る <a href="#基本に戻る">#</a><a name="基本に戻る"></a></h2>
<p>その前に、各種テストの一般的な定義をおさらいしましょう。</p>
<h3>手動テスト</h3>
<ul>
<li>人の手によって行われるテストです。実際のユーザーがユースケースに従ってアプリ内をクリックして回り、場合によってはユースケースに記述されていない方法で予期しないシナリオでのアプリの動作を検証します。多くの場合、このテストは製品チームが観察する中、ユーザーとのリアルタイムでの対面もしくはリモートインタビューの形式で行われます。</li>
</ul>
<h3>単体テスト</h3>
<ul>
<li>このタイプのテストでは、アプリを「ユニット」と呼ばれるテスト可能で独立した小さな構成要素に分け、各ユニットを個別にテストし、正常に動作することを確認します。</li>
</ul>
<h3>統合テスト</h3>
<ul>
<li>コンポーネントまたはシステム間の連携に重点を置いたテストです。各ユニットを組み合わせてテストし、統合された状態で全体として正常に機能することを確認します。</li>
</ul>
<h3>E2E（エンドツーエンド）テスト</h3>
<ul>
<li>このタイプのテストでは、コンピューターが実際のユーザーとのやり取りをシミュレーションします。一定の手順に従うことが求められる作業をユーザーが完遂できるのか、期待する結果が得られるのかなど、ユーザーの視点に立って検証を行うためのテストと考えてください。インプットに対して適切なアウトプットが得られるのか確認することで、ユーザー体験全体を検証します。</li>
</ul>
<p>では、これらのテストをどう組み合わせればよいでしょうか。従来アプリケーションを問わず定番として用いられてきたのが、各テストを包括的なテストスイートとしてまとめたテストピラミッドです。</p>
<h2>偉大なるテストピラミッド万歳 <a href="#偉大なるテストピラミッド万歳">#</a><a name="偉大なるテストピラミッド万歳"></a></h2>
<p>マイク・コーンが著書<a href="https://www.mountaingoatsoftware.com/books/succeeding-with-agile-software-development-using-scrum">『Succeeding with Agile』</a>で最初に紹介し、マーチン・ファウラーが<a href="https://martinfowler.com/articles/practical-test-pyramid.html">「実用的なテストピラミッド」</a>という記事でさらに発展させたテストピラミッドは、パフォーマンスとコストに基づいてテストを優先順位付けしています。異なる粒度のテストを記述し、高位レベルのテストは少なく、素早く安価で実施できる信頼性の高い単体テストは多くするよう推奨しています。テストの順序としては、素早く低コストで実施できるものから、時間とコストのかかるものの順に行うよう推奨しています。ピラミッドの最下部には多くの単体テストが位置し、次にサービス（統合テスト）が真ん中に来ます。そして最上部に、E2Eテストを含むより具体的で少数のUIテストが位置します。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://files.smashing.media/articles/long-live-test-pyramid/test-pyramid.jpg">
<em>3層に分かれたピラミッドの手書きイラスト</em>（<a href="https://www.smashingmagazine.com/2023/09/long-live-test-pyramid/#:~:text=into%20three%20tiers.%20(-,Large%20preview,-)">拡大プレビュー</a>）</p>
<p>関係者の間では、テストピラミッドはテスト構造のあるべき姿を単純化しすぎているとの声が高まっています。約10年前にテストピラミッドについての記事を執筆したマーチン・ファウラーは、<a href="https://martinfowler.com/articles/2021-test-shapes.html">この問題について最近ブログ記事を書いています</a>。筆者のチームでは、このモデルは私たちの仕事をエンドユーザーに近づけるものなのか、それとも遠ざけるものなのかという問いも出ています。ピラミッドの高位層は単体テストの信頼性を高め、より優れた価値をもたらしますが、各構成要素がどう連動するのかという大局的な視点に欠けるように思われます。少なくとも私たちには、テストピラミッドが時代遅れになりつつあるように感じられました。</p>
<h2>ピラミッドからダイヤモンドへ <a href="#ピラミッドからダイヤモンドへ">#</a><a name="ピラミッドからダイヤモンドへ"></a></h2>
<p>筆者のチーム内で議論された論点の1つが、ピラミッドが<strong>単体テストに重点を置きすぎている</strong>ということです。ピラミッドは、単体テストの性質と対象範囲を説明する形としては非常に優れています。しかし、単体テストとは何かと4人に問えば、おそらく4通りの回答が返ってくるでしょう。明確化のため、ピラミッドの形を少し変える必要があるかもしれません。</p>
<p>筆者のチームが最も明確化する必要があったのは、単体テストを「いつ」「どこで」で止めるかということです。ピラミッドの形は、単体テストがテストプロセスの大部分を占めることを示唆しますが、私たちはそれが間違っているように感じました。結局のところ、単体テストをまとめるのは統合テストなので。</p>
<p>したがって、テスト戦略を表すピラミッドの見方を変えてみると、ダイヤモンドの形に変化します。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://files.smashing.media/articles/long-live-test-pyramid/testing-diamond-illustration.png">
<em>4層に分かれたピラミッドの手書きイラスト</em>（<a href="https://www.smashingmagazine.com/2023/09/long-live-test-pyramid/#:~:text=pyramid%20split%20into%20four%20tiers.%20(-,Large%20preview,-)">拡大プレビュー</a>）</p>
<p>統合テストは、単体テストには複雑すぎる場合があるため、テストピラミッドの「忘れられた層」と呼ばれることがあります。しかし、テストダイヤモンド（しばしば2つの特定の層に分けられる）ではより重視されます。</p>
<ol>
<li>
<p><strong>統合テスト層</strong>
この層は、テストピラミッドの場合とほぼ同じですが、「単体テストとして行うには規模が大きすぎる」と見なされるテストが割り当てられます。つまり、単体テストの層と統合テストの層の中間に位置します。この層には、特定のコンポーネントなどのテストが適しています。</p>
</li>
<li>
<p><strong>システム統合テスト層</strong>
この層は、APIから取得したデータなどの「実際の」統合テストを中心に扱います。</p>
</li>
</ol>
<p>したがって、ダイヤモンドの形は統合テストを行った直後に単体テストを行うプロセスを示唆しますが、それらの単体テストはピラミッドモデルの場合ほど重視されません。そのため、単体テストが重視されなくなった分、統合テスト層に相応の予算が割り当てられます。</p>
<h2>手動テストの位置付けは？ <a href="#自動テストの位置づけは？">#</a><a name="自動テストの位置づけは？"></a></h2>
<p>テスト戦略が「ピラミッド型」であれ「ダイヤモンド型」であれ、重要な手動テストが依然としてプロセスに欠けています。自動テストは確かに重要ですが、手動テストが不要になるほどではありません。</p>
<p>自動テストと手動テストは互いに欠かせないものだと思います。自動テストは定型的な共通作業を不要にし、人間がより注力すべき部分にテスターが集中できるようにする必要があります。自動化は手動テストを置き換えるのではなく、補完すべきなのです。</p>
<p>この点を加味した場合、ダイヤモンドやピラミッドの形はどうなるでしょうか。手動テストはどの層にも含まれていませんが、どこかに入れるべきです。自動テストは効率的にバグを検出してくれますが、より包括的なテストを行うためには手動テストが必要です。とは言え、主に自動テストに重点を置いたテスト戦略が理想的であるのも事実です。</p>
<p>これをテスト戦略の形に当てはめると、ピラミッドやダイヤモンドというよりアイスクリームコーンのような形になります。</p>
<p><img src="https://files.smashing.media/articles/long-live-test-pyramid/testing-ice-cream-cone.png">
<em>4層に分かれた、アイスクリームコーンに似た逆ピラミッドの手書きイラスト</em>（<a href="https://files.smashing.media/articles/long-live-test-pyramid/testing-ice-cream-cone.png">拡大プレビュー</a>）</p>
<p>これは実際に「アイスクリームコーン」と呼ばれる手法です。実装までの時間は長くかかりますが、より確かな自信が得られ、より多くのバグを検出できます。2015年に発表された記事で、<a href="https://saeedgatson.com/the-software-testing-ice-cream-cone/">サイード・ガトソンが簡潔に説明しています</a>。</p>
<p>しかし、ピザのような形で実際にテストの内容を説明しきれるのでしょうか。この概念はグレブ・バームトフによって突き詰められ、彼が<a href="https://changelog.com/posts/the-testing-pyramid-should-look-more-like-a-crab">「Testing crab（蟹）」</a>モデルと呼ぶ形に集約されました。この手法では、スクリーンショットを比較し、人間が差異を検証します。目視テストと機能テストは蟹の胴体部分を構成し、その他のテストは蟹の手足を構成します。テストの際に実装前と実装後のスナップショットを撮影できるツールがあり、撮影したスナップショットを重ね合わせることで、視覚的なリグレッションを確認できます。</p>
<h2>テストトロフィー <a href="#テストトロフィー">#</a><a name="テストトロフィー"></a></h2>
<p>どのテスト手法もコストがかさみますが、テストピラミッドはその点を適切に表しています。ただ、その形自体が現実的ではないか、テストの内容全体と、各テスト層に置かれた重点を考慮するのに効果的ではない可能性があります。したがって、各テスト層と、それぞれどの程度重視すべきかを正確に表した<strong>これらすべての手法の間に妥協点を見つける</strong>必要があります。</p>
<p>ギレルモ・ローチが2016年にこの点を簡潔に表現した次の言葉を筆者は気に入っています。</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Write tests. Not too many. Mostly integration.</p>&mdash; Guillermo Rauch (@rauchg) <a href="https://twitter.com/rauchg/status/807626710350839808?ref_src=twsrc%5Etfw">December 10, 2016</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><em>テストを書こう。ただし書きすぎないこと。主に統合テスト。</em></p>
<p>少し掘り下げてみましょう。</p>
<ul>
<li><strong>テストを書こう</strong>
信頼を築くためだけではなく、メンテナンス時間を節約できるため。</li>
</ul>
<ul>
<li><strong>書きすぎないこと</strong>
100%の網羅率は、聞こえは良いですが必ずしも得策ではありません。アプリの詳細をすべて漏れなくテストした場合、少なくとも一部のテストはエンドユーザー体験にとって重要ではなく、テストを実行することが目的化しており、維持コストが増えることを意味します。</li>
</ul>
<ul>
<li><strong>主に統合テスト</strong>
統合テストに重点が置かれています。合理的な実行時間を維持しつつ、高いレベルの確信が得られるため、最も事業価値のあるテストです。</li>
</ul>
<p>ケント・C・ドッズの記事を読んでいる人ならば、以下の概念をご存知かもしれません。彼が提唱する<a href="https://kentcdodds.com/blog/the-testing-trophy-and-testing-classifications">「テストトロフィー」</a>手法では、統合テストの優先度が従来のテストピラミッドよりも高く設定されており、ギレルモ・ローチの主張とも完全に一致しています。</p>
<p><img src="https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://files.smashing.media/articles/long-live-test-pyramid/testing-trophy-illustration.png">
<em>4つの層に分かれた薄い金色のトロフィーの手書きイラスト</em>（<a href="https://files.smashing.media/articles/long-live-test-pyramid/testing-trophy-illustration.png">拡大プレビュー</a>）</p>
<p>ケントは、包括的なテストが製品の成功において果たす重要な役割について説明しています。彼は、単体テストよりも、<strong>製品のコア機能と評価される挙動について理解を深められる統合テストの価値を重視</strong>しています。また、彼はモックアップテストの数を減らし、統合テストの数を増やすことを提案しています。テストトロフィーは、テストの粒度を従来とは少し異なる方法で表した比喩であり、テストを以下の種類に分類しています。</p>
<ol>
<li>
<p><strong>静的分析</strong>：これらのテストはデバッグの手順を実行することで、素早くタイプミスを特定します。</p>
</li>
<li>
<p><strong>単体テスト</strong>：テストトロフィーでは、テストピラミッドほど重視されません。</p>
</li>
<li>
<p><strong>統合テスト</strong>：テストトロフィーで最も重視されるテストです。</p>
</li>
<li>
<p><strong>ユーザーインタフェース（UI）</strong>：E2Eテストや目視テストを含み、テストピラミッドと同様にテストトロフィーでも重要な役割を担います。</p>
</li>
</ol>
<p>「テストトロフィー」はユーザーの視点を重視しており、費用対効果に優れています。では、テストトロフィーが最も推奨される手法なのでしょうか。テスト戦略としては最も理にかなっていますが、問題もあります。単体テストには依然として有益な利点がありますが、統合テストやE2Eテストには、ランタイムが長いことや信頼性が低いことなどの欠点があります。単体テストの利点は妥当であり、筆者は今でも好んで使用しています。</p>
<h2>テストピラミッドは古いのか？<a href="#テストピラミッドは古いのか？">#</a><a name="テストピラミッドは古いのか？"></a></h2>
<p>テストピラミッドは、ソフトウェア開発においてアプリケーションが正常に機能することを確認するのに役立つテストモデルとして、今でも人気があります。しかし、どんなモデルでもそうであるように、欠点もあります。最大の問題は、単体テストの定義を明確化しなくてはならないことです。</p>
<p>筆者のチームは、テストパイプラインでダイヤモンドの形に改良を加えたものを使用しました。その結果、完全に間違ってはおらず、単に不完全なだけであることが判明しました。特に各種テストの優先順位を決める上で、今でも貴重な知見を得ています。</p>
<p>ジャスティン・サールズがうまく言い表しているように、開発チームが教科書通りのテストパターンに従うことはほとんどありません。</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">People love debating what percentage of which type of tests to write, but it&#39;s a distraction. Nearly zero teams write expressive tests that establish clear boundaries, run quickly &amp; reliably, and only fail for useful reasons. Focus on that instead.<a href="https://t.co/xLceALKrWe">https://t.co/xLceALKrWe</a></p>&mdash; Justin Searls (@searls) <a href="https://twitter.com/searls/status/1393385209089990659?ref_src=twsrc%5Etfw">May 15, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><em>どのタイプのテストを何割書くかということについて盛んに議論されていますが、本質からずれていると思います。境界を明確に定め、素早く確実に実行され、失敗する際には必ず有益な理由がある表現豊かなテストを書いているチームはほとんどありません。重視すべきはそちらでしょう。</em></p>
<p><em>@MartinFowlerのテストピラミッドはもう古い。
統合テスト＞単体テストが新常識でしょう</em></p>
<p><em>フロントエンドでは、@rauchgと@kentcdoddsが提唱する「テストトロフィー」があります</em></p>
<p><em>バックエンドでは、@theburningmonkのコースで@SpotifyEngの「テストハニカム」が提唱されています</em></p>
<p>これは、筆者のチームの経験上でも言えることで、テストを切り分けたり定義したりするのは難しい場合が多いです。それは別に悪いことではありません。マーチン・ファウラーでさえ、異なるテストモデルがテストの対象範囲に対する見方にプラスの影響を与えていることを強調しています。</p>
<p>したがって、テストピラミッドが古いとは決して考えません。むしろ、今も昔と変わらず知っておくべきものだと思います。しかし、ポイントはテストモデルの「形」にこだわりすぎないことです。覚えておくべき最も重要なことは、<strong>テストは素早く確実に実行されるべきであり、実際に問題があるとき以外は失敗してはいけない</strong>ということです。単に網羅的なテストを目指すのではなく、ユーザーの役に立つことが重要です。最も重要な作業は、テストの設計段階でこれらの要素の優先順位を決めた際にすでに終えているのです。</p>
<h2>参考文献 <a href="#参考文献">#</a><a name="参考文献"></a></h2>
<ul>
<li>“<a href="https://martinfowler.com/articles/practical-test-pyramid.html">The Practical Test Pyramid</a>,” Ham Vocke</li>
<li>“<a href="https://martinfowler.com/articles/2021-test-shapes.html">On the Diverse And Fantastical Shapes of Testing,</a>” Martin Fowler</li>
<li>“<a href="https://changelog.com/posts/the-testing-pyramid-should-look-more-like-a-crab">The Testing Pyramid Should Look More Like A Crab,</a>” Gleb Bahmutov</li>
<li>“<a href="https://saeedgatson.com/the-software-testing-ice-cream-cone/">The Software Testing Ice Cream Cone,</a>” Saeed Gatson</li>
<li>“<a href="https://kentcdodds.com/blog/write-tests">Write tests. Not too many. Mostly integration,</a>” Kent C. Dodds</li>
<li>“<a href="https://kentcdodds.com/blog/the-testing-trophy-and-testing-classifications">The Testing Trophy and Testing Classifications,</a>” Kent C. Dodds</li>
<li>“<a href="https://kentcdodds.com/blog/static-vs-unit-vs-integration-vs-e2e-tests">Static vs Unit vs Integration vs E2E Testing for Frontend Apps,</a>” Kent C. Dodds</li>
</ul>]]></content:encoded></item><item><title><![CDATA[React Server Componentsを理解する]]></title><description><![CDATA[私も年を取ったと感じるのは、今年Reactが10年目を迎えたからです。 混乱していた開発コミュニティにReactが初めて紹介されてから10年、以来いくつもの進化を遂げてきました。Reactチームは、…]]></description><link>https://postd.cc/server-components/</link><guid isPermaLink="false">https://postd.cc/server-components/</guid><category><![CDATA[開発手法・プロジェクト管理]]></category><category><![CDATA[React]]></category><pubDate>Mon, 29 Jan 2024 00:00:01 GMT</pubDate><content:encoded><![CDATA[<p>私も年を取ったと感じるのは、今年Reactが10年目を迎えたからです。</p>
<p>混乱していた開発コミュニティにReactが初めて紹介されてから10年、以来いくつもの進化を遂げてきました。Reactチームは、急進的な改革ということに関しては躊躇しませんでした。問題に対して、より良い解決策が見つかれば、それを実行してきました。</p>
<p>数か月前、Reactチームは最新のパラダイム・シフトであるReact Server Componentsを発表しました。史上初めて、Reactコンポーネントがサーバーでのみ実行できるようになったのです。</p>
<p>このことに関連してオンライン上では、<em>きわめて大きな混乱</em>が起きています。それが何なのか、どのように機能するのか、利点は何か、そしてSSR（Server Side Rendering）などとどのように連携するのか、多くの人が多くの疑問を抱いています。</p>
<p>私はReact Server Componentsに関する数多くの実験を行ってきており、私自身が持っていた多くの疑問に対する回答を得てきました。正直に言うと、この技術に関して私は予想していたよりもはるかに興奮しています。<em>本当に素晴らしい技術です！</em></p>
<p>そこで今日の私の目標は、このことを分かりやすく解説し、React Server Componentsについて皆さんが持っている多くの疑問に答えることです。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>対象読者</h3><p>このチュートリアルは主として、すでにReactを使用していて、React Server Componentsに関心がある開発者の方々を対象として書かれています。Reactの専門家である必要はありませんが、Reactを使い始めたばかりの場合はだいぶ混乱するかもしれません。</p></div></div>
<h2>Server Side Renderingの簡単解説</h2>
<p>React Server Componentsを理解するうえで、SSRがどのように機能するかを理解することが役立ちます。すでにSSRについて理解している場合は、次の見出しに進んでください。
私が2015年にReactを使い始めたとき、ほとんどのReactセットアップでClient Side Rendering（CSR）戦略が用いられていました。ユーザーが受け取るのは次のようなHTMLファイルでした。</p>
<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/js/bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>この<code class="language-text">bundle.js</code>スクリプトには、Reactや他のサードパーティの依存関係、自分たちが作成したすべてのコードなど、アプリケーションをマウントして実行するために必要なものがすべて含まれています。</p>
<p>JSがダウンロードされて解析されると、Reactが動作し始め、アプリケーション全体のすべてのDOMノードを呼び出し、それを空の<code class="language-text">&lt;div id="root"></code>に格納します。</p>
<p>このアプローチの問題点は、すべての作業を実行するのに時間がかかることです。しかもその作業中、ユーザーは何も表示されていない白い画面を見つめ続けることになります。この問題は時間の経過につれて悪化する傾向があります。新しい機能がリリースされるたびに、JavaScriptバンドルに新たに多くのキロバイトが追加され、ユーザーが座って待つ時間が長くなっていきます。<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup></p>
<p>サーバー・サイド・レンダリングは、こうした状況を改善するために設計されました。空のHTMLファイルを送信する代わりに、サーバーはアプリケーションをレンダリングして実際のHTMLを生成します。ユーザーは完全に形成されたHTMLドキュメントを受け取ることになります。</p>
<p>双方向性の処理には、引き続きクライアント上でReactが動作することが必要なため、そのHTMLファイルには従来通り<code class="language-text">&lt;script></code>タグが含まれています。ただし、ブラウザ内で若干異なる動作をするようReactを構成します。最初からすべてのDOMノードを呼び出す代わりに、既存のHTMLを採用するのです。このプロセスは<em>ハイドレーション</em>と呼ばれています。</p>
<p>このことに関しては、ReactのコアチームメンバーであるDan Abramovによる次の説明が気に入っています。</p>
<blockquote>
<p><em>Hydration is like watering the “dry” HTML with the “water” of interactivity and event handlers.（ハイドレーションとは、「乾いた」HTMLに双方向性とイベント・ハンドラーの「水」を注ぐようなものである。）</em></p>
</blockquote>
<p>JSバンドルがダウンロードされると、Reactはアプリケーション全体を素早く実行して、UIの仮想スケッチを構築し、それを実際のDOMに「フィット」させ、イベント・ハンドラーをアタッチし、エフェクトを発火させるなどの機能を実行します。</p>
<p>それが、つまりSSRです。サーバーが最初のHTMLを生成するため、JSバンドルがダウンロードされ解析されている間、ユーザーは真っ白なページを見つめている必要がなくなります。次に、サーバー・サイドのReactが中断したところからクライアントサイドのReactが引き継ぎ、DOMを採用し、双方向性を散りばめます。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>包括的な用語</h3><p>サーバー・サイド・レンダリングについて話しをするとき、私たちは通常、次のようなフローを想像します。</p><ol>
<li>
<p>ユーザーが<em>myWebsite.com</em>にアクセスする。</p>
</li>
<li>
<p>Node.jsサーバーがリクエストを受け取り、すぐにReactアプリケーションをレンダリングして、HTMLを生成する。</p>
</li>
<li>
<p>その生成されたばかりのHTMLがクライアントに送信される。</p>
</li>
</ol><p>これはサーバー・サイド・レンダリングを実装することを可能にする<em>1つ</em>の方法ですが、これが唯一の方法ではありません。もう1つのオプションとして、<em>アプリケーションの構築時</em>にHTMLを生成する方法があります。</p><p>通常、Reactアプリケーションはコンパイルして、JSXをプレーンでなじみのあるJavaScriptに変換し、すべてのモジュールをバンドルする必要があります。同じプロセス中に、異なるルートのすべてでHTMLを全部「事前レンダリング」した場合はどうなるでしょうか？</p><p>これが一般に、「静的サイト生成（SSG）」として知られているものです。これはサーバー・サイド・レンダリングの派生型です。</p><p>私の考えでは、「サーバー・サイド・レンダリング」は、いくつかの異なるレンダリング戦略を含む包括的な用語です。これらのすべてには、1つの共通点があります。それは、最初のレンダリングが<code class="language-text">ReactDOMServer</code> APIを使用して、Node.jsなどのサーバーランタイムで行われることです。実際には、これが<em>いつ</em>発生するのか、オンデマンドなのかコンパイル時点なのかは問題になりません。いずれにせよ、それはサーバー・サイド・レンダリングなのです。</p></div></div>
<h2>前後に跳ねる</h2>
<p>Reactでのデータフェッチについてお話ししましょう。通常、ネットワーク経由で通信するアプリケーションには次の2種類があります。</p>
<ul>
<li>クライアント側のReactアプリ</li>
<li>サーバー側のREST API</li>
</ul>
<p>React QueryやSWR、Apolloなどを使用して、クライアントはバックエンドにネットワーク・リクエストを送信し、バックエンドはデータベースからデータを取得し、そのデータをネットワーク経由で送り返します。</p>
<p>そのフローは、グラフを使って可視化できます。</p>
<p><img src="/article-assets/server-components/server-components01.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>グラフに関する注記</h3><p>このブログ記事には、こうした「ネットワーク・リクエスト・グラフ」がいくつか含まれています。これらは、いくつかの異なるレンダリング戦略において、クライアント（ブラウザ）とサーバー（バックエンドAPI）の間でデータがどのように移動されるのかを可視化するためのものです。</p><p>下辺の数字は、仮想の時間単位を表しています。分でも秒でもありません。実際には、数値はさまざまな要因により、大きく変化します。このブログで取り上げているグラフは、概念の概要を理解することを目的としたもので、実際のデータをモデル化したものではありません。</p></div></div>
<p>この最初のグラフは、CSR戦略を使用したフローを表しています。始まりはクライアントによるHTMLファイルの受信です。このファイルにはコンテンツはありませんが、1つ以上の<code class="language-text">&lt;script></code>タグがあります。</p>
<p>JSがダウンロードされ、解析されると、Reactアプリが起動し、数多くのDOMノードが作成され、UIが構築されます。ただし、最初は実際のデータがないため、読み込み状態でシェル（ヘッダー、フッター、一般的なレイアウト）をレンダリングすることしかできません。</p>
<p>このようなパターンは、これまでにたくさん見たことがあるのではないでしょうか。たとえば、UberEatsではシェルのレンダリングから始まり、実際のレストランを表示するために必要なデータをフェッチします。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/images/server-components/ubereats-loading.mp4"></video></p>
<p>ネットワーク・リクエストが解決され、Reactが再レンダリングを実行し、読み込み中のUIが実際のコンテンツに置き換えられるまで、この読み込み状態が表示され続けます。</p>
<p><strong>別の構築方法を見てみましょう。</strong>次のグラフは、同じ一般的なデータ・フェッチ・パターンを維持していますが、CSRではなく<em>サーバー</em>・サイド・レンダリングを使用しています。</p>
<p><img src="/article-assets/server-components/server-components02.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p>この新しいフローでは、最初のレンダリングはサーバー上で実行されます。それは、ユーザーが受け取るのは完全には空でないHTMLファイルであることを意味します。</p>
<p>（白紙のページよりもシェルの方が優れているという意味で）これは進歩ですが、結局のところ、目立って大きな変化を引き起こすものではありません。ユーザーは読み込み画面を見るためにアプリにアクセスしているのではなく、コンテンツ（レストラン、ホテルのリスト、検索結果、メッセージなど）を見るためにアクセスしているのです。</p>
<p>ユーザー・エクスペリエンスの違いを真に理解するため、いくつかのWeb性能測定基準をグラフに追加してみることにしましょう。この2つのフローを交互に切り替えて、フラグに何が起こるかを注意して見ていてください。</p>
<p><img src="/article-assets/server-components/server-components03.png">
<img src="/article-assets/server-components/server-components04.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p>これらのフラグはそれぞれが、一般的に使用されているWeb性能測定基準を表します。以下がその説明です。</p>
<ul>
<li>
<p><strong>ファースト・ペイント</strong>—ユーザーは、何も映っていない真っ白な画面を見つめる必要がなくなります。全体的なレイアウトはレンダリングされましたが、コンテンツはまだ表示されません。FCP（First Contentful Paint）とも呼ばれています。</p>
</li>
<li>
<p><strong>ページ・インタラクティブ</strong>— Reactがダウンロードされ、アプリケーションがレンダリングされ、ハイドレーションが行われました。インタラクティブな要素は完全に応答するようになっています。TTI（Time To Interactive）とも呼ばれています。</p>
</li>
<li>
<p><strong>コンテンツ・ペイント</strong>—ページに、ユーザーが関心のあるコンテンツが含まれるようになっています。データベースからデータを取得し、UIにレンダリングしました。LCP（Largest Contentful Paint）とも呼ばれています。</p>
</li>
</ul>
<p>サーバー上で最初のレンダリングを行うことで、最初の「シェル」をより素早く描画することが可能になります。そのため、前に進んでいる感覚が得られ、読み込みエクスペリエンスが多少速く感じられるようになります。</p>
<p>また状況によっては、これは有意義な改善になります。たとえばユーザーが、ナビゲーション・リンクをクリックできるよう、ヘッダーが読み込まれるのを待っているだけということがあるでしょう。</p>
<p><strong>しかし、この流れは少々バカげていると思えませんか</strong>？SSRのグラフを見れば、リクエストがサーバー上で始まっていることは一目瞭然です。2つ目のラウンドトリップ・ネットワーク・リクエストを求める代わりに、<em>最初のリクエスト中</em>にデータベース作業を実行してみてはどうでしょうか。</p>
<p>つまり、<strong>次のようなことをしてみるのはどうでしょう</strong>ということです。</p>
<p><img src="/article-assets/server-components/server-components05.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p>クライアントとサーバーの間を行ったり来たりする代わりに、最初のリクエストの一部としてデータベース・クエリーを実行し、完全に構築されたUIをユーザーに直接送信します。</p>
<p>しかし、うーん、厳密にはどうすればいいのでしょう？</p>
<p>これが機能するためには、データベース・クエリーを実行するために、サーバー上で排他的に実行される大量のコードをReactに提供できなければなりません。しかし、Reactではそれを選択することができませんでした。サーバー・サイド・レンダリングの場合でも、コンポーネントのすべてがサーバーとクライアントの両方でレンダリングされることになります。</p>
<p><strong>エコシステムは、この問題に対する数多くの解決策を考え出しました</strong>。Next.jsやGatsbyなどのメタフレームワーク <sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> では、サーバー上でのみコードを実行する独自の方法を編み出しました。</p>
<p>たとえば、（従来の「Pages」ルーターを使用する）Next.jsを使用する場合は次のようになります。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> db <span class="token keyword">from</span> <span class="token string">'imaginary-db'</span><span class="token punctuation">;</span>
<span class="token comment">// This code only runs on the server:</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> link <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token string">'passw0rd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">'SELECT * FROM products'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// This code runs on the server + on the client</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Homepage</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Trending Products</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>description<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><strong>これを分析してみましょう</strong>。サーバーがリクエストを受け取ると、<code class="language-text">getServerSideProps</code>関数が呼び出されます。それが、propsオブジェクトを返します。これらのpropsはコンポーネントに取り込まれ、そのコンポーネントが最初にサーバー上でレンダリングされ、次にクライアント上でハイドレーションされます。</p>
<p>ここで、優れている点は、<code class="language-text">getServerSideProps</code>がクライアント上で再実行されないことです。実際、この関数はJavaScriptバンドルにも含まれません。</p>
<p>このアプローチは時代のはるか先をいくものでした。正直に言って、それは驚くほどすごいことでした。ただし、これにはいくつかの問題点があります。</p>
<ol>
<li>
<p>この戦略は、ツリーの最上位にあるコンポーネントに関して、ルート・レベルでしか機能しません。どんなコンポーネントでも行うことができるものではないのです。</p>
</li>
<li>
<p>各メタフレームワークには独自のアプローチがあります。Next.jsには1つのアプローチがあり、Gatsbyには別のアプローチがあり、Remixにはさらに別のアプローチがあります。これまでのところ、標準化されていません。</p>
</li>
<li>
<p>すべてのReactコンポーネントは、たとえ不要な場合でも、クライアント上で<em>常に</em>ハイドレーションを行います。</p>
</li>
</ol>
<p>何年もの間、Reactチームは正式な解決方法を考案するために、この問題に密かに取り組んできました。その解決策こそ、今<strong>React Server Components</strong>と呼ばれているものです。</p>
<h2>React Server Componentsの紹介</h2>
<p>高いレベルでは、<em>React Server Components</em>はまったく新しいパラダイムの名称です。その新しい世界では、<em>サーバー上で排他的に実行される</em>コンポーネントを作成できます。そのため、Reactコンポーネント内でデータベース・クエリーを直接記述することが可能になります！</p>
<p>次に、「サーバー・コンポーネント」の簡単な例を示します。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> db <span class="token keyword">from</span> <span class="token string">'imaginary-db'</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Homepage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> link <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token string">'passw0rd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> <span class="token string">'SELECT * FROM products'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Trending Products</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>description<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Homepage<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>長年Reactを使用してきた私には、最初このコードは<em>きわめて突飛なもの</em>に思えました。😅</p>
<p>「ちょっと待て！」と本能が叫びました。「関数コンポーネントは非同期になることはできないぞ！そして、そのようなレンダリングで直接副作用を発生させることは許されない！」</p>
<p><strong>キーとなるのは、次のことを理解することです</strong>。サーバー・コンポーネントが再レンダリングされることは決してありません。サーバー・コンポーネントはサーバー上で1回だけ実行され、UIを生成します。レンダリングされた値はクライアントに送信され、所定の場所にロックされます。Reactに関しては、この出力は変更不能であり、決して変わりません <sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup>。</p>
<p>つまり、ReactのAPIの<em>大部分</em>は、サーバー・コンポーネントと互換性がないことを意味します。たとえば、stateは変化する可能性がありますが、サーバー・コンポーネントは再レンダリングできないため、stateは使用できません。また、effectはクライアント上でレンダリング後にのみ実行され、サーバー・コンポーネントがクライアントに到達することはないため、effectを使用することはできません。</p>
<p>これはまた、ルールに関してもう少し柔軟性があることも意味しています。たとえば、従来のReactでは、レンダリングのたびに副作用が繰り返されることがないよう、<code class="language-text">useEffect</code>コールバックやイベント・ハンドラーなどの中に副作用を配置する必要がありました。しかし、コンポーネントが<em>1回</em>しか実行されないのであれば、そのことについて心配する必要はなくなります。</p>
<p>サーバー・コンポーネント自体は驚くほど単純ですが、「React Server Components」パラダイムは非常に複雑です。その理由は、通常の古いコンポーネントが<em>まだ残っていて</em>、それらを組み合わせる方法が非常に入り組んだものである可能性があるためです。</p>
<p>この新しいパラダイムでは、私たちがよく知っている「従来の」Reactコンポーネントは<em>クライアント・コンポーネント</em>（Client Component）と呼ばれています。率直に言って、私はこの名称が好きではありません。😅</p>
<p>「クライアント・コンポーネント」という名称は、これらのコンポーネントがクライアント上でのみレンダリングされるかのような意味に取れますが、実際にはそうではありません。クライアント・コンポーネントは<strong>クライアントとサーバーの<em>両方</em>でレンダリングできます</strong>。</p>
<p><img src="/article-assets/server-components/server-components06.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p>これらの用語は非常に分かりにくいので、次のように要約してみました。</p>
<ul>
<li>
<p><em>React Server Components</em>とは、この新しいパラダイムの名称です。</p>
</li>
<li>
<p>この新しいパラダイムでは、私たちがよく知っていて好んで使用してきた「標準」Reactコンポーネントが、<em>クライアント・コンポーネント</em>へと名称変更されました。古いものに新しい名前が付けられたのです。</p>
</li>
<li>
<p>この新しいパラダイムでは、<em>サーバー・コンポーネント</em>という新しいタイプのコンポーネントが導入されました。この新しいコンポーネントはサーバー上でのみレンダリングされます。サーバー・コンポーネントのコードは、JSバンドルに含まれていないため、ハイドレーションや再レンダリングが行われることはありません。</p>
</li>
</ul>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>React Server Components vs.サーバー・サイド・レンダリング</h3><p>もう1つ別の一般的な混乱を解消しましょう。React Server Componentsはサーバー・サイド・レンダリングに代わるものでは<em>ありません</em>。React Server Componentsを「SSRバージョン2.0」とは考えないでください。</p><p>代わりに、私はこれを完全に一致する2つのパズル・ピース、または互いに補完し合う2つのフレーバーだと考えたいのです。</p><p>依然、最初のHTMLの生成にはサーバー・サイド・レンダリングが必要です。React Server Componentsはその上に構築されるため、クライアント側のJavaScriptバンドルから特定のコンポーネントを除外し、それらのコンポーネントがサーバー上でのみ実行されるようにできます。</p><p>確かに、React Server Componentsは、サーバー・サイド・レンダリング<em>なし</em>に使うことは可能ですが、実際は両方を一緒に使用するとより良い結果が得られます。ReactチームがSSRを使用しない<a href="https://github.com/reactjs/server-components-demo">最小限のRSCデモ</a>を作成していますので、こちらでその例を見ることができます。</p></div></div>
<p>##互換性のある環境</p>
<p>したがって通常は、新しいReact機能が出てきた場合、Reactの依存関係を最新バージョンに更新することで、既存のプロジェクトでその機能を使い始めることが可能になります。迅速な<code class="language-text">npm install react@latest</code>によって、すぐに開始できます。</p>
<p>残念ながら、React Server Componentsはそのようには機能しません。</p>
<p>私が理解しているところでは、React Server Componentsは、バンドラーやサーバー、ルーターなど、Reactの外部にある多くのものと緊密に統合する必要があります。</p>
<p>この文を書いている時点で、React Server Componentsの使用を開始する方法は1つだけであり、それはNext.js 13.4以降で、最新の再設計された「App Router」を使用することです。</p>
<p>願わくは今後、より多くのReactベースのフレームワークに、React Server Componentsが組み込まれることを期待しています。Reactのコア機能が特定の1つのツールでしか利用できないことについては抵抗を感じます。Reactドキュメントには<a href="https://react.dev/learn/start-a-new-react-project#bleeding-edge-react-frameworks">「最先端のフレームワーク」セクション</a>があり、React Server Componentsをサポートするフレームワークがリストされています。新しいオプションが利用可能になったかどうかを確認するため、このページを時々チェックする予定です。</p>
<h2>クライアント・コンポーネントの指定</h2>
<p>この新しい「React Server Components」パラダイムでは、<strong>すべてのコンポーネントが、デフォルトで、サーバー・コンポーネントとみなされます</strong>。クライアント・コンポーネントについては、「オプトイン」する必要があります。</p>
<p>それを行うために、まったく新しい<em>ディレクティブ</em>を指定します。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      Current value: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>先頭の<code class="language-text">'use client'</code>ディレクティブは、このファイル内のコンポーネントがクライアント・コンポーネントであることや、クライアントで再レンダリングできるようJSバンドルに含める必要があることをReactに知らせます。</p>
<p>これは、作成しているコンポーネントのタイプを指定する方法として非常に奇妙に<em>見える</em>かもしれませんが、これには前例があります。それは、JavaScriptで「Strict Mode」を選択する<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">"use strict"</a>ディレクティブです。</p>
<p>サーバー・コンポーネントでは、<code class="language-text">'use server'</code>ディレクティブを指定しません。React Server Componentsパラダイムでは、コンポーネントは、デフォルトで、サーバー・コンポーネントとして扱われます。事実、<code class="language-text">'use server'</code>はサーバー・アクションに使用されますが、それはまったく異なる機能であり、このブログ記事の範囲を外れています。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>クライアント・コンポーネントにすべきコンポーネントはどれでしょうか？</h3><p>「特定のコンポーネントをサーバー・コンポーネントにするかクライアント・コンポーネントにするかをどのように決定すればよいのか？」と疑問に思われるかもしれません。</p><p>一般則としては、コンポーネントがサーバー・コンポーネントになれるのであれば、サーバー・コンポーネントにするべきです。サーバー・コンポーネントはよりシンプルであり、推測が容易になる傾向があります。パフォーマンス上の利点もあります。サーバー・コンポーネントはクライアント上では実行されないため、そのコードはJavaScriptバンドルに含まれません。React Server Componentsパラダイムの利点の1つは、<em>ページ・インタラクティブ</em>（TTI）メトリックを改善できる可能性があることです。</p><p>とはいえ、できるだけ多くのクライアント・コンポーネントを排除することを目指すべきではありません。最も少ない数のクライアント・コンポーネントに合わせて最適化を試みるべきではありません。これまでは、<em>すべて</em>のReactアプリのすべてのReactコンポーネントがクライアント・コンポーネントであったことは覚えておくべきです。</p><p>React Server Componentsを使い始めれば、それが非常に直感的なものであることが分かるでしょう。一部のコンポーネントはstate変数またはeffectを使用することから、クライアント上で実行する必要があります。そうしたコンポーネントでは、<code class="language-text">'use client'</code>ディレクティブを実行できます。それ以外の場合は、サーバー・コンポーネントのままにしておくことができます。</p></div></div>
<h2>クライアント・バウンダリ</h2>
<p>React Server Componentsに慣れ始めた頃、私が最初に抱いた疑問の1つが、<strong><em>propsが変更されるとどうなるのか</em></strong>？というものでした。</p>
<p>たとえば、次のようなサーバー・コンポーネントがあったとします。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">HitCounter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> hits <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      Number of hits: </span><span class="token punctuation">{</span>hits<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>最初のサーバー・サイド・レンダリングで、<code class="language-text">hits</code>が<code class="language-text">0</code>だったと仮定します。このコンポーネントは次に、以下のマークアップを生成します。</p>
<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
  Number of hits: 0
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>しかし、<code class="language-text">hits</code>の値が変化したらどうなるでしょうか？これがstate変数で、<code class="language-text">0</code>から<code class="language-text">1</code>に変化するとします。<code class="language-text">HitCounter</code>は再レンダリングする必要がありますが、サーバー・コンポーネントであるため再レンダリングは<em>できません</em>。</p>
<p><strong>問題は、サーバー・コンポーネントは単独では、事実上意味がないということです</strong>。より全体的なビューを取り上げ、アプリケーションの構造を検討するには、ズームアウトする必要があります。</p>
<p>仮に、次のようなコンポーネント・ツリーを考えてみましょう。</p>
<p><img src="/article-assets/server-components/server-components07.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p>これらのコンポーネントがすべてサーバー・コンポーネントであれば、完全に意味が通じます。いずれのコンポーネントも再レンダリングされないため、どのpropsも変化しません。</p>
<p>ただし、<code class="language-text">Article</code>コンポーネントが<code class="language-text">hits</code>というstate変数を持っていると仮定します。stateを使用するには、それをクライアント・コンポーネントに変換する必要があります。</p>
<p><img src="/article-assets/server-components/server-components08.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p>ここでの問題が分かりましたか？<code class="language-text">Article</code>が再レンダリングされると、<code class="language-text">HitCounter</code>や<code class="language-text">Discussion</code>など、所有していたコンポーネントも再レンダリングされます。ところが、これがサーバー・コンポーネントの場合には、再レンダリング<em>できません</em>。</p>
<p>このあり得ない状況を防ぐために、Reactチームは次のルールを追加しました。<strong>クライアント・コンポーネントがインポートできるのは他のクライアント・コンポーネントのみである</strong>。その<code class="language-text">'use client'</code>ディレクティブは、<code class="language-text">HitCounter</code>や<code class="language-text">Discussion</code>のインスタンスがクライアント・コンポーネントにならなければならないことを意味します。</p>
<p>React Server Componentsに関連して私が経験した最大の「なるほど」の瞬間の1つは、この新しいパラダイムは<em>クライアント・バウンダリ</em>の作成に関するものであると認識したときでした。実際には、次のようになります。</p>
<p><img src="/article-assets/server-components/server-components09.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p><code class="language-text">'use client'</code>ディレクティブを<code class="language-text">Article</code>コンポーネントに追加すると、「クライアント・バウンダリ」が作成されます。このバウンダリ内のコンポーネントはすべて、<em>暗黙的</em>にクライアント・コンポーネントに変換されます。<code class="language-text">HitCounter</code>などのコンポーネントには<code class="language-text">'use client'</code>ディレクティブがありませんが、この特定の状況ではクライアント上でハイドレーション/レンダリングが行われます <sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup>。</p>
<p>つまり、クライアント上で実行する必要があるすべてのファイルに<code class="language-text">'use client'</code>を追加する必要はないということです。実際に、追加する必要があるのは、新しいクライアント・バウンダリを作成する場合だけです。</p>
<h2>対処法</h2>
<p>クライアント・コンポーネントはサーバー・コンポーネントをレンダリングできないということを初めて知ったとき、私はかなり制約がきついなと感じました。アプリケーションの上の方でstateを使用しなければならない場合、どうすればよいのでしょうか？それは、<em>すべて</em>がクライアント・コンポーネントになる必要があるということでしょうか？？</p>
<p>多くの場合において、アプリケーションを再構築して、レンダリング<em>元</em>となるコンポーネントを工夫することで、この制約を回避できることが分かりました。</p>
<p>これを説明するのは難しいので、例を使って説明します。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">DARK_COLORS</span><span class="token punctuation">,</span> <span class="token constant">LIGHT_COLORS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/constants.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'./Header'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MainContent <span class="token keyword">from</span> <span class="token string">'./MainContent'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Homepage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>colorTheme<span class="token punctuation">,</span> setColorTheme<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> colorVariables <span class="token operator">=</span> colorTheme <span class="token operator">===</span> <span class="token string">'light'</span>
    <span class="token operator">?</span> <span class="token constant">LIGHT_COLORS</span>
    <span class="token operator">:</span> <span class="token constant">DARK_COLORS</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>colorVariables<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Header</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MainContent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>この設定では、React stateを使用して、ユーザーがダーク・モードとライト・モードを切り替えられるようにする必要があります。このことは、CSS変数トークンを<code class="language-text">&lt;body></code>タグに適用できるようにするため、アプリケーション・ツリーの上部で行う必要があります。</p>
<p>stateを使用するには、<code class="language-text">Homepage</code>をクライアント・コンポーネントにする必要があります。これはアプリケーションの最上部にあるため、他のすべてのコンポーネント（<code class="language-text">Header</code>および<code class="language-text">MainContent</code>）も暗黙的にクライアント・コンポーネントになることを意味します。</p>
<p>これを修正するには、カラー管理要素を独自のコンポーネントに引き込み、独自のファイルに移します。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token comment">// /components/ColorProvider.js</span>
<span class="token string">'use client'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">DARK_COLORS</span><span class="token punctuation">,</span> <span class="token constant">LIGHT_COLORS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/constants.js'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">ColorProvider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>colorTheme<span class="token punctuation">,</span> setColorTheme<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> colorVariables <span class="token operator">=</span> colorTheme <span class="token operator">===</span> <span class="token string">'light'</span>
    <span class="token operator">?</span> <span class="token constant">LIGHT_COLORS</span>
    <span class="token operator">:</span> <span class="token constant">DARK_COLORS</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>colorVariables<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">Homepage</code>に戻り、この新しいコンポーネントを次のように使用します。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token comment">// /components/Homepage.js</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'./Header'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MainContent <span class="token keyword">from</span> <span class="token string">'./MainContent'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ColorProvider <span class="token keyword">from</span> <span class="token string">'./ColorProvider'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Homepage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ColorProvider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Header</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MainContent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ColorProvider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">'use client'</code>ディレクティブは、stateやその他のクライアント側React機能を使用しなくなることから、<code class="language-text">Homepage</code>から削除できます。これは、<code class="language-text">Header</code>と<code class="language-text">MainConten</code>tが暗黙的にクライアント・コンポーネントに変換されなくなることを意味します。</p>
<p><strong>しかし、ちょっと待ってください</strong>。クライアント・コンポーネントである<code class="language-text">ColorProvider</code>は、HeaderとMainContentの<em>親</em>です。いずれにせよ、まだツリーでは上位にありますね。</p>
<p>ただし、クライアント・バウンダリに関しては、親子関係は重要ではありません。<code class="language-text">Homepage</code>は、<code class="language-text">Header</code>と<code class="language-text">MainContent</code>をインポートし、レンダリングするものです。これは、<code class="language-text">Homepage</code>が、これらのコンポーネントの<em>propsが何であるか</em>を決定することを意味します。</p>
<p>覚えておいてください。私たちが解決しようとしている問題は、サーバー・コンポーネントは再レンダリングができないため、どのpropsにも新しい値を与えることができないということです。この新しい設定では、<code class="language-text">Homepage</code>が、<code class="language-text">Header</code>と<code class="language-text">MainContent</code>のpropsを決定し、また<code class="language-text">Homepage</code>はサーバー・コンポーネントであることから、問題はありません。</p>
<p>これは頭を悩ませる事柄です。何年もReactを経験した後の今でも、このことはきわめて分かりにくいと思っています😅。これに対する直感を養うためには、かなりの練習を必要としました。</p>
<p>より正確に言えば、<code class="language-text">'use client'</code>ディレクティブはファイル/モジュール・レベルで機能します。クライアント・コンポーネント・ファイルに<em>インポート</em>されたモジュールもクライアント・コンポーネントでなければなりません。結局のところ、バンドラーがコードをバンドルすると、これらのインポートに追随することになります。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>カラー・テーマを変更するか？</h3><p>上記の例には、カラー・テーマを変更する方法がないことに気付いたかもしれません。<code class="language-text">setColorTheme</code>が呼び出されることは決してありません。
可能な限り最小限度に留めたかったので、いくつか省略したものがあります。完全な形の例では、Reactコンテキストを使用して、任意の子孫がsetter関数を使用できるようにします。コンテキストを使用するコンポーネントがクライアント・コンポーネントである限り、すべてうまくいきます。</p></div></div>
<h2>内部で何が起きているのか</h2>
<p>これを、もう少し深く見てみましょう。サーバー・コンポーネントを使用する場合、その出力はどのようなものになるでしょうか？実際に生成されるのは何でしょうか？</p>
<p>ここで、超シンプルなReactアプリケーションから始めることにしましょう。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Homepage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
      Hello world!
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>React Server Componentsパラダイムでは、デフォルトですべてのコンポーネントがサーバー・コンポーネントです。このコンポーネントをクライアント・コンポーネントとして明示的にマーク付けしていないため（またはクライアント・バウンダリ内でレンダリングしていないため）、サーバー上でのみレンダリングされます。</p>
<p>ブラウザでこのアプリにアクセスすると、次のようなHTMLドキュメントを受け取ることになります。</p>
<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/js/bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
      self<span class="token punctuation">.</span>__next<span class="token punctuation">[</span><span class="token string">'$Homepage-1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">"Hello world!"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>勝手な変更</h3><p>分かりやすくするため、ここであえて再構成を実施しました。たとえば、RSCコンテキストで生成された真のJSは、このHTMLドキュメントのファイル・サイズを削減するための最適化として、文字列化されたJSON配列を使用します。</p><p>また、HTMLの重要でない部分（<code class="language-text">&lt;head></code>など）もすべて削除しました。</p></div></div>
<p>HTMLドキュメントには、Reactアプリケーションによって生成されたUI、「Hello world!」パラグラフが含まれていることが分かります。これはサーバー・サイド・レンダリングのおかげであり、React Server Componentsに直接起因するものではありません。</p>
<p>その下には、JSバンドルをロードする<code class="language-text">&lt;script></code>タグがあります。このバンドルには、Reactなどの依存関係と、アプリケーションで使用されるクライアント・コンポーネントが含まれています。また、<code class="language-text">Homepage</code>コンポーネントはサーバー・コンポーネントであるため、そのコンポーネントのコードはこのバンドルには含まれていません。</p>
<p>最後に、いくつかのインラインJSを含む2番目の<code class="language-text">&lt;script></code>タグがあります。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">self<span class="token punctuation">.</span>__next<span class="token punctuation">[</span><span class="token string">'$Homepage-1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">"Hello world!"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>これは本当に興味深い点です。本質的には、ここで行っているのは、Reactに対して、「<code class="language-text">Homepage</code>コンポーネント・コードが足りないことは分かっていますが、心配しないでください。ここにレンダリングされたものがあります」と伝えることです。</p>
<p>通常、Reactがクライアント上でハイドレーションを行うと、すべてのコンポーネントが素早くレンダリングされ、アプリケーションの仮想DOMが構築されます。サーバー・コンポーネントの場合、コードがJSバンドルに含まれていないため、これを行うことができません。</p>
<p>したがって、レンダリングされた値と共に、サーバーによって生成された仮想DOMを送信します。Reactがクライアントにロードされると、そのディスクリプションを再生成する代わりに再利用します。</p>
<p>これにより、上記の<code class="language-text">ColorProvider</code>の例が機能するようになります。<code class="language-text">Header</code>と<code class="language-text">MainContent</code>からの出力は、<code class="language-text">children</code>というpropsを通じて<code class="language-text">ColorProvider</code>コンポーネントに送られます。<code class="language-text">ColorProvider</code>は必要なだけ再レンダリングを行えますが、このデータは静的であり、サーバーによってロックされています。</p>
<p>サーバー・コンポーネントがどのようにシリアル化され、ネットワーク経由で送信されるかの現実的表現を見たい場合は、開発者であるAlvar Lagerlöfによる<a href="https://www.alvar.dev/blog/creating-devtools-for-react-server-components">RSC Devtools</a>をチェックしてください。</p>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>サーバー・コンポーネントはサーバーを必要としない</h3><p>この記事の始めで、サーバー・サイド・レンダリングは、次のようなさまざまなレンダリング戦略についての「包括的な用語」であると述べました。</p><ul>
<li><strong>静的</strong>：HTMLは、展開プロセス中に、アプリケーションのビルド時に生成されます。</li>
<li><strong>動的</strong>：ユーザーがページをリクエストすると、HTMLは「オンデマンド」で生成されます。</li>
</ul><p><strong>React Server Componentsは、これらのレンダリング戦略のいずれとも互換性があります</strong>。サーバー・コンポーネントがNode.jsランタイム中にレンダリングされると、それらが返すJavaScriptオブジェクトが作成されます。それは、オンデマンドまたはビルド中のいずれかで発生する可能性があります。</p><p>つまり、React Server Componentsをサーバーなしで使用できるということです。大量の静的HTMLファイルを生成し、必要な場所にホストすることができます。事実、これがNext.jsのApp Routerにおいて、<em>デフォルト</em>で行われることです。本当に「オンデマンド」で行う必要がない場合、この作業はすべて事前に、ビルド中に実行されます。</p></div></div>
<div class="admonition admonition-none alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg></svg></span>none</h5></div><div class="admonition-content"><h3>Reactがまったくない場合？</h3><p>アプリケーションにクライアント・コンポーネントを含めない場合、本当にReactをダウンロードすることが必要なのかという疑問を持つかもしれません。React Server Componentsを使用して、<em>真に</em>静的な非JSウェブサイトを構築できるでしょうか？</p><p>問題は、React Server ComponentsはNext.jsフレームワーク内でのみ利用可能であり、そのフレームワークにはルーティングなどを管理するためにクライアント上で実行する必要のあるコードが多数含まれていることです。</p><p>ただし直感とは逆に、このことで実際には<em>より良い</em>ユーザー・エクスペリエンスが実現する傾向があります。たとえば、Nextのルーターは、新しいHTMLドキュメント全体を読み込む必要がないため、典型的な<code class="language-text">&lt;a></code>タグよりも速くリンク・クリックを処理できます。</p><p>適切に構造化されたNext.jsアプリケーションは、JSのダウンロード中も動作しますが、JSが読み込まれるとさらに速く/良くなります。</p></div></div>
<h2>利点</h2>
<p>React Server Componentsは、Reactでサーバー専用コードを実行することを目的とした最初の「公式」ツールです。ただし、すでに述べたように、より広範なReactエコシステムにおいては、これは<em>決して</em>新しいことではありません。2016年から、Next.jsではサーバー専用コードを実行できるようになっていました。</p>
<p>大きく異なるのは、これまで<em>コンポーネント内</em>でサーバー専用コードを実行する手段がなかった点です。</p>
<p>最も明白な利点はパフォーマンスです。JSバンドルにはサーバー・コンポーネントが含まれていないため、ダウンロードすべきJavaScriptの量と、ハイドレーションを必要とするコンポーネントの数が減ることになります。</p>
<p><img src="/article-assets/server-components/server-components10.png">
<img src="/article-assets/server-components/server-components11.png">
<em>（訳注：イメージは原文サイトの表示のキャプチャー画像です）</em></p>
<p>ただし、このことは私にとっては最も興味を感じられないものかもしれません。正直なところ、「ページ・インタラクティブ」のタイミングに関しては、ほとんどのNext.jsアプリが<em>すでに</em>十分な高速度を実現しています。</p>
<p>セマンティックHTMLの原則に従えば、Reactのハイドレーション前でも大半のアプリが動作するはずです。リンクをたどったり、フォームを送信したり、（<code class="language-text">&lt;details></code>や<code class="language-text">&lt;summary></code>を使用して）アコーディオンを展開したり折りたたんだりできます。ほとんどのプロジェクトで、Reactのハイドレーションに数秒かかっても、問題はありません。</p>
<p><strong>ただし、私が本当にすごいと思うのは</strong>、機能とバンドル・サイズという点で、同じ妥協をする必要がなくなったことです。</p>
<p>たとえば、ほとんどの技術系ブログでは、ある種のシンタックス・ハイライティング・ライブラリが必要となります。このブログでは、Prismを使用します。コード・スニペットは次のようになります。</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">exampleJavaScriptFunction</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">"Hello world!"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>一般的なプログラミング言語のすべてをサポートする適切なシンタックス・ハイライティング・ライブラリは数メガバイトになり、JSバンドルに組み込むには大きすぎます。そのため、ミッションクリティカルでない言語や機能を削除するという妥協が必要になります。</p>
<p>ただし、シンタックス・ハイライティングを行うのは<em>サーバー・コンポーネントにおいて</em>であると仮定しています。その場合、実際にはライブラリ・コードはJSバンドルに含まれません。その結果、妥協する必要が一切なくなり、オプション機能のすべてを利用できるようになります。</p>
<p>これが、React Server Componentsで動作するよう設計された最新のシンタックス・ハイライティング・パッケージである<a href="https://bright.codehike.org/">Bright</a>の背後にある卓越したアイデアです。</p>
<p><img src="https://www.joshwcomeau.com/images/server-components/bright.png"></p>
<p>これこそが、React Server Componentsについて私が興味をそそられる点です。JSバンドルに含めるにはコストがかかりすぎることが、サーバー上で、<em>無料で</em>実行できるようになり、バンドルに追加される容量は0キロバイトで、これまで以上に優れたユーザー・エクスペリエンスを得ることができます。</p>
<p>単にパフォーマンスの問題でもUXの問題でもありません。RSCをしばらく使ったことで、私はサーバー・コンポーネントがどれほど簡単であるかを真に理解するようになりました。ディペンデンシー・アレイ、古くなったクロージャ、メモ化、<em>状況の変化</em>によって引き起こされるその他の複雑な事柄について心配する必要はありません。</p>
<p>結局のところ、それはまだきわめて初期の段階にあります。React Server Componentsは数か月前に、ベータ版が完了して正式リリースになったばかりです。コミュニティがこの新しいパラダイムを活用して、Brightなどの新しいソリューションのイノベーションを続けていることから、今後数年間でどのように進化するかを見るのが本当に楽しみです。React開発者にとって今は、エキサイティングな時です。</p>
<h2>全体像</h2>
<p>React Server Componentsはエキサイティングな発展ですが、実際には「Modern React」パズルの一部にすぎません。</p>
<p>事態が<em>真に</em>興味深いものになるのは、React Server ComponentsをSuspenseや新しいStreaming SSRアーキテクチャと組み合わせたときです。その結果、次のような驚くべきことが可能になります。</p>
<p><img src="/article-assets/server-components/server-components12.png"></p>
<p>このチュートリアルの対象範囲を超えていますが、このアーキテクチャの詳細については、<a href="https://github.com/reactwg/react-18/discussions/37">Githubで</a>確認することができます。</p>
<p>また、私の新しいコース<a href="https://joyofreact.com/">The Joy of React</a>でも詳しく取り上げます。よろしければ、もう少し詳しく説明させていただきたいと思います！❤️</p>
<p>The Joy of Reactは初心者向けのインタラクティブ・コースで、Reactがどのように機能するかについての知識を得られる設定になっています。初歩段階からスタートし（Reactの経験は必要ありません）、Reactの悪名の高いトリッキーな側面を取り上げていきます。</p>
<p>これは私が約2年間、フルタイムで取り組んできたコースであり、8年以上の経験の中でReactについて学んだ最も重要な事柄のすべてが含まれています。</p>
<p>お伝えたしたいことが満載のコースです。React本体と、このブログ記事で暗に取り上げた最先端の機能に加えて、Reactエコシステムの中で私が気に入っている部分についても学ぶことができます。たとえば、Framer Motionを使用して、次のレベルのレイアウト・アニメーションを作成する方法を学べます。</p>
<p><video autoplay="" loop="" muted="" playsinline="" src="https://www.joshwcomeau.com/images/server-components/reading-list-blog-demo.mp4"></video></p>
<p>このコースについてさらに詳しく学び、Reactを使ったビルドの楽しさを発見してください。</p>
<ul>
<li><a href="https://joyofreact.com/">The Joy of React</a></li>
</ul>
<hr>
<p>React Server Componentsは重要なパラダイム・シフトです。個人的には、Reactエコシステムにおいて、サーバー・コンポーネントを利用するBrightのようなツールがさらに構築されるにつれて、今後数年間で状況がどのように展開していくかに関してきわめて強い関心があります。</p>
<p>Reactでの構築がさらにすごいことになると感じています。😄</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1"><em>特定のモジュールをレイジーロードしたり、ルートに基づいて分割したりするような最適化もありますが、一般的なルールとして、JSバンドルはどんどん大きくなる傾向があります</em><a href="#fnref-1" class="footnote-backref">↩</a></li>
<li id="fn-2"><em>メタフレームワークとは、Reactの上に構築し、ルーティングやデータ管理のような機能を追加するフレームワークを意味する</em><a href="#fnref-2" class="footnote-backref">↩</a></li>
<li id="fn-3"><em>少なくとも、新しいページに移動するなど、ルーター上で何かが起こるまでは</em><a href="#fnref-3" class="footnote-backref">↩</a></li>
<li id="fn-4"><em>HitCounterコンポーネント自体は、サーバー・コンポーネントにより他の場所にインポートされた場合、サーバー・コンポーネントとしてレンダリングされる可能性があります</em><a href="#fnref-4" class="footnote-backref">↩</a></li>
</ol>
</div>]]></content:encoded></item><item><title><![CDATA[Next.jsを4年間使用してたどりついた、エンタープライズアプリケーションのフロントエンド開発・構築手法]]></title><description><![CDATA[はじめに 目まぐるしく進化するフロントエンド開発の世界では、常に最新の知識や技術をいち早く取り入れることが、エンタープライズアプリケーションの開発を成功させる上で欠かせません。Tailwind CS…]]></description><link>https://postd.cc/how-i-approach-and-structure-enterprise-frontend-applications-after-4-years-of-using-nextjs/</link><guid isPermaLink="false">https://postd.cc/how-i-approach-and-structure-enterprise-frontend-applications-after-4-years-of-using-nextjs/</guid><category><![CDATA[開発手法・プロジェクト管理]]></category><category><![CDATA[Next.js]]></category><category><![CDATA[TypeScript]]></category><category><![CDATA[JavaScript]]></category><category><![CDATA[React]]></category><pubDate>Mon, 25 Dec 2023 00:00:01 GMT</pubDate><content:encoded><![CDATA[<h2>はじめに</h2>
<p>目まぐるしく進化するフロントエンド開発の世界では、常に最新の知識や技術をいち早く取り入れることが、エンタープライズアプリケーションの開発を成功させる上で欠かせません。Tailwind CSS、TypeScript、Turborepo、ESLint、React Queryなどを含む強力なツールキットとNext.jsを<strong>4</strong>年間使用してきた結果、開発に役立つさまざまな知見やベストプラクティスが得られました。この記事では、大企業向けフロントエンドアプリケーションのパフォーマンス、保守性、拡張性を最大限に高める設計・構築手法を紹介したいと思います。</p>
<p><strong>注記</strong>：ここに記載する内容はあくまでも個人的な見解であり、筆者が推奨する手法が必ずしも適さない場合もあります。</p>
<h2>効果的なエンタープライズ向けフロントエンドアーキテクチャの基本原則</h2>
<p>エンタープライズ規模のアプリケーション向けにフロントエンドソリューションを設計する場合、基本原則を明確に定めておくことで開発作業の方向性を示すことができます。このセクションでは、エンタープライズ環境において筆者が実際にNext.jsを使用してきた経験を踏まえた基本原則を紹介します。</p>
<h3>モジュール性とコンポーネント化</h3>
<p><em>原則：分割統治</em></p>
<p>大規模なエンタープライズアプリケーションでは、コードはすぐに肥大化し、手に負えなくなってしまいます。モジュール性を備えたフロントエンド設計により、コードを扱いやすい大きさのコンポーネントに分割しましょう。コンポーネントはブロック玩具のように、それぞれ特定の役割を担います。そのため、コンポーネント化することでコードを再利用しやすくなるだけでなく、保守や開発チーム内での連携が容易になります。また、アプリケーションを小さなコンポーネントに分割するだけでなく、独立した小さなアプリケーションに分割できないか検討しましょう。それには、Turborepoなどのツールが役立ちます。</p>
<h3>関心の分離（SOC）</h3>
<p><em>原則：コードベースを整理する</em></p>
<p>コードの健全性を保つため、関心の分離（SoC）の原則に従いましょう。UIのレンダリング、ビジネスロジックの処理、状態（ステート）の管理といった各コンポーネントの役割を、それぞれ明確に分離します。そうすることで、コードが分かりやすくなるだけでなく、テストやデバッグを行いやすくなります。</p>
<h3>スケーラブルな設計</h3>
<p><em>原則：拡張に備える</em></p>
<p>エンタープライズアプリケーションは静的ではなく、進化します。スケーラビリティを念頭に置きながらフロントエンドアーキテクチャを設計しましょう。これはつまり、トラフィックやデータ量の増大、機能の複雑化に対応できるパターンやツールを選ぶということです。Next.jsはスケーラビリティに対応可能な設計になっているため、その点においても有益です。</p>
<h3>保守性とコード品質</h3>
<p><em>原則：丁寧にコーディングする</em></p>
<p>コードは製品の土台です。最初から保守性とコード品質を重視し、コーディング規約を定め、コードレビューを実施し、テスト自動化に投資しましょう。管理の行き届いたコードベースは作業しやすいだけでなく、バグやリグレッションが発生しにくくなります。筆者は最近、フロントエンドアプリケーションのコーディング規約を順守させるため、<a href="https://ui.fin.africa/?path=/docs/foundations-guidelines--docs">コンポーネントライブラリと簡単なスタイルガイド</a>を作成しました。ドキュメントはまだ完成していないので、あしからず😂.</p>
<h2>アクセシビリティの標準化</h2>
<p><em>原則：最初からインクルーシブデザイン</em></p>
<p>モダンWeb開発において、アクセシビリティは絶対条件です。最初からアクセシビリティの高いWeb開発を実践しましょう。障がいの有無にかかわらず、誰もがアプリケーションを利用できるようにします。アクセシビリティの基準や、インクルーシブなユーザーエクスペリエンスを生み出すためのツールについては、Next.jsのサポートが役立ちます。筆者は、タブやドロップダウンなどアクセシビリティへの配慮が必要なコンポーネントには、<a href="https://www.radix-ui.com/">Radix UI</a>などのツールを使用します。</p>
<h3>パフォーマンス重視の開発</h3>
<p><em>原則：スピードは重要</em></p>
<p>エンタープライズユーザーはスピードを求めています。あらゆる場面でパフォーマンスを重視しましょう。アセットを最適化し、不要なリクエストを最小限に減らし、自動コード分割、Suspenseを使ったストリーミング、画像最適化といったNext.jsのパフォーマンス機能を活用します。素早く動くアプリケーションはユーザーの満足度が高いだけでなく、SEOにも好影響を与えます。</p>
<h3>セキュリティ第一</h3>
<p><em>原則：城を守る</em></p>
<p>フロントエンドアーキテクチャの構造の中にセキュリティを組み込み、クロスサイトスクリプティング（XSS）やクロスサイトリクエストフォージェリ（CSRF）などの一般的な脆弱性から守りましょう。セキュリティアップデートやベストプラクティスの実践を怠らず、Next.jsに組み込まれたセキュリティ機能は予備的な防御層とみなします。</p>
<h3>国際化（i18n）と地域化（l10n）</h3>
<p><em>原則：グローバルな視点で考える</em></p>
<p>つながりあったこの世界では、グローバルな視点で考えることが不可欠です。多様なユーザーに対応するため、最初から国際化（i18n）と地域化（l10n）を実施しましょう。Next.jsはこれらの機能のサポートが充実しているため、多言語アプリケーションの作成を容易にします。</p>
<p>これらの基本原則は、Next.jsを使用して効果的なエンタープライズ向けフロントエンドアーキテクチャを構築する上での土台を形成します。大規模アプリケーションの要求に沿って開発作業を進め、強固で保守性に優れ、使いやすいアプリケーションを開発できるよう、羅針盤の役割を果たします。以下のセクションでは、これらの原則を実践的な戦略やベストプラクティスに落とし込む方法を詳しく見ていきます。</p>
<h2>フォルダとファイル構造</h2>
<p>Reactでは、綿密に考えられたフォルダ構造によってプロジェクトを整理することが、保守性とスケーラビリティを実現する上で重要です。アプローチとしては、機能や目的に応じてファイルを整理する方法が一般的です。筆者が自分のアプリケーションでよく使用するフォルダ構造をサンプルとして紹介します。</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">├─ src/
│ ├─ components/
│ │ ├─ ui/
│ │ │ ├─ Button/
│ │ │ ├─ Input/
│ │ │ ├─ ...
│ │ │ └─ index.tsx
│ │ ├─ shared/
│ │ │ ├─ Navbar/
│ │ └─ charts/
│ │ │ ├─ Bar/
│ ├─ modules/
│ │ ├─ HomePage/
│ │ ├─ ProductAddPage/
│ │ ├─ ProductPage/
│ │ ├─ ProductsPage/
│ │ │ ├─ api/
│ │ │ │ └─ useGetProducts/
│ │ │ ├─ components/
│ │ │ │ ├─ ProductItem/
│ │ │ │ ├─ ProductsStatistics/
│ │ │ │ └─ ...
│ │ │ ├─ utils/
│ │ │ │ └─ filterProductsByType/
│ │ │ └─ index.tsx
│ │ ├─ hooks/
│ │ ├─ consts/
│ │ └─ types/
│ │ └─ lib/
| | └─ styles/
│ │ │ ├─ global.css
│ │ └─ ...
│ ├─ public/
│ │ ├─ ...
│ │ └─ index.tsx
│ ├─ eslintrc.js
│ ├─ package.json
│ └─ tsconfig.json
└─ ...</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li><strong>src/components</strong>: このディレクトリにはUIコンポーネントを格納します。さらに、一般的なUIコンポーネントを格納する<code class="language-text">ui</code>と、アプリケーションの他の部分で再利用する可能性のあるコンポーネントを格納する<code class="language-text">shared</code>に分かれています。</li>
<li><strong>src/modules</strong>: このディレクトリには、アプリケーションのさまざまなモジュールやページを格納します。モジュールごとにフォルダが分かれ、APIコール、コンポーネント、ユーティリティ機能のためのサブディレクトリが含まれる場合があります。</li>
<li><strong>src/pages</strong>: Next.jsを使用している場合、このフォルダはアプリケーションのエントリーポイントとしてのみ使用します。ここにはビジネスロジックは格納しません。pagesフォルダに格納されたコンポーネントは、必ずmodulesフォルダからページをレンダリングします。</li>
<li><strong>src/modules/ProductsPage</strong>: このモジュールは製品に関連し、APIコール、コンポーネント（<code class="language-text">ProductItem</code>や<code class="language-text">ProductsStatistics</code>など）、ユーティリティ機能（<code class="language-text">filterProductsByType</code>）のサブディレクトリが含まれます。</li>
<li><strong>src/lib</strong>: このフォルダには、後でパッケージに変換し、複数のアプリケーションで使用することができるユーティリティ機能を格納します。後でパッケージに変換することのないユーティリティ機能を格納する<strong>src/utils</strong>とは異なります。</li>
<li><strong>src/styles</strong>: このディレクトリには、グローバルスタイル（<code class="language-text">global.css</code>）や、スタイルに関連するその他のファイルを格納します。</li>
<li><strong>src/public</strong>: このフォルダには、ビルドプロセスで使用しない画像、フォント、<code class="language-text">index.html</code>ファイルなどの静的アセットを格納します。</li>
<li><strong>src/consts, src/types</strong>: これらのディレクトリには、それぞれ定数とTypeScriptの型定義を格納します。</li>
<li><strong>src/hooks</strong>: このディレクトリには、アプリケーション全体で使用するカスタムフックを格納します。</li>
<li><strong>eslintrc.js</strong>: これは、よく知られたJavaScript用構文チェックツールであるESLintの設定ファイルです。コーディング規約を適用し、コードの間違いを見つけるために使用します。</li>
</ul>
<p><code class="language-text">tsconfig</code>ファイルは、例えば<code class="language-text">Button</code>コンポーネントをインポートしたい場合、<code class="language-text">import { Button } from '@/components/ui'</code>のように指定してインポートできるよう設定されています。これを<code class="language-text">tsconfig.json</code>から設定するためのコードスニペットを以下に示します。</p>
<div class="gatsby-highlight" data-language="jsonc"><pre style="counter-reset: linenumber NaN" class="language-jsonc line-numbers"><code class="language-jsonc">{
  ...
  &quot;compilerOptions&quot;: {
    &quot;baseUrl&quot;: &quot;.&quot;,
    &quot;paths&quot;: {
      &quot;@/*&quot;: [&quot;./src/*&quot;]
    }
  }
}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>TypeScriptのコーディング規約</h2>
<p>筆者が使用する規約は<a href="https://mkosir.github.io/typescript-style-guide/">こちら</a>のガイドに基づいています。ぜひ一読してみてください。以下のコードスニペットはこのガイドからの抜粋です。</p>
<h4>型は全て型エイリアスで定義する</h4>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token comment">// ❌ Avoid interface definitions unless you need to extend or implement them</span>

<span class="token keyword">interface</span> <span class="token class-name">UserRole</span> <span class="token operator">=</span> <span class="token string">'admin'</span> <span class="token operator">|</span> <span class="token string">'guest'</span><span class="token punctuation">;</span> <span class="token comment">// invalid - interface can't define (commonly used) type unions</span>

<span class="token keyword">interface</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  role<span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token operator">|</span> <span class="token string">'guest'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ Use type definition</span>
<span class="token keyword">type</span> <span class="token class-name">UserRole</span> <span class="token operator">=</span> <span class="token string">'admin'</span> <span class="token operator">|</span> <span class="token string">'guest'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">UserInfo</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  role<span class="token operator">:</span> UserRole<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>複数の引数の使用を避ける</h4>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token comment">// ❌ Avoid having multiple arguments</span>
<span class="token function">transformUserInput</span><span class="token punctuation">(</span><span class="token string">'client'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ Use options object as argument</span>
<span class="token function">transformUserInput</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'client'</span><span class="token punctuation">,</span>
  isValidated<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  minLines<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
  maxLines<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
  defaultInput<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  shouldLog<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  timeout<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>命名規則</h4>
<p>最適な名前を決めるのは難しいものですが、既定の規則に従い、今後作業する開発者のためにコードの可読性を高め、一貫性を保つよう努めましょう。</p>
<h4>変数・定数</h4>
<ul>
<li><strong>ローカル変数</strong>　<code class="language-text">products</code>をキャメルケースで記述する（<code class="language-text">productsFiltered</code>）</li>
<li><strong>ブール型変数</strong>　<code class="language-text">is</code>や<code class="language-text">has</code>などの接頭辞を先頭に付ける（<code class="language-text">isDisabled</code>、<code class="language-text">hasProduct</code>）</li>
<li><strong>定数</strong>　大文字で記述（<code class="language-text">PRODUCT_ID</code>）</li>
<li><strong>オブジェクト型の定数</strong></li>
</ul>
<p>単数形を使用し、大文字で記述します。constアサーション（as const）を使用し、任意でsatisfies演算子を使用して型（その型が存在する場合）にマッチするかチェックします。</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript">  <span class="token keyword">const</span> <span class="token constant">ORDER_STATUS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    pending<span class="token operator">:</span> <span class="token string">'pending'</span><span class="token punctuation">,</span>
    fulfilled<span class="token operator">:</span> <span class="token string">'fulfilled'</span><span class="token punctuation">,</span>
    error<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span> satisfies OrderStatus<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>関数</h4>
<p>キャメルケース</p>
<p><code class="language-text">filterProductsByType</code>, <code class="language-text">formatCurrency</code></p>
<h4>ジェネリクス</h4>
<p><code class="language-text">TRequest</code>、<code class="language-text">TFooBar</code>のように先頭に大文字のTが付きます（<a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2?view=net-5.0">.Netの内部</a>実装と同様)。</p>
<p>よく使われる規約ではありますが、ジェネリクスを<code class="language-text">T</code>や<code class="language-text">K</code>など1文字で命名するのは避けましょう。変数が増えれば増えるほど、間違いやすくなります。</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token comment">// ❌ Avoid naming generics with one character</span>
<span class="token keyword">const</span> createPair <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span><span class="token operator">></span><span class="token punctuation">(</span>first<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> second<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pair <span class="token operator">=</span> <span class="token function">createPair</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ Name starts with the capital letter T</span>
<span class="token keyword">const</span> createPair <span class="token operator">=</span> <span class="token operator">&lt;</span>TFirst<span class="token punctuation">,</span> TSecond <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span><span class="token operator">></span><span class="token punctuation">(</span>
  first<span class="token operator">:</span> TFirst<span class="token punctuation">,</span>
  second<span class="token operator">:</span> TSecond
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span>TFirst<span class="token punctuation">,</span> TSecond<span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>first<span class="token punctuation">,</span> second<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pair <span class="token operator">=</span> <span class="token function">createPair</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>パッケージとツール</h2>
<p>アプリケーションの開発では、作業の不要な重複を避けるため、一般的にサードパーティツールを活用します。筆者がスケーラブルなアプリケーションをビルドする際に使用するパッケージをいくつか紹介します。</p>
<h4>React Query/TanStack Query</h4>
<p>React Queryは、複雑なエンタープライズアプリケーションにおけるデータフェッチや同期化を管理するのに非常に便利です。APIからのデータフェッチやキャッシング、ミューテーション関数の処理へのアプローチを統一できます。エンタープライズ環境では、アプリケーションは複数のAPIやサービスと連携しなくてはならない場合が多くあります。React Queryは、データ管理を一元化し、ボイラープレートコードを減らすことで、このプロセスを効率化できます。</p>
<h4>React Context</h4>
<p>React Contextは、propsのバケツリレーを行うことなく、複数のコンポーネントにまたがるグローバルステートを管理するのに役立ちます。これは、アプリケーション全体でユーザー認証や環境設定などの共有ステートにアクセスする必要があるエンタープライズアプリケーションでは特に有益です。</p>
<p>通常、筆者はReact Contextなどの状態管理ツールの使用は最後の手段として取っておきます。グローバルステートに頼るのは必要最低限にとどめておくのがよいでしょう。その代わり、ステートはなるべく必要な場所の近くに置いておきましょう。</p>
<h4>Cypress</h4>
<p>Cypressは、E2Eのテストに非常に役立つツールです。エンタープライズアプリケーションでは、重要なワークフローや機能が異なる画面やコンポーネント上で正常に機能するようにすることが何よりも重要です。Cypressはダントツで筆者が一番気に入っているツールです。テストに合格すれば、新たに導入したコードがアプリケーションに不具合をもたらすことはないと確信できます。エンタープライズアプリケーションが進化していく中で、コードに新たな変更を加えた際にリグレッションテストを実施し、意図せぬ副作用が生じていないか確認することが重要です。Cypressは、テストプロセスを自動化することで、この確認作業を容易にします。</p>
<h4>React Testing Library:</h4>
<p>React Testing Libraryは、Reactコンポーネントの単体テストと統合テストに欠かせません。エンタープライズアプリケーションでは、個々のコンポーネントが期待どおり動作するか検証することが、強固なアプリケーションを作る上で重要です。React Testing Libraryは、各コンポーネントを単体で、さらに他のコンポーネントと組み合わせて、入念にテストすることを可能にします。</p>
<h4>NextAuth.js:</h4>
<p>NextAuth.jsは、Next.jsアプリケーションにおける認証と認可の実装を容易にします。エンタープライズ環境では、ユーザー管理のセキュリティは絶対条件です。企業の間では、複数のアプリケーションをまたいだユーザー認証を効率化するためにシングルサインオン（SSO）ソリューションがしばしば採用されます。NextAuth.jsはさまざまなSSOプロバイダーに対応しているため、エンタープライズ認証のニーズに最適なツールです。また、NextAuth.jsではカスタム認証フローを柔軟に実装することもできます。</p>
<p>NextAuth.jsでTypeScriptによるモジュール拡張を使用してデフォルトの<code class="language-text">User</code>モデルをカスタマイズする方法を説明した筆者の<a href="https://josemukorivo.com/blog/unlock-next-level-authentication-in-nextjs-with-next-auth-and-typescript-module-augmentation-1689">ブログ記事</a>もご覧ください。</p>
<h4>Turborepo</h4>
<p>これも筆者が気に入っているツールの1つです。Turborepoはモノレポの管理に役立ちます。大規模なエンタープライズアプリケーションでは、さまざまなモジュールやサービス、共有コードによりコードベースが膨大になる場合があります。Turborepoは、肥大化したコードベースを効率的に整理し、バージョン管理やデプロイメントを行いやすくします。エンタープライズ環境では、複数のチームやプロジェクトでコードを共有するのは一般的です。Turborepoは、効果的なコード共有を可能にし、共有ライブラリやコンポーネントを使用したチームコラボレーションをサポートします。</p>
<h3>Storybook</h3>
<p>Storybookを使用することで、開発者はUIコンポーネントを切り離し、制御された環境で動かすことができます。そのため、アプリケーション全体を操作することなく、個々のコンポーネントの外観や動作のデモを簡単に実施できます。大規模なエンタープライズアプリケーションでは、複数の開発者やチームがそれぞれUIの異なる部分を担当している場合があります。Storybookは、UIコンポーネントを披露して議論を交わすための一元的なプラットフォームを提供することで、コラボレーションの効率化を促し、デザイン言語の一貫性を確保します。<a href="https://ui.fin.africa/">こちら</a>は筆者がStorybookを使用して開発し、文書化したコンポーネントライブラリのサンプルです（まだ未完成ですが）。</p>
<p><em>エンタープライズ環境では、これらのツールを組み合わせることで、大規模アプリケーションを構築、テスト、維持管理し、データ管理、状態管理、テスト、認証、コード整理などの重要な課題に対処できます。</em></p>
<h2>再利用可能なコンポーネントのコーディングスタイル</h2>
<p>筆者が入力やダイアログなどの再利用可能なコンポーネントを開発する際には、なるべくベストプラクティスに沿って作業するようにしています。</p>
<p>では、<code class="language-text">Button</code>コンポーネントの開発を例にいくつかのベストプラクティスを紹介したいと思います。ベストプラクティスがビジュアルデザインだけにとどまらないことがお分かりいただけるかと思います。</p>
<h4>コンポーネントの再利用性</h4>
<p>ボタンコンポーネントはアプリケーションのさまざまな場所で再利用できるよう設計しましょう。さまざまなユースケースに対応可能な柔軟性が必要です。</p>
<h4>カスタマイズのためのPROPS</h4>
<p>サイズ、色、バリアント（1次、2次など）、無効化状態などの一般的なカスタマイズを行うためのpropsを用意しましょう。そうすることで、開発者はさまざまなUIコンテキストに合わせて容易にボタンを調整できます。</p>
<h4>アクセシビリティへの配慮</h4>
<p>aria-label属性やaria-disabled属性、フォーカス管理などの適切なアクセシビリティ機能を実装しましょう。そうすることで、アシスティブテクノロジー（支援技術）の利用者も効果的にボタンを使用できます。</p>
<h4>セマンティックHTML</h4>
<p>ボタンコンポーネントにセマンティックHTMLの要素を使用しましょう。そうすることで、アクセシビリティとSEOが向上し、異なるデバイス上でも適切な動作を確保できます。</p>
<h4>ボタンのネイティブ要素の模倣</h4>
<p>これらのベストプラクティスは全て、予測可能なコードを記述することにつながります。カスタムボタンコンポーネントを開発する場合、ボタンとして機能し、動作するようにしましょう。後述するコンポーネントの例では、ボタンのネイティブ要素を拡張することで、ボタンに追加できるあらゆるpropsを含めています。</p>
<h4>エラーハンドリング</h4>
<p>ボタンがエラー状態（フォームの送信など）につながる可能性がある場合、エラーを処理し、ユーザーに伝える方法を用意しましょう。</p>
<h4>テスト</h4>
<p>さまざまなシナリオでボタンコンポーネントが期待どおり動作することを検証するための単体テストを作成しましょう。テストケースはさまざまなpropsやイベントハンドラを網羅する必要があります。</p>
<h4>ドキュメント化</h4>
<p>利用可能なprops、イベントハンドラ、特定のユースケースなども含め、ボタンコンポーネントの使用方法をドキュメント化しましょう。開発者の参考になるような例やコードスニペットも記載します。これにはStorybookが役立ちます。</p>
<h4>クロスブラウザ互換性:</h4>
<p>異なるブラウザでボタンコンポーネントをテストし、動作や外観が一貫しているか確認しましょう。</p>
<h4>バージョン管理と変更履歴</h4>
<p>ボタンコンポーネントが共有ライブラリの一部である場合、バージョン管理を実施し、変更履歴を残すことで開発者に更新や変更について知らせましょう。</p>
<h3>コーディング</h3>
<p>筆者のコンポーネントには、大抵<code class="language-text">Button.tsx</code>、<code class="language-text">Button.stories.tsx</code>、<code class="language-text">Docs.mdx</code>、<code class="language-text">Button.test.ts</code>といったファイルが含まれます。CSSを使用している場合、<code class="language-text">Button.module.css</code>のようなファイルがあるかもしれません。</p>
<p><code class="language-text">components/ui/Button.tsx</code></p>
<p>これがメインのコンポーネントであり、<code class="language-text">cn</code>関数でクラスをマージし、コンフリクトに対処します。<code class="language-text">tw-merge</code>ライブラリのラッパーです。</p>
<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  forwardRef<span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">ButtonHTMLAttributes</span><span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">JSXElementConstructor</span><span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">ReactElement</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AiOutlineLoading3Quarters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-icons/ai'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> VariantProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cva'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cva <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cva'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/lib'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> <span class="token function">cva</span><span class="token punctuation">(</span>
  <span class="token string">'flex w-max items-center border-[1.5px] gap-2 transition duration-200 ease-linear focus:outline-0 focus:ring ring-offset-1 dark:ring-offset-blue-dark'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    variants<span class="token operator">:</span> <span class="token punctuation">{</span>
      variant<span class="token operator">:</span> <span class="token punctuation">{</span>
        outline<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        solid<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        naked<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      rounded<span class="token operator">:</span> <span class="token punctuation">{</span>
        none<span class="token operator">:</span> <span class="token string">'rounded-none'</span><span class="token punctuation">,</span>
        sm<span class="token operator">:</span> <span class="token string">'rounded'</span><span class="token punctuation">,</span>
        md<span class="token operator">:</span> <span class="token string">'rounded-lg'</span><span class="token punctuation">,</span>
        lg<span class="token operator">:</span> <span class="token string">'rounded-xl'</span><span class="token punctuation">,</span>
        full<span class="token operator">:</span> <span class="token string">'rounded-full'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      color<span class="token operator">:</span> <span class="token punctuation">{</span>
        primary<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        danger<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        info<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        warning<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        light<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        secondary<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      size<span class="token operator">:</span> <span class="token punctuation">{</span>
        xs<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        sm<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        md<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        lg<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      disabled<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token boolean">true</span><span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      active<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token boolean">true</span><span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token boolean">true</span><span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      fullWidth<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token boolean">true</span><span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      align<span class="token operator">:</span> <span class="token punctuation">{</span>
        center<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        left<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        right<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
        between<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    compoundVariants<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        variant<span class="token operator">:</span> <span class="token string">'solid'</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'secondary'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        variant<span class="token operator">:</span> <span class="token string">'solid'</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token string">'primary'</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        variant<span class="token operator">:</span> <span class="token string">'outline'</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'primary'</span><span class="token punctuation">,</span> <span class="token string">'secondary'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        variant<span class="token operator">:</span> <span class="token string">'outline'</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span>
          <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        variant<span class="token operator">:</span> <span class="token string">'naked'</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'primary'</span><span class="token punctuation">,</span> <span class="token string">'secondary'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span>
          <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        disabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        variant<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'solid'</span><span class="token punctuation">,</span> <span class="token string">'outline'</span><span class="token punctuation">,</span> <span class="token string">'naked'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'primary'</span><span class="token punctuation">,</span> <span class="token string">'secondary'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'light'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        variant<span class="token operator">:</span> <span class="token string">'outline'</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'primary'</span><span class="token punctuation">,</span> <span class="token string">'secondary'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'light'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        variant<span class="token operator">:</span> <span class="token string">'naked'</span><span class="token punctuation">,</span>
        color<span class="token operator">:</span> <span class="token string">'primary'</span><span class="token punctuation">,</span>
        className<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    defaultVariants<span class="token operator">:</span> <span class="token punctuation">{</span>
      size<span class="token operator">:</span> <span class="token string">'md'</span><span class="token punctuation">,</span>
      variant<span class="token operator">:</span> <span class="token string">'solid'</span><span class="token punctuation">,</span>
      color<span class="token operator">:</span> <span class="token string">'primary'</span><span class="token punctuation">,</span>
      rounded<span class="token operator">:</span> <span class="token string">'lg'</span><span class="token punctuation">,</span>
      align<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">BaseProps</span>
  <span class="token keyword">extends</span> <span class="token class-name">Omit<span class="token operator">&lt;</span>
      ButtonHTMLAttributes<span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">></span><span class="token punctuation">,</span>
      <span class="token string">'color'</span> <span class="token operator">|</span> <span class="token string">'disabled'</span> <span class="token operator">|</span> <span class="token string">'active'</span>
    <span class="token operator">></span></span><span class="token punctuation">,</span>
    VariantProps<span class="token operator">&lt;</span><span class="token keyword">typeof</span> button<span class="token operator">></span> <span class="token punctuation">{</span>
  href<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  loadingText<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  target<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'_blank'</span> <span class="token operator">|</span> <span class="token string">'_self'</span> <span class="token operator">|</span> <span class="token string">'_parent'</span> <span class="token operator">|</span> <span class="token string">'_top'</span><span class="token punctuation">;</span>
  <span class="token keyword">as</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'button'</span> <span class="token operator">|</span> <span class="token string">'a'</span> <span class="token operator">|</span> JSXElementConstructor<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ButtonProps</span> <span class="token operator">=</span> BaseProps <span class="token operator">&amp;</span>
  <span class="token punctuation">(</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
        rightIcon<span class="token operator">?</span><span class="token operator">:</span> ReactElement<span class="token punctuation">;</span>
        leftIcon<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
        rightIcon<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
        leftIcon<span class="token operator">?</span><span class="token operator">:</span> ReactElement<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Button <span class="token operator">=</span> <span class="token generic-function"><span class="token function">forwardRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLButtonElement<span class="token punctuation">,</span> ButtonProps<span class="token operator">></span></span></span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>props<span class="token punctuation">,</span> ref<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token keyword">as</span><span class="token operator">:</span> Tag <span class="token operator">=</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      variant<span class="token punctuation">,</span>
      color<span class="token punctuation">,</span>
      rounded<span class="token punctuation">,</span>
      size<span class="token punctuation">,</span>
      target <span class="token operator">=</span> <span class="token string">'_self'</span><span class="token punctuation">,</span>
      loading<span class="token punctuation">,</span>
      fullWidth<span class="token punctuation">,</span>
      align<span class="token punctuation">,</span>
      loadingText<span class="token punctuation">,</span>
      href<span class="token punctuation">,</span>
      active<span class="token punctuation">,</span>
      rightIcon<span class="token punctuation">,</span>
      leftIcon<span class="token punctuation">,</span>
      className<span class="token punctuation">,</span>
      disabled<span class="token punctuation">,</span>
      children<span class="token punctuation">,</span>
      <span class="token operator">...</span>rest
    <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>

    <span class="token keyword">const</span> classes <span class="token operator">=</span> <span class="token function">cn</span><span class="token punctuation">(</span>
      <span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        variant<span class="token punctuation">,</span>
        color<span class="token punctuation">,</span>
        size<span class="token punctuation">,</span>
        disabled<span class="token punctuation">,</span>
        loading<span class="token punctuation">,</span>
        active<span class="token punctuation">,</span>
        rounded<span class="token punctuation">,</span>
        fullWidth<span class="token punctuation">,</span>
        align<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      className
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>href <span class="token operator">?</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>classes<span class="token punctuation">}</span></span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>href<span class="token punctuation">}</span></span> <span class="token attr-name">target</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>target<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span>leftIcon<span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token punctuation">{</span>rightIcon<span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tag</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>classes<span class="token punctuation">}</span></span> <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>disabled<span class="token punctuation">}</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span>loading <span class="token operator">?</span> <span class="token punctuation">(</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AiOutlineLoading3Quarters</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>animate-spin<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span>loadingText <span class="token operator">||</span> <span class="token string">'Loading...'</span><span class="token punctuation">}</span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
            <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span>leftIcon<span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token punctuation">{</span>rightIcon<span class="token punctuation">}</span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Tag</span></span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Button<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Button'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">components/ui/Button.stories.tsx</code></p>
<p>このファイルには、Storybook向けのボタンのストーリーが含まれます。</p>
<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Meta<span class="token punctuation">,</span> StoryObj <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> FaRegSmileWink<span class="token punctuation">,</span> FaThumbsUp<span class="token punctuation">,</span> FaYinYang <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-icons/fa'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> FiArrowUpRight <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-icons/fi'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Button'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">'Components/Button'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> Button<span class="token punctuation">,</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    children<span class="token operator">:</span> <span class="token string">'Click me!'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
    children<span class="token operator">:</span> <span class="token punctuation">{</span>
      description<span class="token operator">:</span> <span class="token string">'This is the text of the button, can be a node.'</span><span class="token punctuation">,</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'primary'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">,</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'secondary'</span><span class="token punctuation">,</span> <span class="token string">'light'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'select'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> <span class="token string">'This controls the color scheme of the button'</span><span class="token punctuation">,</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token string">'primary'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    variant<span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'solid'</span><span class="token punctuation">,</span> <span class="token string">'outline'</span><span class="token punctuation">,</span> <span class="token string">'naked'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'select'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> <span class="token string">'This controls the variant of the button'</span><span class="token punctuation">,</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token string">'solid'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    size<span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sm'</span><span class="token punctuation">,</span> <span class="token string">'md'</span><span class="token punctuation">,</span> <span class="token string">'lg'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'radio'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> <span class="token string">'This controls the size of the button'</span><span class="token punctuation">,</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token string">'md'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    loading<span class="token operator">:</span> <span class="token punctuation">{</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'boolean'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> <span class="token string">'This controls the loading state of the button'</span><span class="token punctuation">,</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    href<span class="token operator">:</span> <span class="token punctuation">{</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span>
        <span class="token string">'If this is set, the button will be rendered as an anchor tag.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    className<span class="token operator">:</span> <span class="token punctuation">{</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> <span class="token string">'Classes to be applied to the button'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    disabled<span class="token operator">:</span> <span class="token punctuation">{</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'boolean'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> <span class="token string">'If true, the button will be disabled'</span><span class="token punctuation">,</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    rightIcon<span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Smile'</span><span class="token punctuation">,</span> <span class="token string">'ThumbsUp'</span><span class="token punctuation">,</span> <span class="token string">'YinYang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      mapping<span class="token operator">:</span> <span class="token punctuation">{</span>
        Smile<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FaRegSmileWink</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
        ThumbsUp<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FaThumbsUp</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
        YinYang<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FaYinYang</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span>
        <span class="token string">'If set, the icon will be rendered on the right side of the button'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    leftIcon<span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Smile'</span><span class="token punctuation">,</span> <span class="token string">'ThumbsUp'</span><span class="token punctuation">,</span> <span class="token string">'YinYang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      mapping<span class="token operator">:</span> <span class="token punctuation">{</span>
        Smile<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FaRegSmileWink</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
        ThumbsUp<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FaThumbsUp</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
        YinYang<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FaYinYang</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span>
        <span class="token string">'If set, the icon will be rendered on the left side of the button'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    loadingText<span class="token operator">:</span> <span class="token punctuation">{</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span>
        <span class="token string">'If set, the text will be rendered while the button is in the loading state'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span>
        <span class="token string">'If set, the target will be rendered as an attribute on the anchor tag'</span><span class="token punctuation">,</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token string">'_self'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">as</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'select'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span>
        <span class="token string">'If set, the button will be rendered as the specified element'</span><span class="token punctuation">,</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token string">'button'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Button<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Story</span> <span class="token operator">=</span> StoryObj<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Button<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Primary<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Secondary<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token string">'secondary'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Danger<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token string">'danger'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Warning<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Light<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Info<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    color<span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Custom<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    className<span class="token operator">:</span> <span class="token string">'bg-[yellow] text-[black] border-[orange]'</span><span class="token punctuation">,</span>
    style<span class="token operator">:</span> <span class="token punctuation">{</span> borderRadius<span class="token operator">:</span> <span class="token string">'3.5rem'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> WithRightIcon<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    rightIcon<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FiArrowUpRight</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>h-5 w-auto<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> WithLeftIcon<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    leftIcon<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FiArrowUpRight</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>h-5 w-auto<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Disabled<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    disabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> OutlineVariant<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    variant<span class="token operator">:</span> <span class="token string">'outline'</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token string">'danger'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> NakedVariant<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    variant<span class="token operator">:</span> <span class="token string">'naked'</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token string">'danger'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> Loading<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> CustomLoadingText<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    loadingText<span class="token operator">:</span> <span class="token string">'Processing...'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> AsLink<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    href<span class="token operator">:</span> <span class="token string">'https://fin.africa'</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token string">'Visit fin website'</span><span class="token punctuation">,</span>
    rightIcon<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FiArrowUpRight</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>h-5 w-auto<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> FullWidth<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span>
    fullWidth<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token string">'Visit fin website'</span><span class="token punctuation">,</span>
    rightIcon<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FiArrowUpRight</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>h-5 w-auto<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><code class="language-text">components/ui/Docs.mdx</code></p>
<p>コンポーネントの仕組みをドキュメント化するのにストーリーファイルを使用することもできますが、Markdownファイルのほうがより詳細なドキュメント化が可能です。</p>
<p><code class="language-text">Button</code>コンポーネントの開発に使用した規約は、筆者が全てのコンポーネントで実践している規約と同じものです。</p>
<h2>重要なポイント</h2>
<ul>
<li>オープンソースソリューションであれ、自ら開発したものであれ、何らかのデザインシステムを用意しましょう。</li>
<li>TypeScriptと仲良くなりましょう。TypeScriptをうまく活用し、コンポーネントの使い方を規定しましょう。ボタンコンポーネントが良い例です。<code class="language-text">leftIcon</code>と<code class="language-text">rightIcon</code>という2つのpropsがありますが、この記事ではTypeScriptを使用することでいずれか一方のみが設定されるようにし、両方設定された場合はエラーを返すようにしました。</li>
</ul>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ButtonProps</span> <span class="token operator">=</span> BaseProps <span class="token operator">&amp;</span>
  <span class="token punctuation">(</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
        rightIcon<span class="token operator">?</span><span class="token operator">:</span> ReactElement<span class="token punctuation">;</span>
        leftIcon<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
        rightIcon<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
        leftIcon<span class="token operator">?</span><span class="token operator">:</span> ReactElement<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>コードとコンポーネントをドキュメント化しましょう。Storybookなどのツールを使用するとよいでしょう。</li>
<li>何らかのスタイルガイドを用意し、チームと共通のデザイン言語を使用しましょう。</li>
<li>分かりやすいコードを書きましょう。コードベースは簡単で分かりやすいものにし、焦点を絞ります。それぞれのコードには単一の明確な目的が必要です。</li>
<li>内部の仕組みを理解しましょう。Reactがどのようにして2つの値が同一であるかを確認するのかについて、筆者が調べた内容をこちらの記事にまとめています。</li>
</ul>
<h2>おわりに</h2>
<p>この記事では、筆者が使用している手法やツールの一部を紹介しました。手元にあるツールを全て網羅してはいませんが、ご自身のニーズに合ったものが見つかると幸いです。全く新しいものを採用するよりも、熟知している技術を使い続けるのが賢明でしょう。</p>
<p>つまるところ、クライアントが最も重視するのは最終製品であって、どのような技術を使用したかではないのです。Reactであれ、Vueであれ、あるいはその他のツールであれ、素早くデプロイでき、ユーザーにメリットがあるようなツールやワークフローを優先的に使用しましょう。</p>
<h2>Resources</h2>
<ul>
<li><a href="https://mkosir.github.io/typescript-style-guide/">TypeScript Style Guide</a></li>
<li><a href="https://turbo.build/">Turborepo</a></li>
<li><a href="https://nextjs.org/">Next.js</a></li>
<li><a href="https://tailwindcss.com/">Tailwind CSS</a></li>
<li><a href="https://prettier.io/">Prettier</a></li>
<li><a href="https://josemukorivo.com/">My website</a></li>
</ul>]]></content:encoded></item></channel></rss>